<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Warp Parse Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon-de23e50b.svg">
        <link rel="shortcut icon" href="favicon-8114d1fc.png">
        <link rel="stylesheet" href="css/variables-8adf115d.css">
        <link rel="stylesheet" href="css/general-2459343d.css">
        <link rel="stylesheet" href="css/chrome-ae938929.css">
        <link rel="stylesheet" href="css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/lang-switch.css">
        <link rel="stylesheet" href="../theme/version-badge.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "ayu";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex-cee6790d.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc-ec81ad47.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Warp Parse Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>
                        <a href="https://github.com/wp-labs/warp-parse" title="Git repository" aria-label="Git repository">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="user-guide"><a class="header" href="#user-guide">User Guide</a></h1>
<p>Welcome to the Warp Parse documentation.</p>
<blockquote>
<p>This is the English version. 中文版请点击 <a href="/zh">中文</a>.</p>
</blockquote>
<h2 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h2>
<ol>
<li><a href="#getting-started">Getting Started</a> - Quick start guide</li>
<li><a href="10-user/02-config/README.html">Configuration</a> - Basic configuration</li>
<li><a href="10-user/03-wpl/README.html">WPL Language</a> - WPL rule language</li>
<li><a href="10-user/05-connectors/README.html">Connectors</a> - Sources and Sinks management</li>
</ol>
<h2 id="documentation-navigation"><a class="header" href="#documentation-navigation">Documentation Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Section</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><a href="10-user/01-cli/README.html">CLI Tools</a></td><td>Command-line tools reference</td></tr>
<tr><td><a href="10-user/02-config/README.html">Configuration</a></td><td>Configuration files and options</td></tr>
<tr><td><a href="10-user/03-wpl/README.html">WPL Language</a></td><td>Warp Parse Language guide</td></tr>
<tr><td><a href="10-user/04-oml/README.html">OML Language</a></td><td>Object Model Language guide</td></tr>
<tr><td><a href="10-user/05-connectors/README.html">Connectors</a></td><td>Sources and Sinks configuration</td></tr>
<tr><td><a href="#troubleshootingmd">Troubleshooting</a></td><td>Common issues and solutions</td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="warpparse-core-concepts-quick-reference"><a class="header" href="#warpparse-core-concepts-quick-reference">WarpParse Core Concepts Quick Reference</a></h1>
<p>This document helps beginners quickly understand WarpParse’s core concepts and terminology.</p>
<h2 id="what-is-etl"><a class="header" href="#what-is-etl">What is ETL?</a></h2>
<p>ETL stands for Extract, Transform, and Load. Simply put:</p>
<ul>
<li><strong>Extract</strong>: Read raw data from log files, databases, message queues, etc.</li>
<li><strong>Transform</strong>: Convert unstructured text into structured data (e.g., JSON)</li>
<li><strong>Load</strong>: Store processed data to target destinations (files, databases, ES, etc.)</li>
</ul>
<h3 id="analogy"><a class="header" href="#analogy">Analogy</a></h3>
<p>Think of it like a smart package sorting system:</p>
<ul>
<li><strong>Extract</strong> = Collection (gathering packages from various locations)</li>
<li><strong>Transform</strong> = Classification (sorting by address, type, and labeling)</li>
<li><strong>Load</strong> = Delivery (sending to corresponding destinations)</li>
</ul>
<hr>
<h2 id="warpparse-core-terminology"><a class="header" href="#warpparse-core-terminology">WarpParse Core Terminology</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Term</th><th>Chinese</th><th>Plain Explanation</th><th>Analogy</th></tr>
</thead>
<tbody>
<tr><td><strong>Source</strong></td><td>源</td><td>Where data comes from</td><td>Water source (file, TCP, Kafka)</td></tr>
<tr><td><strong>Sink</strong></td><td>汇</td><td>Where data goes to</td><td>Water tank (file, database, ES)</td></tr>
<tr><td><strong>Connector</strong></td><td>连接器</td><td>How to connect to data sources/targets</td><td>Pipe connector (connection parameters)</td></tr>
<tr><td><strong>WPL</strong></td><td>Warp Processing Language</td><td>Data extraction rule language</td><td>Sieve (defines how to extract fields from text)</td></tr>
<tr><td><strong>OML</strong></td><td>Object Modeling Language</td><td>Data assembly rule language</td><td>Mold (defines how to assemble target format)</td></tr>
<tr><td><strong>Rule</strong></td><td>规则</td><td>A parsing rule</td><td>A sieve blueprint</td></tr>
<tr><td><strong>Field</strong></td><td>字段</td><td>Data item to extract</td><td>A hole in the sieve</td></tr>
<tr><td><strong>Pipe</strong></td><td>管道</td><td>Data processing flow</td><td>Water pipe (data flow path)</td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="data-flow-process"><a class="header" href="#data-flow-process">Data Flow Process</a></h2>
<pre><code>Raw Logs → [Source Read] → [WPL Parse] → [OML Transform] → [Sink Output] → Target Storage
    ↓            ↓              ↓               ↓                ↓
File/TCP     connectors    Extract Fields   Assemble Objects   File/DB/ES
</code></pre>
<h3 id="detailed-explanation"><a class="header" href="#detailed-explanation">Detailed Explanation</a></h3>
<ol>
<li>
<p><strong>Source Read</strong>: Read raw data from configured data sources</p>
<ul>
<li>File: Read log files</li>
<li>TCP: Listen on network ports to receive data</li>
<li>Kafka: Consume data from message queues</li>
</ul>
</li>
<li>
<p><strong>WPL Parse</strong>: Use WPL rules to extract fields from raw text</p>
<ul>
<li>Identify IP addresses, timestamps, numbers, etc.</li>
<li>Parse structured data like JSON, KV</li>
<li>Validate and filter fields</li>
</ul>
</li>
<li>
<p><strong>OML Transform</strong>: Use OML rules to assemble output format</p>
<ul>
<li>Field renaming and mapping</li>
<li>Type conversion (string → number → time)</li>
<li>Conditional logic and calculations</li>
</ul>
</li>
<li>
<p><strong>Sink Output</strong>: Write processed data to targets</p>
<ul>
<li>File: Save as JSON/CSV formats</li>
<li>Database: Write to MySQL/PostgreSQL</li>
<li>Search Engine: Write to Elasticsearch</li>
</ul>
</li>
</ol>
<hr>
<h2 id="quick-start-path"><a class="header" href="#quick-start-path">Quick Start Path</a></h2>
<h3 id="stage-1"><a class="header" href="#stage-1">Stage 1:</a></h3>
<ol>
<li>Complete Getting Started to see data flow in action</li>
<li>Learn WPL basic types (ip, digit, time, chars)</li>
<li>Learn OML data assembly</li>
<li>Explore demo examples in the editor</li>
</ol>
<h3 id="stage-2"><a class="header" href="#stage-2">Stage 2:</a></h3>
<ol>
<li>Complete T1 exercise in the editor</li>
<li>Create your own WPL and OML in your workspace</li>
<li>Configure Source and Sink</li>
<li>Use wpgen to generate sample data, wparse to execute and view output</li>
</ol>
<hr>
<h2 id="project-directory-structure"><a class="header" href="#project-directory-structure">Project Directory Structure</a></h2>
<pre><code>workspace/
├── conf/              # Configuration files
│   ├── wparse.toml   # Parse engine config
│   └── wpgen.toml    # Data generator config
│
├── connectors/        # Connector definitions
│   ├── sink.d/       # Output connectors (where data goes)
│   └── source.d/     # Input connectors (where data comes from)
│
├── data/              # Data directory
│   ├── in_dat/       # Input data (raw logs)
│   │   └── gen.dat  # Generated test data
│   ├── out_dat/      # Output data (parsed results)
│   │   ├── demo.json       # All successfully parsed records
│   │   ├── default.dat     # WPL matched but OML unmatched data
│   │   ├── error.dat       # Error data
│   │   ├── miss.dat        # WPL unmatched data
│   │   ├── monitor.dat     # Monitoring data
│   │   └── residue.dat     # Residual data (partially parsed)
│   ├── logs/         # Runtime logs
│   └── rescue/       # Failed data (for troubleshooting)
│
├── models/            # Model definitions
│   ├── wpl/          # WPL parsing rules
│   │   └── wp-space/
│   │       ├── parse.wpl    # Parsing rule file
│   │       └── sample.dat   # Test samples for rules
│   ├── oml/          # OML transformation rules
│   │   └── wp-space/
│   │       └── adm.oml      # Object mapping rules
│   └── knowledge/    # Knowledge base (SQL queries, etc.)
│
└── topology/          # Topology configuration
    ├── sources/      # Data source config
    └── sinks/        # Data target config
</code></pre>
<h3 id="directory-explanation"><a class="header" href="#directory-explanation">Directory Explanation</a></h3>
<ul>
<li><strong>conf/</strong>: Global configuration like log level, performance parameters</li>
<li><strong>connectors/</strong>: Define how to connect to data sources and targets</li>
<li><strong>data/</strong>: Storage location for all data files
<ul>
<li><strong>in_dat/</strong>: Store raw input data
<ul>
<li><code>gen.dat</code>: Test data generated by wpgen</li>
</ul>
</li>
<li><strong>out_dat/</strong>: Store parsed output data
<ul>
<li><code>all.json</code>: All successfully parsed records (JSON format)</li>
<li><code>default.dat</code>: Data that matched WPL but not OML</li>
<li><code>error.dat</code>: Records that encountered errors during parsing</li>
<li><code>miss.dat</code>: Records that didn’t match WPL rules</li>
<li><code>monitor.dat</code>: Monitoring and statistics data</li>
<li><code>residue.dat</code>: Residual data with partially parsed fields</li>
</ul>
</li>
<li><strong>logs/</strong>: Runtime logs for debugging and troubleshooting</li>
<li><strong>rescue/</strong>: Failed raw data for reprocessing</li>
</ul>
</li>
<li><strong>models/</strong>: Core business logic (WPL rules and OML rules)
<ul>
<li><strong>wpl/</strong>: WPL parsing rules, organized by namespace
<ul>
<li><code>wp-space/parse.wpl</code>: Specific parsing rule file</li>
<li><code>wp-space/sample.dat</code>: Test samples for the rules</li>
</ul>
</li>
<li><strong>oml/</strong>: OML transformation rules, organized by namespace
<ul>
<li><code>wp-space/adm.oml</code>: Object mapping and transformation rules</li>
</ul>
</li>
<li><strong>knowledge/</strong>: Knowledge base like SQL queries, IP databases, etc.</li>
</ul>
</li>
<li><strong>topology/</strong>: Data flow topology configuration</li>
</ul>
<hr>
<h2 id="common-commands-quick-reference"><a class="header" href="#common-commands-quick-reference">Common Commands Quick Reference</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Command</th><th>Function</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>wproj init</code></td><td>Initialize project</td><td><code>wproj init --mode full</code></td></tr>
<tr><td><code>wproj check</code></td><td>Check configuration</td><td><code>wproj check</code></td></tr>
<tr><td><code>wproj data stat</code></td><td>Statistics</td><td><code>wproj data stat</code></td></tr>
<tr><td><code>wpgen sample</code></td><td>Generate test data</td><td><code>wpgen sample -n 3000</code></td></tr>
<tr><td><code>wparse batch</code></td><td>Batch processing mode</td><td><code>wparse batch --stat 3 -p</code></td></tr>
<tr><td><code>wparse daemon</code></td><td>Daemon mode</td><td><code>wparse daemon --stat-print</code></td></tr>
<tr><td><code>wprescue batch</code></td><td>Recover failed data</td><td><code>wprescue batch</code></td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>After reading this document, we recommend learning in the following order:</p>
<ol>
<li><strong><a href="#getting-started">Getting Started</a></strong>: Run your first example in 10 minutes</li>
<li><strong><a href="#wpl-quick-start">WPL Language Basics</a></strong>: Learn data extraction rules</li>
<li><strong><a href="10-user/04-oml/README.html">OML Language Basics</a></strong>: Learn data assembly rules</li>
</ol>
<hr>
<h2 id="related-documentation"><a class="header" href="#related-documentation">Related Documentation</a></h2>
<ul>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="10-user/01-cli/README.html">CLI Tools</a></li>
<li><a href="10-user/03-wpl/README.html">WPL Language</a></li>
<li><a href="10-user/04-oml/README.html">OML Language</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="cli-tools"><a class="header" href="#cli-tools">CLI Tools</a></h1>
<p>This documentation collection introduces the complete command-line toolset provided by WarpParse, including data parsing, generation, and project management functions.</p>
<h2 id="tool-overview"><a class="header" href="#tool-overview">Tool Overview</a></h2>
<h3 id="core-tools"><a class="header" href="#core-tools">Core Tools</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Tool</th><th>Description</th><th>Main Purpose</th></tr>
</thead>
<tbody>
<tr><td><strong>wparse</strong></td><td>Data parsing engine</td><td>Real-time data stream processing, batch analysis</td></tr>
<tr><td><strong>wpgen</strong></td><td>Data generator</td><td>Generate test data based on rules or samples</td></tr>
<tr><td><strong>wproj</strong></td><td>Project management tool</td><td>Project initialization, configuration management, data statistics</td></tr>
<tr><td><strong>wprescue</strong></td><td>Data recovery tool</td><td>Recover failed data from rescue directory</td></tr>
</tbody>
</table>
</div>
<h2 id="quick-reference"><a class="header" href="#quick-reference">Quick Reference</a></h2>
<h3 id="wparse---data-parsing-engine"><a class="header" href="#wparse---data-parsing-engine">wparse - Data Parsing Engine</a></h3>
<pre><code class="language-bash"># Daemon mode (persistent service)
wparse daemon --work-root ./myproject --stat-print

# Batch processing mode
wparse batch --work-root ./myproject --max-line 10000 --stat 5
</code></pre>
<h3 id="wpgen---data-generator"><a class="header" href="#wpgen---data-generator">wpgen - Data Generator</a></h3>
<pre><code class="language-bash"># Generate data based on rules
wpgen rule --work-root ./myproject --print-stat --line-cnt 10000

# Generate data from samples
wpgen sample --work-root ./myproject --line-cnt 5000

# Configuration management
wpgen conf init
wpgen conf check
wpgen conf clean

# Data management
wpgen data clean
wpgen data check
</code></pre>
<h3 id="wproj---project-management-tool"><a class="header" href="#wproj---project-management-tool">wproj - Project Management Tool</a></h3>
<pre><code class="language-bash"># Project initialization
wproj init --mode full

# Project check
wproj check

# Data cleanup
wproj data clean

# Statistics
wproj stat file
wproj stat file --output json

# Model management
wproj model list
wproj model validate

# Rule tools
wproj rule parse --rule-id myrule
wproj rule test --input sample.log

# Configuration management
wproj sinks list
wproj sinks validate
wproj sinks route
</code></pre>
<h3 id="wprescue---data-recovery-tool"><a class="header" href="#wprescue---data-recovery-tool">wprescue - Data Recovery Tool</a></h3>
<pre><code class="language-bash"># Batch mode data recovery
wprescue batch --work-root ./myproject
</code></pre>
<h2 id="tool-relationship-diagram"><a class="header" href="#tool-relationship-diagram">Tool Relationship Diagram</a></h2>
<pre class="mermaid">graph TD
    A[wproj] --&gt; B[Initialize Project]
    A --&gt; C[Check Configuration]
    A --&gt; D[Statistics]

    B --&gt; E[Generate Config Files]
    B --&gt; F[Create Directory Structure]

    C --&gt; G[Validate Config]

    D --&gt; H[Source Data Stats]
    D --&gt; I[Output Data Stats]

    J[wpgen] --&gt; K[Generate Test Data]
    J --&gt; L[Manage Generator Config]
    J --&gt; M[Manage Output Data]

    N[wparse] --&gt; O[Real-time Stream Processing]
    N --&gt; P[Batch Analysis]
    N --&gt; Q[Performance Tuning]

    R[wprescue] --&gt; S[Data Recovery]
    R --&gt; T[Failure Recovery]
</pre>

<h2 id="quick-start-1"><a class="header" href="#quick-start-1">Quick Start</a></h2>
<h3 id="1-initialize-project"><a class="header" href="#1-initialize-project">1. Initialize Project</a></h3>
<pre><code class="language-bash"># Full initialization with configuration and templates
wproj init --mode full
wproj check
</code></pre>
<h3 id="2-generate-test-data"><a class="header" href="#2-generate-test-data">2. Generate Test Data</a></h3>
<pre><code class="language-bash"># Generate test data (10000 lines, 3-second stats interval)
wpgen rule -n 10000 --stat 3
</code></pre>
<h3 id="3-run-parsing"><a class="header" href="#3-run-parsing">3. Run Parsing</a></h3>
<pre><code class="language-bash"># Batch processing mode
wparse batch --stat 5 -p

# Or use daemon mode (persistent service)
wparse daemon --stat-print
</code></pre>
<h3 id="4-view-statistics"><a class="header" href="#4-view-statistics">4. View Statistics</a></h3>
<pre><code class="language-bash"># Statistics for sources and file-type sinks
wproj stat file

# Output in JSON format
wproj stat file --output json
</code></pre>
<h2 id="learning-path"><a class="header" href="#learning-path">Learning Path</a></h2>
<ol>
<li><strong>Beginners</strong>: Start with <a href="#getting-started">Getting Started Guide</a> to understand the complete configuration and usage flow</li>
<li><strong>Advanced Users</strong>: Study <a href="#wparse">wparse</a> in depth to understand the two running modes and their use cases</li>
<li><strong>Data Engineers</strong>: Master <a href="#wpgen">wpgen Usage Guide</a> to generate various test data</li>
<li><strong>Operations</strong>: Use <a href="#wproj">wproj Project Management</a> for daily project management and monitoring</li>
<li><strong>Troubleshooting</strong>: Refer to <a href="#wprescue">wprescue Data Recovery</a> for handling exceptions</li>
</ol>
<h2 id="common-use-cases"><a class="header" href="#common-use-cases">Common Use Cases</a></h2>
<h3 id="real-time-stream-processing"><a class="header" href="#real-time-stream-processing">Real-time Stream Processing</a></h3>
<pre><code class="language-bash"># Start daemon for continuous data stream processing
wparse daemon \
  --work-root ./myproject \
  --stat-print \
  --robust online
</code></pre>
<h3 id="batch-data-analysis"><a class="header" href="#batch-data-analysis">Batch Data Analysis</a></h3>
<pre><code class="language-bash"># Batch analysis of historical data
wparse batch \
  --work-root ./myproject \
  --max-line 100000 \
  --check-continue 1000 \
  --stat 10
</code></pre>
<h3 id="development-testing"><a class="header" href="#development-testing">Development Testing</a></h3>
<pre><code class="language-bash"># Development mode with detailed logging
wparse batch \
  --work-root ./myproject \
  --log-profile dev \
  --max-line 100 \
  --stat 1
</code></pre>
<h3 id="test-data-generation"><a class="header" href="#test-data-generation">Test Data Generation</a></h3>
<pre><code class="language-bash"># Generate test data for specific scenarios
wpgen rule \
  --work-root ./myproject \
  --conf-name test.toml \
  --line-cnt 10000 \
  --gen-speed 1000
</code></pre>
<h2 id="troubleshooting"><a class="header" href="#troubleshooting">Troubleshooting</a></h2>
<h3 id="common-issues"><a class="header" href="#common-issues">Common Issues</a></h3>
<ol>
<li>
<p><strong>Configuration file not found</strong></p>
<ul>
<li>Ensure you’re running commands in the correct working directory</li>
<li>Use <code>--work-root</code> parameter to specify the working directory</li>
</ul>
</li>
<li>
<p><strong>Permission errors</strong></p>
<ul>
<li>Check write permissions for working and log directories</li>
<li>Ensure sufficient disk space</li>
</ul>
</li>
<li>
<p><strong>Out of memory</strong></p>
<ul>
<li>Reduce <code>--max-line</code> or <code>--parse-workers</code> parameter values</li>
<li>Use <code>--robust</code> parameter to set appropriate robustness mode</li>
</ul>
</li>
<li>
<p><strong>Data source connection failed</strong></p>
<ul>
<li>Check connector configuration in <code>connectors/source.d/</code> directory</li>
<li>Verify network connectivity and authentication information</li>
</ul>
</li>
</ol>
<h3 id="log-analysis"><a class="header" href="#log-analysis">Log Analysis</a></h3>
<pre><code class="language-bash"># View real-time logs
tail -f logs/wparse.log

# Search error logs
grep -i error logs/*.log

# Use wproj for project check
wproj check --work-root ./myproject
</code></pre>
<h2 id="version-information"><a class="header" href="#version-information">Version Information</a></h2>
<p>Check tool versions:</p>
<pre><code class="language-bash">wparse --version
wpgen --version
wproj --version
wprescue --version
</code></pre>
<h2 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Variable</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>WP_PARSE_ROBUST</code></td><td>Set global robustness mode</td></tr>
<tr><td><code>WP_PARSE_LOG_LEVEL</code></td><td>Override log level</td></tr>
<tr><td><code>RUST_LOG</code></td><td>Rust log level (for debugging)</td></tr>
</tbody>
</table>
</div>
<h2 id="exit-codes"><a class="header" href="#exit-codes">Exit Codes</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Exit Code</th><th>Meaning</th></tr>
</thead>
<tbody>
<tr><td>0</td><td>Success</td></tr>
<tr><td>1</td><td>General error</td></tr>
<tr><td>2</td><td>Configuration error</td></tr>
<tr><td>3</td><td>Data error</td></tr>
<tr><td>4</td><td>Network error</td></tr>
<tr><td>5</td><td>Permission error</td></tr>
</tbody>
</table>
</div>
<h2 id="technical-architecture"><a class="header" href="#technical-architecture">Technical Architecture</a></h2>
<p>The CLI tools are written in Rust, using the clap framework for command-line argument handling and tokio async runtime. Core functionality is exposed through the <code>wp-engine</code> library’s facade pattern, ensuring API stability and backward compatibility.</p>
<h3 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h3>
<pre><code>warp-parse/
├── src/
│   ├── wparse/          # Data parsing engine
│   │   └── main.rs
│   ├── wpgen/           # Data generator
│   │   ├── main.rs
│   │   ├── cli.rs       # CLI definition
│   │   ├── rule.rs      # Rule generation logic
│   │   ├── sample.rs    # Sample generation logic
│   │   ├── conf.rs      # Configuration management
│   │   └── data.rs      # Data management
│   ├── wproj/           # Project management
│   │   └── main.rs
│   └── wprescue/        # Data recovery
│       └── main.rs
└── wp-engine/           # Core engine library
    └── facade/args.rs   # Parameter definitions
</code></pre>
<p>This design ensures:</p>
<ol>
<li><strong>Modularity</strong>: Each tool has a single responsibility, easy to maintain</li>
<li><strong>Reusability</strong>: Core functionality is shared through libraries</li>
<li><strong>Extensibility</strong>: Easy to add new CLI tools</li>
</ol>
<h2 id="related-links"><a class="header" href="#related-links">Related Links</a></h2>
<ul>
<li><a href="https://github.com/wp-labs/warp-parse">Project Homepage</a></li>
<li><a href="https://github.com/wp-labs/warp-parse/releases">Downloads</a></li>
<li><a href="10-user/02-config">Configuration Reference</a></li>
<li><a href="10-user">User Documentation</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="prerequisites"><a class="header" href="#prerequisites">Prerequisites</a></h2>
<ul>
<li><a href="https://github.com/wp-labs/warp-parse/releases">Download wparse</a></li>
<li>Copy to an executable path, such as /usr/local/bin or /${HOME}/bin</li>
</ul>
<h2 id="1-initialize-working-directory"><a class="header" href="#1-initialize-working-directory">1. Initialize Working Directory</a></h2>
<ul>
<li>Clean and initialize configuration and templates
<pre><code class="language-bash">wproj init --mode full
wproj check
</code></pre>
</li>
</ul>
<p>After execution, the working directory will contain:</p>
<pre><code>├── conf
│   ├── wparse.toml
│   └── wpgen.toml
├── connectors
│   ├── sink.d
│   └── source.d
├── data
│   ├── in_dat
│   ├── logs
│   ├── out_dat
│   └── rescue
├── models
│   ├── knowledge
│   ├── oml
│   └── wpl
└── topology
    ├── sinks
    └── sources
</code></pre>
<h2 id="2-generate-data-and-cleanup"><a class="header" href="#2-generate-data-and-cleanup">2. Generate Data and Cleanup</a></h2>
<pre><code class="language-bash">wproj data clean
wpgen data clean

# Generate samples (example: 3000 lines, 3-second stats interval)
wpgen sample -n 3000 --stat 3
</code></pre>
<h2 id="3-run-parsing-1"><a class="header" href="#3-run-parsing-1">3. Run Parsing</a></h2>
<pre><code class="language-bash"># Batch processing (-n specifies count, -p prints statistics; check ./logs/ for failures)
wparse batch --stat 3 -p
</code></pre>
<h2 id="4-statistics-and-validation"><a class="header" href="#4-statistics-and-validation">4. Statistics and Validation</a></h2>
<pre><code class="language-bash"># Statistics for both sources and file-type sinks
wproj data stat
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wproj"><a class="header" href="#wproj">Wproj</a></h1>
<p>wproj is the Warp Parse project management tool, providing complete project lifecycle management functions, including project initialization and configuration management, data source checking and statistics, model management, and knowledge base creation and maintenance.</p>
<h2 id="command-overview"><a class="header" href="#command-overview">Command Overview</a></h2>
<pre><code>wproj &lt;COMMAND&gt;

Commands:
  rule   Rule tools: management and debugging of parsing rules
  init   Initialize complete project skeleton
  check  Batch check project configuration and file integrity
  data   Data management tools: cleanup, statistics, validation
  model  Model management tools: rules, sources, sinks, knowledge base
</code></pre>
<hr>
<h2 id="init---project-initialization"><a class="header" href="#init---project-initialization">init - Project Initialization</a></h2>
<p>Create project directory structure and default configuration with one command.</p>
<pre><code class="language-bash">wproj init [OPTIONS]
</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>mode</td><td><code>-m</code></td><td><code>--mode</code></td><td><code>conf</code></td><td>Initialization mode</td></tr>
</tbody>
</table>
</div>
<p><strong>Initialization Modes:</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Mode</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>full</code></td><td>Complete project (config+models+data+examples+connectors)</td></tr>
<tr><td><code>normal</code></td><td>Complete project (config+models+data+examples)</td></tr>
<tr><td><code>model</code></td><td>Model files only</td></tr>
<tr><td><code>conf</code></td><td>Configuration files only</td></tr>
<tr><td><code>data</code></td><td>Data directories only</td></tr>
</tbody>
</table>
</div>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash"># Initialize configuration (default)
wproj init -w /project

# Initialize complete project
wproj init -w /project --mode full
</code></pre>
<hr>
<h2 id="check---project-check"><a class="header" href="#check---project-check">check - Project Check</a></h2>
<p>Batch check project configuration and file integrity.</p>
<pre><code class="language-bash">wproj check [OPTIONS]
</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>work_root</td><td><code>-w</code></td><td><code>--work-root</code></td><td><code>.</code></td><td>Root directory</td></tr>
<tr><td>what</td><td>-</td><td><code>--what</code></td><td><code>all</code></td><td>Check items</td></tr>
<tr><td>console</td><td>-</td><td><code>--console</code></td><td>false</td><td>Console log output</td></tr>
<tr><td>fail_fast</td><td>-</td><td><code>--fail-fast</code></td><td>false</td><td>Exit on first failure</td></tr>
<tr><td>json</td><td>-</td><td><code>--json</code></td><td>false</td><td>JSON format output</td></tr>
<tr><td>only_fail</td><td>-</td><td><code>--only-fail</code></td><td>false</td><td>Output only failed items</td></tr>
</tbody>
</table>
</div>
<p><strong>Check Items (–what):</strong></p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Value</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>conf</code></td><td>Main configuration files</td></tr>
<tr><td><code>connectors</code></td><td>Connector configuration</td></tr>
<tr><td><code>sources</code></td><td>Data source configuration</td></tr>
<tr><td><code>sinks</code></td><td>Data sink configuration</td></tr>
<tr><td><code>wpl</code></td><td>WPL rule syntax</td></tr>
<tr><td><code>oml</code></td><td>OML model syntax</td></tr>
<tr><td><code>all</code></td><td>All checks (default)</td></tr>
</tbody>
</table>
</div>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash"># Comprehensive check
wproj check -w /project --what all

# Check only config and rules, exit on first failure
wproj check -w /project --what conf,wpl --fail-fast

# JSON output, show only failures
wproj check -w /project --json --only-fail
</code></pre>
<hr>
<h2 id="data---data-management"><a class="header" href="#data---data-management">data - Data Management</a></h2>
<pre><code class="language-bash">wproj data &lt;SUBCOMMAND&gt;

Subcommands:
  clean     Clean local output files
  check     Check data source connectivity
  stat      Statistics on data volume and performance
  validate  Validate data distribution and ratios
</code></pre>
<h3 id="data-clean"><a class="header" href="#data-clean">data clean</a></h3>
<p>Clean project output data.</p>
<pre><code class="language-bash">wproj data clean
</code></pre>
<h3 id="data-stat"><a class="header" href="#data-stat">data stat</a></h3>
<p>Statistics on data volume.</p>
<pre><code class="language-bash">wproj data stat
</code></pre>
<h3 id="data-validate"><a class="header" href="#data-validate">data validate</a></h3>
<p>Validate data distribution and ratios.</p>
<pre><code class="language-bash">wproj data validate [OPTIONS]
</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>input_cnt</td><td>-</td><td><code>--input-cnt</code></td><td>-</td><td>Total input count (denominator)</td></tr>
</tbody>
</table>
</div>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash"># Clean output data
wproj data clean

# Statistics for source + sink file line counts
wproj data stat

# Validate data distribution
wproj data validate
</code></pre>
<hr>
<h2 id="model---model-management"><a class="header" href="#model---model-management">model - Model Management</a></h2>
<p>TODO!</p>
<hr>
<h2 id="rule---rule-tools"><a class="header" href="#rule---rule-tools">rule - Rule Tools</a></h2>
<p>Offline parsing test to validate WPL rules.</p>
<pre><code class="language-bash">wproj rule parse [OPTIONS]
</code></pre>
<p><strong>Examples:</strong></p>
<pre><code class="language-bash"># Run offline parsing test with rules
wproj rule parse
</code></pre>
<hr><div style="break-before: page; page-break-before: always;"></div>
<h1 id="wparse"><a class="header" href="#wparse">Wparse</a></h1>
<h2 id="running-modes"><a class="header" href="#running-modes">Running Modes</a></h2>
<ul>
<li>Two running modes: <code>wparse daemon</code> (persistent service) and <code>wparse batch</code> (batch processing)</li>
<li>Batch mode exits automatically after reading files; daemon mode requires a signal to trigger exit</li>
</ul>
<h2 id="command-line-arguments"><a class="header" href="#command-line-arguments">Command Line Arguments</a></h2>
<pre><code>wparse &lt;COMMAND&gt;

Commands:
  daemon  Daemon mode (persistent service)
  batch   Batch processing mode (exits after completion)
</code></pre>
<h3 id="common-parameters"><a class="header" href="#common-parameters">Common Parameters</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>parse_workers</td><td><code>-w</code></td><td><code>--parse-workers</code></td><td>-</td><td>Number of parsing threads</td></tr>
<tr><td>stat_sec</td><td>-</td><td><code>--stat</code></td><td>-</td><td>Statistics output interval (seconds)</td></tr>
<tr><td>stat_print</td><td><code>-p</code></td><td><code>--print_stat</code></td><td>false</td><td>Periodically print statistics</td></tr>
<tr><td>wpl_dir</td><td>-</td><td><code>--wpl</code></td><td>-</td><td>WPL rules directory override</td></tr>
</tbody>
</table>
</div>
<h2 id="usage-examples"><a class="header" href="#usage-examples">Usage Examples</a></h2>
<pre><code class="language-bash"># Batch mode: exit after processing 3000 records, output stats every 2 seconds
wparse batch -n 3000 --stat 2 -p

# Batch mode: specify working directory and multi-threading
wparse batch -w 4 --parse-workers 4

# Daemon mode: persistent service, output stats every 5 seconds
wparse daemon --stat 5 -p

# Custom logging and rules directory
wparse daemon --log-profile custom.toml --wpl /custom/rules
</code></pre>
<h2 id="exit-strategy"><a class="header" href="#exit-strategy">Exit Strategy</a></h2>
<h3 id="batch-mode"><a class="header" href="#batch-mode">Batch Mode</a></h3>
<p>Single source (picker) termination conditions (any one satisfied):</p>
<ul>
<li>Upstream EOF (file reading completed)</li>
<li>Received Stop instruction</li>
<li>Fatal error (triggers global shutdown)</li>
</ul>
<p>Process exit flow:</p>
<ol>
<li>All data source pickers terminated</li>
<li>Main group completed</li>
<li>Sink/infra groups go offline in sequence</li>
<li>Process exits</li>
</ol>
<p>Key logs:</p>
<ul>
<li>Each source ends: <code>Data source '...' picker ended normally</code></li>
<li>Global cleanup: <code>all routine group await end!</code></li>
</ul>
<h3 id="daemon-mode"><a class="header" href="#daemon-mode">Daemon Mode</a></h3>
<ul>
<li>Starts acceptor (network listening, etc.)</li>
<li>Process remains running persistently</li>
<li>Exit triggers:
<ul>
<li>SIGTERM/SIGINT/SIGQUIT signals</li>
<li>Control bus Stop instruction (Enterprise Edition)</li>
</ul>
</li>
</ul>
<h2 id="error-and-retry-strategy"><a class="header" href="#error-and-retry-strategy">Error and Retry Strategy</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Error Type</th><th>Strategy</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>EOF</td><td>Terminate</td><td>Gracefully end current source</td></tr>
<tr><td>Disconnect/Retryable</td><td>FixRetry</td><td>Exponential backoff then continue</td></tr>
<tr><td>Data/Business Tolerable</td><td>Tolerant</td><td>Log and continue</td></tr>
<tr><td>Fatal Error</td><td>Throw</td><td>Trigger global shutdown</td></tr>
</tbody>
</table>
</div>
<h2 id="faq"><a class="header" href="#faq">FAQ</a></h2>
<p><strong>Q: Why doesn’t batch mode start the acceptor?</strong></p>
<p>A: The acceptor is a persistent component (network listening) that would block main group completion. Batch mode’s goal is “source ends → main group completes → process exits”.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpgen"><a class="header" href="#wpgen">Wpgen</a></h1>
<p>wpgen is the WarpParse data generator, used to generate test data based on WPL rules or sample files.</p>
<h2 id="command-overview-1"><a class="header" href="#command-overview-1">Command Overview</a></h2>
<pre><code>wpgen &lt;COMMAND&gt;

Commands:
  rule    Generate data by rule
  sample  Generate data from sample files
  conf    Configuration commands
  data    Data management commands
</code></pre>
<h2 id="subcommand-details"><a class="header" href="#subcommand-details">Subcommand Details</a></h2>
<h3 id="rule---rule-based-generation"><a class="header" href="#rule---rule-based-generation">rule - Rule-based Generation</a></h3>
<p>Generate test data based on WPL rules, supporting rule validation and performance analysis.</p>
<pre><code class="language-bash">wpgen rule [OPTIONS]
</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>wpl_dir</td><td>-</td><td><code>--wpl</code></td><td>-</td><td>WPL rules directory override</td></tr>
<tr><td>conf_name</td><td><code>-c</code></td><td><code>--conf</code></td><td><code>wpgen.toml</code></td><td>Configuration filename</td></tr>
<tr><td>stat_print</td><td><code>-p</code></td><td><code>--print_stat</code></td><td>false</td><td>Periodically print statistics</td></tr>
<tr><td>line_cnt</td><td><code>-n</code></td><td>-</td><td>-</td><td>Total line count override</td></tr>
<tr><td>speed</td><td><code>-s</code></td><td>-</td><td>-</td><td>Generation speed (lines/sec) override</td></tr>
<tr><td>stat_sec</td><td>-</td><td><code>--stat</code></td><td>1</td><td>Statistics output interval (seconds)</td></tr>
</tbody>
</table>
</div>
<h3 id="sample---sample-based-generation"><a class="header" href="#sample---sample-based-generation">sample - Sample-based Generation</a></h3>
<p>Generate test data based on sample files (sample.dat).</p>
<pre><code class="language-bash">wpgen sample [OPTIONS]
</code></pre>
<h3 id="conf---configuration-management"><a class="header" href="#conf---configuration-management">conf - Configuration Management</a></h3>
<pre><code class="language-bash">wpgen conf &lt;SUBCOMMAND&gt;

Subcommands:
  init   Initialize generator configuration (conf/wpgen.toml)
  clean  Clean generator configuration
  check  Check configuration validity
</code></pre>
<h3 id="data---data-management-1"><a class="header" href="#data---data-management-1">data - Data Management</a></h3>
<pre><code class="language-bash">wpgen data &lt;SUBCOMMAND&gt;

Subcommands:
  clean  Clean generated output data according to wpgen config
  check  Not supported; reserved for future use
</code></pre>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Short</th><th>Long</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td>conf_name</td><td><code>-c</code></td><td><code>--conf</code></td><td><code>wpgen.toml</code></td><td>Configuration filename</td></tr>
</tbody>
</table>
</div>
<h2 id="runtime-semantics"><a class="header" href="#runtime-semantics">Runtime Semantics</a></h2>
<h3 id="count-total-output-count"><a class="header" href="#count-total-output-count">count (Total Output Count)</a></h3>
<p>At startup, precisely divided among workers according to <code>parallel</code>, with remainders distributed to earlier workers. Each worker exits after completing its local workload; total count strictly equals <code>count</code>.</p>
<h3 id="speed-global-rate"><a class="header" href="#speed-global-rate">speed (Global Rate)</a></h3>
<ul>
<li><code>speed = 0</code>: No limit (no waiting)</li>
<li><code>speed &gt; 0</code>: Per-worker rate is <code>floor(speed / parallel)</code></li>
</ul>
<h3 id="parallel-parallelism"><a class="header" href="#parallel-parallelism">parallel (Parallelism)</a></h3>
<p>Number of parallel generation workers. For <code>blackhole_sink</code> consumers, parallelism also applies; other sinks default to single consumer.</p>
<h2 id="usage-examples-1"><a class="header" href="#usage-examples-1">Usage Examples</a></h2>
<pre><code class="language-bash"># Configuration initialization
wpgen conf init -w .
wpgen conf check -w .

# Generate 10000 records based on rules
wpgen sample -n 10000 -p

# Custom rules directory and generation speed
wpgen rule \
    --wpl nginx \
    -c custom.toml \
    -s 1000 \
    --stat 2 \
    -p

# Generate based on sample file
wpgen sample -n 50000 -s 5000 --stat 5 -p

# Clean generated data
wpgen data clean -c wpgen.toml --local
</code></pre>
<h2 id="faq-1"><a class="header" href="#faq-1">FAQ</a></h2>
<p><strong>Q: Output less than expected?</strong></p>
<p>A: <code>count</code> is precisely allocated to each worker. Check if <code>limit : …</code> in the logs matches expectations.</p>
<h2 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h2>
<p>Default configuration file path: <code>conf/wpgen.toml</code></p>
<p>Main configuration items:</p>
<pre><code class="language-toml">[generator]
count = 10000      # Total generation count
speed = 1000       # Generation speed (lines/sec), 0 means unlimited
parallel = 4       # Number of parallel workers

[output]
# Output configuration...
</code></pre>
<p>Generated files are typically located in <code>./data/in_dat/</code>; the target path can be adjusted in the configuration.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wprescue"><a class="header" href="#wprescue">wprescue</a></h1>
<p>wprescue is a data recovery tool used to recover data from the rescue directory and output it to targets according to the project’s configured sink routing.</p>
<h2 id="command-overview-2"><a class="header" href="#command-overview-2">Command Overview</a></h2>
<pre><code>wprescue
</code></pre>
<p><strong>Important:</strong> wprescue only supports batch mode.</p>
<h2 id="command-line-arguments-1"><a class="header" href="#command-line-arguments-1">Command Line Arguments</a></h2>
<pre><code class="language-bash">wprescue [OPTIONS]
</code></pre>
<h2 id="how-it-works"><a class="header" href="#how-it-works">How It Works</a></h2>
<ol>
<li>Read data from the rescue directory (<code>./data/rescue</code>)</li>
<li>Process according to the project’s configured sink routing</li>
<li>Output to target locations</li>
<li>Exit automatically after processing completes</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="configuration-guide"><a class="header" href="#configuration-guide">Configuration Guide</a></h1>
<!-- Role: Configuration User | Last Verified: 2025-12-21 -->
<p>This document focuses on the configuration that wparse relies on to run. It is recommended to start with the “Main Configuration (wparse.toml)” and then read the source/sink and connector sections as needed.</p>
<p>Recommended Reading Order</p>
<ul>
<li>Wparse Runtime Configuration (Main Configuration): wparse.toml (this directory)
<ul>
<li><a href="10-user/02-config/01-wparse_config.html">Wparse Configuration Specification (wparse.toml)</a></li>
</ul>
</li>
<li>Sources and Connectors
<ul>
<li><a href="#sources-configuration">Sources Configuration Overview</a></li>
<li>Connectors (source.d) - see lookup rules and examples in “Sources Configuration Overview”</li>
</ul>
</li>
<li>Sinks and Connectors
<ul>
<li><a href="10-user/02-config/04-sinks_config.html">Sinks Design and Configuration (Directory-based V2)</a></li>
<li><a href="10-user/02-config/03-sinks_minimal.html">Sinks Minimal Runnable Skeleton</a></li>
<li>Connectors (sink.d) and route details - see “Design and Configuration”</li>
</ul>
</li>
</ul>
<p>Related References</p>
<ul>
<li>Reference parameters and specifications: Source/Sink/Spec documents under docs/80-reference</li>
<li>CLI: docs/cli/wparse.md (quick lookup for common options)</li>
</ul>
<p>Tips</p>
<ul>
<li>Use <code>wproj conf init --work-root .</code> to initialize standard directories and templates (conf/, connectors/, and some models directories). If you need a KnowDB template, run <code>wproj knowdb init</code> separately.</li>
<li>After modifying scenario workflows, it is recommended to run <code>usecase/core/getting_started/case_verify.sh</code> to verify end-to-end output.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wparse-configuration"><a class="header" href="#wparse-configuration">Wparse Configuration</a></h1>
<p>Complete Example (Recommended Defaults)</p>
<pre><code class="language-toml">version = "1.0"
robust  = "normal"           # debug|normal|strict

[models]
wpl     = "./models/wpl"
oml     = "./models/oml"

[topology]
sources = "./topology/sources"
sinks   = "./topology/sinks"

[performance]
rate_limit_rps = 10000        # Rate limit (records/second)
parse_workers  = 2            # Number of concurrent parsing workers

[rescue]
path = "./data/rescue"

[log_conf]
output = "File"               # Console|File|Both
level  = "warn,ctrl=info"

[log_conf.file]
path = "./data/logs"          # File output directory; filename automatically takes executable name (wparse.log)

[stat]

[[stat.pick]]                 # Pickup stage statistics
key    = "pick_stat"
target = "*"

[[stat.parse]]                # Parsing stage statistics
key    = "parse_stat"
target = "*"

[[stat.sink]]                 # Sink stage statistics
key    = "sink_stat"
target = "*"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sources-configuration"><a class="header" href="#sources-configuration">Sources Configuration</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Source is the component responsible for data input in the warp-parse system, supporting multiple data sources and protocols. It adopts a unified connector architecture to provide flexible data access capabilities.</p>
<h3 id="location-and-directories"><a class="header" href="#location-and-directories">Location and Directories</a></h3>
<ul>
<li><strong>Configuration file</strong>: <code>$WORK_ROOT/topology/sources/wpsrc.toml</code></li>
<li><strong>Connector definitions</strong>: Lookup starts from <code>$WORK_ROOT/models/sources</code> and searches upward for the nearest <code>connectors/source.d/*.toml</code></li>
</ul>
<h3 id="core-concepts"><a class="header" href="#core-concepts">Core Concepts</a></h3>
<ul>
<li><strong>Connector</strong>: Reusable input connection definition, containing <code>id/type/params/allow_override</code></li>
<li><strong>Parameter Override</strong>: Safe parameter overriding through whitelist mechanism</li>
<li><strong>Tag System</strong>: Supports adding tags to data sources for routing and filtering</li>
</ul>
<h2 id="supported-source-types"><a class="header" href="#supported-source-types">Supported Source Types</a></h2>
<h3 id="built-in-sources"><a class="header" href="#built-in-sources">Built-in Sources</a></h3>
<ul>
<li><strong>file</strong>: File input, supports monitoring and polling</li>
<li><strong>syslog</strong>: Syslog protocol input (UDP/TCP)</li>
<li><strong>tcp</strong>: Protocol input</li>
</ul>
<h3 id="extension-sources"><a class="header" href="#extension-sources">Extension Sources</a></h3>
<ul>
<li><strong>kafka</strong>: Apache Kafka message queue input</li>
</ul>
<h2 id="configuration-rules"><a class="header" href="#configuration-rules">Configuration Rules</a></h2>
<h3 id="basic-rules"><a class="header" href="#basic-rules">Basic Rules</a></h3>
<ul>
<li>Only supports <code>[[sources]] + connect/params</code> format</li>
<li>Override keys must be in connector <code>allow_override</code> whitelist; exceeding causes error</li>
<li><code>enable</code> field controls whether to enable (default true)</li>
<li><code>tags</code> field supports adding data source tags</li>
</ul>
<h3 id="configuration-structure"><a class="header" href="#configuration-structure">Configuration Structure</a></h3>
<pre><code class="language-toml">[[sources]]
key = "source_identifier"           # Unique identifier for the source
connect = "connector_id"            # Referenced connector ID
enable = true                       # Whether to enable (optional, default true)
tags = ["source:tag1", "type:log"]  # Tags (optional)
params = {                 # Parameter override (optional)
    # Override connector parameters
}
</code></pre>
<h2 id="configuration-examples"><a class="header" href="#configuration-examples">Configuration Examples</a></h2>
<h3 id="minimal-example"><a class="header" href="#minimal-example">Minimal Example</a></h3>
<pre><code class="language-toml">[[sources]]
key = "file_1"
connect = "file_src"
params = { base = "data/in_dat", file = "gen.dat" }
</code></pre>
<h3 id="file-input-example"><a class="header" href="#file-input-example">File Input Example</a></h3>
<pre><code class="language-toml"># models/sources/wpsrc.toml
[[sources]]
key = "access_log"
connect = "file_src"
params = {
    base = "./logs",
    file = "access.log",
    encode = "text"
}
tags = ["type:access", "env:prod"]
</code></pre>
<h3 id="syslog-input-example"><a class="header" href="#syslog-input-example">Syslog Input Example</a></h3>
<pre><code class="language-toml">
# models/sources/wpsrc.toml
[[sources]]
key = "syslog_udp"
connect = "syslog_udp_src"
params = {
    port = 1514,
    header_mode = "parse",
    prefer_newline = true
}
tags = ["protocol:syslog", "transport:udp"]
</code></pre>
<h3 id="tcp-input-example-generic-tcp-linelength-framing"><a class="header" href="#tcp-input-example-generic-tcp-linelength-framing">TCP Input Example (Generic TCP Line/Length Framing)</a></h3>
<pre><code class="language-toml">
# models/sources/wpsrc.toml
[[sources]]
key = "tcp_in"
connect = "tcp_src"
enable = true
params= {
  port = 19000,
  framing = "auto",
  prefer_newline = true
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sink-configuration"><a class="header" href="#sink-configuration">Sink Configuration</a></h1>
<h2 id="directory-and-file-organization"><a class="header" href="#directory-and-file-organization">Directory and File Organization</a></h2>
<ul>
<li>
<p>sink_root: Typically <code>&lt;case&gt;/sink</code> within use cases</p>
<ul>
<li>business.d/**/*.toml: Business group routes (scenario outputs, supports subdirectories)</li>
<li>infra.d/**/*.toml: Infrastructure group routes (default/miss/residue/intercept/error/monitor, supports subdirectories)</li>
<li>defaults.toml: Default group-level expectations [defaults.expect]</li>
</ul>
</li>
<li>
<p>connectors/sink.d/*.toml: Connector definitions (loader searches upward from sink_root for the nearest such directory)</p>
</li>
</ul>
<h2 id="route-file-format"><a class="header" href="#route-file-format">Route File Format</a></h2>
<ul>
<li>Top level
<ul>
<li>version (optional)</li>
<li>sink_group
<ul>
<li>name: Group name (string)</li>
<li>oml / rule: Flat notation recommended; can be string or string array; used for matching models or rules</li>
<li>expect: Optional, group-level expectation (overrides defaults)</li>
<li>sinks: Array, each item is a single sink definition</li>
</ul>
</li>
</ul>
</li>
<li>Single sink fields
<ul>
<li>name: Name of this sink (unique within group); falls back to [index] if not provided</li>
<li>connect: References connector id (backward compatible with <code>use</code>/<code>connector</code>)</li>
<li>params: Whitelist override of connector default parameters (keys must be in connector allow_override list)</li>
<li>expect: Optional, single sink expectation (only ratio/tol/min/max, mutually exclusive: ratio/tol and min/max cannot be mixed)</li>
<li>filter: Optional, interception condition file path; when evaluated to true, data is dropped from this sink and sent to intercept</li>
</ul>
</li>
</ul>
<h2 id="configuration-examples-1"><a class="header" href="#configuration-examples-1">Configuration Examples:</a></h2>
<h3 id="infrastructure-group"><a class="header" href="#infrastructure-group">Infrastructure Group</a></h3>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "intercept"

[[sink_group.sinks]]
name = "intercept"
connect = "file_kv_sink"
params = { base = "./out", file = "intercept.dat" }
</code></pre>
<h3 id="business-group-filter"><a class="header" href="#business-group-filter">Business Group (filter)</a></h3>
<pre><code class="language-toml">version = "2.0"

[sink_group]
name = "/sink/filter"
oml  = ["/oml/sh*"]

[[sink_group.sinks]]
name = "all"
connect = "file_kv_sink"
params = { base = "./out/sink", file = "all.dat" }

[[sink_group.sinks]]
name = "safe"
connect = "file_kv_sink"
filter = "./sink/business.d/filter.conf"   # Match -&gt; intercept, not written to safe
params = { base = "./out/sink", file = "safe.dat" }
</code></pre>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<ul>
<li>Naming Rules
<ul>
<li>Group name: sink_group.name (e.g., /sink/example/simple)</li>
<li>Sink name: name (unique within group; falls back to [0]/[1]/… by index when not explicitly provided)</li>
</ul>
</li>
<li>Filter Semantics
<ul>
<li>filter is an “interception condition”: when the expression evaluates to true, the data is not written to that sink, but forwarded to the infrastructure group intercept (framework/intercept)</li>
<li>Each sink can independently set filter; independent of expect</li>
</ul>
</li>
</ul>
<h2 id="validation-tips"><a class="header" href="#validation-tips">Validation Tips</a></h2>
<ul>
<li>Denominator determination:
<ul>
<li>basis = total_input: Total input</li>
<li>basis = group_input: Sum of line counts of each sink in the group (or group input in stats)</li>
<li>basis = model: Statistics by model granularity (currently substituted by sum of sink line counts within group)</li>
</ul>
</li>
<li>min_samples: When denominator is 0 or less than this value, group validation is ignored (prints warning, does not fail)</li>
<li>When route writes to non-file type fmt, validate will indicate “fmt is determined by backend, ignored”.</li>
</ul>
<h2 id="common-troubleshooting"><a class="header" href="#common-troubleshooting">Common Troubleshooting</a></h2>
<ul>
<li>Connector not found: Check if corresponding id exists in connectors/sink.d; <code>wproj sinks list</code> shows reference relationships</li>
<li>Override parameters not effective: Check allow_override whitelist</li>
<li>Filter not effective:
<ul>
<li>Path resolution is relative to current working directory (recommend writing relative path from sink_root)</li>
<li>Logs will print “found path/not found filter …”</li>
<li>Expression syntax must pass TCondParser; test with simple expressions first</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpgen-configuration"><a class="header" href="#wpgen-configuration">Wpgen Configuration</a></h1>
<p>wpgen is a data generation tool for generating test data based on rules or samples.</p>
<h2 id="basic-configuration"><a class="header" href="#basic-configuration">Basic Configuration</a></h2>
<p>Configuration file path: <code>conf/wpgen.toml</code></p>
<pre><code class="language-toml">version = "1.0"

[generator]
mode = "sample"          # Generation mode: rule | sample
count = 1000             # Total number of records to generate (optional)
duration_secs = 60       # Generation duration in seconds (optional, mutually exclusive with count)
speed = 1000             # Constant rate (rows/sec), 0 for unlimited
parallel = 1             # Parallelism
rule_root = "./rules"    # Rules directory (used when mode=rule)
sample_pattern = "*.txt" # Sample file matching pattern (used when mode=sample)

[output]
# References connector id in connectors/sink.d
connect = "file_kv_sink"
name = "gen_out"
# Override connector parameters (only keys in allow_override whitelist)
params = { base = "./src_dat", file = "gen.dat" }

[logging]
level = "warn"
output = "file"
file_path = "./data/logs/"
</code></pre>
<h2 id="dynamic-speed-profiles"><a class="header" href="#dynamic-speed-profiles">Dynamic Speed Profiles</a></h2>
<p>In addition to using the <code>speed</code> field for constant rate, you can use <code>speed_profile</code> to configure dynamic speed variation models.
When <code>speed_profile</code> is present, the <code>speed</code> field will be ignored.</p>
<h3 id="constant-rate-constant"><a class="header" href="#constant-rate-constant">Constant Rate (constant)</a></h3>
<p>Generate data at a fixed rate.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "constant"
rate = 5000              # Rows per second
</code></pre>
<h3 id="sinusoidal-sinusoidal"><a class="header" href="#sinusoidal-sinusoidal">Sinusoidal (sinusoidal)</a></h3>
<p>Rate fluctuates periodically following a sine curve, simulating cyclical load changes.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "sinusoidal"
base = 5000              # Base rate (rows/sec)
amplitude = 2000         # Fluctuation amplitude (rows/sec)
period_secs = 60.0       # Period length (seconds)
</code></pre>
<p>Rate range: <code>[base - amplitude, base + amplitude]</code>, i.e., 3000-7000 rows/sec in the above example.</p>
<h3 id="stepped-stepped"><a class="header" href="#stepped-stepped">Stepped (stepped)</a></h3>
<p>Rate changes according to predefined step sequences, suitable for simulating phased load testing.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "stepped"
# Format: [[duration(sec), rate], ...]
steps = [
    [30.0, 1000],        # First 30 seconds: 1000 rows/sec
    [30.0, 5000],        # Next 30 seconds: 5000 rows/sec
    [30.0, 2000]         # Last 30 seconds: 2000 rows/sec
]
loop_forever = true      # Whether to loop (default false)
</code></pre>
<h3 id="burst-mode-burst"><a class="header" href="#burst-mode-burst">Burst Mode (burst)</a></h3>
<p>Randomly trigger high-speed bursts on top of the base rate, simulating burst traffic scenarios.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "burst"
base = 1000              # Base rate (rows/sec)
burst_rate = 10000       # Rate during burst (rows/sec)
burst_duration_ms = 500  # Burst duration (milliseconds)
burst_probability = 0.05 # Probability of triggering burst per second (0.0-1.0)
</code></pre>
<h3 id="ramp-mode-ramp"><a class="header" href="#ramp-mode-ramp">Ramp Mode (ramp)</a></h3>
<p>Rate changes linearly from start value to target value, suitable for progressive stress testing.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "ramp"
start = 100              # Starting rate (rows/sec)
end = 10000              # Target rate (rows/sec)
duration_secs = 300.0    # Ramp duration (seconds)
</code></pre>
<p>The rate will be maintained at the target value after reaching it. Supports both forward (increasing) and reverse (decreasing) ramps.</p>
<h3 id="random-walk-random_walk"><a class="header" href="#random-walk-random_walk">Random Walk (random_walk)</a></h3>
<p>Rate fluctuates randomly around the base value, simulating irregular load.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "random_walk"
base = 5000              # Base rate (rows/sec)
variance = 0.3           # Fluctuation range (0.0-1.0), 0.3 means ±30%
</code></pre>
<p>Rate range: <code>[base * (1 - variance), base * (1 + variance)]</code></p>
<h3 id="composite-mode-composite"><a class="header" href="#composite-mode-composite">Composite Mode (composite)</a></h3>
<p>Combine multiple speed profiles with various combination methods.</p>
<pre><code class="language-toml">[generator.speed_profile]
type = "composite"
combine_mode = "average" # Combination method: average | max | min | sum

# Sub-profile list
[[generator.speed_profile.profiles]]
type = "sinusoidal"
base = 5000
amplitude = 2000
period_secs = 60.0

[[generator.speed_profile.profiles]]
type = "random_walk"
base = 5000
variance = 0.1
</code></pre>
<p>Combination methods:</p>
<ul>
<li><code>average</code>: Average of all sub-profile rates (default)</li>
<li><code>max</code>: Maximum of all sub-profile rates</li>
<li><code>min</code>: Minimum of all sub-profile rates</li>
<li><code>sum</code>: Sum of all sub-profile rates</li>
</ul>
<h2 id="configuration-examples-2"><a class="header" href="#configuration-examples-2">Configuration Examples</a></h2>
<h3 id="example-1-simple-constant-rate"><a class="header" href="#example-1-simple-constant-rate">Example 1: Simple Constant Rate</a></h3>
<pre><code class="language-toml">version = "1.0"

[generator]
mode = "sample"
count = 10000
speed = 5000
parallel = 2

[output]
connect = "file_json_sink"
params = { base = "./data", file = "output.dat" }

[logging]
level = "info"
output = "file"
file_path = "./logs"
</code></pre>
<h3 id="example-2-progressive-stress-test"><a class="header" href="#example-2-progressive-stress-test">Example 2: Progressive Stress Test</a></h3>
<pre><code class="language-toml">version = "1.0"

[generator]
mode = "rule"
duration_secs = 600      # Run for 10 minutes
parallel = 4
rule_root = "./rules"

[generator.speed_profile]
type = "ramp"
start = 100
end = 20000
duration_secs = 300.0    # Ramp from 100 to 20000 in 5 minutes

[output]
connect = "kafka_sink"
params = { topic = "test-topic" }

[logging]
level = "warn"
output = "file"
file_path = "./logs"
</code></pre>
<h3 id="example-3-simulating-real-business-load"><a class="header" href="#example-3-simulating-real-business-load">Example 3: Simulating Real Business Load</a></h3>
<pre><code class="language-toml">version = "1.0"

[generator]
mode = "sample"
duration_secs = 3600     # Run for 1 hour
parallel = 8

[generator.speed_profile]
type = "composite"
combine_mode = "average"

# Base periodic fluctuation (simulating day/night traffic difference)
[[generator.speed_profile.profiles]]
type = "sinusoidal"
base = 10000
amplitude = 5000
period_secs = 300.0

# Overlay random noise
[[generator.speed_profile.profiles]]
type = "random_walk"
base = 10000
variance = 0.15

[output]
connect = "tcp_sink"
params = { host = "127.0.0.1", port = 9000 }

[logging]
level = "info"
output = "both"
file_path = "./logs"
</code></pre>
<h2 id="runtime-rules"><a class="header" href="#runtime-rules">Runtime Rules</a></h2>
<ul>
<li>
<p>When <code>wpgen</code> loads <code>conf/wpgen.toml</code>, if it detects <code>[output].connect</code>:</p>
<ul>
<li>It searches upward from <code>ENGINE_CONF.sink_root</code> for the nearest <code>connectors/sink.d/</code> directory</li>
<li>Reads the target connector and merges with <code>params</code> (only keys in <code>allow_override</code> are allowed)</li>
</ul>
</li>
<li>
<p>When <code>parallel &gt; 1</code> is configured, the speed profile will automatically distribute by parallelism to ensure the total rate meets expectations</p>
</li>
<li>
<p><code>count</code> and <code>duration_secs</code> are mutually exclusive:</p>
<ul>
<li>When <code>count</code> is set, generation stops after the specified number of records</li>
<li>When <code>duration_secs</code> is set, generation stops after the specified duration</li>
<li>When neither is set, generation continues until manually stopped</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="knowdb-configuration"><a class="header" href="#knowdb-configuration">KnowDB Configuration</a></h1>
<p>This guide describes the directory-based configuration and loading specification for the Knowledge Database (KnowDB).</p>
<p>Applicable Scope</p>
<ul>
<li>Initialize authoritative database (CSV -&gt; SQLite), used for loading by wparse/wproj and other tools at startup</li>
</ul>
<p>Core Principles</p>
<ul>
<li>External SQL: DDL/DML for each table is placed in .sql files in the corresponding directory</li>
<li>Security: Runtime only allows access to table names declared in configuration; SQL only supports {table} placeholder</li>
<li>Ready to use by default: Most fields can be omitted; built-in defaults and auto-detection satisfy common scenarios</li>
</ul>
<p>Directory Layout (Recommended)</p>
<pre><code>models/knowledge/
  knowdb.toml                     # This configuration
  example/
    create.sql
    insert.sql
    data.csv                     # Single data file (table directory root)
  address/
    create.sql
    insert.sql
    data.csv
</code></pre>
<p>Top-level Configuration (models/knowledge/knowdb.toml)</p>
<pre><code class="language-toml">version = 2

[[tables]]
name = "example"
# dir defaults to name when omitted; this example uses directory models/knowledge/example
# data_file defaults to data.csv in table directory when omitted
columns.by_header = ["name", "pinying"]

# To add more tables, append [[tables]] sections
</code></pre>
<p>SQL File Specifications</p>
<ul>
<li>create.sql: Table creation statement, must exist; can use placeholder <code>{table}</code>; allows multiple statements (e.g., <code>CREATE INDEX</code>)</li>
<li>insert.sql: Insert statement, must exist; parameter positions use <code>?1..?N</code>; allows <code>{table}</code></li>
<li>clean.sql: Optional; if not present, <code>DELETE FROM {table}</code> is executed by default before loading</li>
</ul>
<p>Column Mapping (columns)</p>
<ul>
<li>Recommended <code>by_header=[..]</code>, maps CSV header names to columns in <code>insert.sql</code></li>
<li>If <code>has_header=false</code>, must provide <code>by_index=[..]</code></li>
<li>Optional enhancement (implementation layer): If columns not configured and <code>insert.sql</code> explicitly lists columns, can parse insert column names as <code>by_header</code></li>
</ul>
<p>Loading Strategy (defaults can be omitted)</p>
<ul>
<li>Defaults: <code>transaction=true</code>, <code>batch_size=2000</code>, <code>on_error="fail"</code></li>
<li>on_error:
<ul>
<li>fail: Fails and rolls back on bad row (missing columns/parse failure)</li>
<li>skip: Skips bad rows and counts warnings</li>
</ul>
</li>
</ul>
<p>Auto-detection (when data_file is not configured)</p>
<ul>
<li>Uses <code>{base_dir}/{tables.dir}/data.csv</code></li>
<li>Reports error if not exists</li>
</ul>
<p>Security Constraints</p>
<ul>
<li>Runtime (facade/query_cipher/SQL evaluation) only allows table names declared in <code>[[tables]].name</code></li>
<li>SQL templates only allow <code>{table}</code> placeholder; other dynamic concatenation is prohibited</li>
</ul>
<p>Minimal Runnable Example</p>
<ol>
<li>Directory</li>
</ol>
<pre><code>models/knowledge/knowdb.toml
models/knowledge/example/{create.sql, insert.sql, data.csv}
</code></pre>
<ol start="2">
<li>create.sql</li>
</ol>
<pre><code class="language-sql">CREATE TABLE IF NOT EXISTS {table} (
  id      INTEGER PRIMARY KEY,
  name    TEXT NOT NULL,
  pinying TEXT NOT NULL
);
</code></pre>
<ol start="3">
<li>insert.sql</li>
</ol>
<pre><code class="language-sql">INSERT INTO {table} (name, pinying) VALUES (?1, ?2);
</code></pre>
<ol start="4">
<li>data.csv</li>
</ol>
<pre><code>name,pinying
令狐冲,linghuchong
任盈盈,renyingying
</code></pre>
<ol start="5">
<li>knowdb.toml (minimal)</li>
</ol>
<pre><code class="language-toml">version = 2
base_dir = "./models/knowledge"
[[tables]]
name = "example"
dir  = "example"
columns.by_header = ["name", "pinying"]
[tables.expected_rows]
min = 1
max = 100
</code></pre>
<p>Common Errors and Troubleshooting</p>
<ul>
<li>Missing create.sql / insert.sql: Fails at startup and points to missing file</li>
<li><code>has_header=false</code> but <code>by_index</code> not provided: Loading error</li>
<li><code>expected_rows.min</code> not satisfied: Insufficient data, loading fails</li>
<li>Data source not found: Neither <code>data_file</code> configured nor default path <code>data.csv</code> exists</li>
<li>Runtime SQL accesses undeclared table: Security validation fails</li>
</ul>
<p>Relationship with Applications</p>
<ul>
<li>wparse/wproj etc. load knowdb at startup: Create authoritative database and set up Query Provider</li>
<li><code>query_cipher(table)</code> (loading single-column word list) formerly used by privacy module is disabled by default in current version; implement desensitization on business side if needed</li>
</ul>
<p>Built-in SQL Functions (UDF)</p>
<ul>
<li>Runtime registration:
<ul>
<li>Both import phase (authoritative database write connection) and query phase (thread-cloned read-only connection) automatically register.</li>
<li>Can be used directly in <code>INSERT/SELECT/WHERE</code> (not involved in DDL).</li>
</ul>
</li>
<li>Signatures and Semantics:
<ul>
<li><code>ip4_int(text) -&gt; integer</code>: Dotted IPv4 to 32-bit integer; tolerates whitespace/quotes; returns <code>0</code> on invalid input.</li>
<li><code>ip4_between(ip_text, start_text, end_text) -&gt; integer</code>: Whether in closed interval <code>[start,end]</code> (1/0).</li>
<li><code>cidr4_min(text) -&gt; integer</code>: CIDR start address (inclusive), e.g., <code>10.0.0.0/8</code>.</li>
<li><code>cidr4_max(text) -&gt; integer</code>: CIDR end address (inclusive).</li>
<li><code>cidr4_contains(ip_text, cidr_text) -&gt; integer</code>: Whether IP falls within CIDR range (1/0).</li>
<li><code>ip4_text(integer|string) -&gt; text</code>: 32-bit integer to dotted IPv4 (useful for debugging/display).</li>
<li><code>trim_quotes(text) -&gt; text</code>: Removes paired quotes (’ or “) at both ends, tolerates surrounding whitespace; returns original (whitespace trimmed) if not paired.</li>
</ul>
</li>
<li>Import Example (insert.sql):
<pre><code class="language-sql">INSERT INTO {table} (ip_start_int, ip_end_int, zone)
VALUES (ip4_int(?1), ip4_int(?2), trim_quotes(?3));
</code></pre>
</li>
<li>Query Example (regular SQL):
<pre><code class="language-sql">-- Range match (recommended integer comparison, avoid directly comparing function returns in WHERE)
SELECT zone FROM zone
WHERE ip_start_int &lt;= ip4_int(:ip)
  AND ip_end_int   &gt;= ip4_int(:ip)
LIMIT 1;

-- CIDR match
SELECT zone FROM zone
WHERE cidr4_contains(:ip, :cidr) = 1;

-- Debug output
SELECT ip4_text(ip_start_int) AS ip_start, ip4_text(ip_end_int) AS ip_end, zone
FROM zone
LIMIT 5;
</code></pre>
</li>
<li>OML SQL Exact Evaluation:
<ul>
<li>OML’s <code>select ... from ... where ...;</code> syntax has identifier whitelist restrictions on column segments, not recommended to write functions directly in column segments.</li>
<li>Recommended to produce numeric IP upstream (e.g., <code>src_ip_int</code>) and use integer comparison in OML where:
<pre><code class="language-sql">from_zone: chars = sql(
  select zone from zone
  where ip_start_int &lt;= read(src_ip_int)
    and ip_end_int   &gt;= read(src_ip_int);
)
</code></pre>
</li>
</ul>
</li>
<li>Notes:
<ul>
<li>Currently invalid IPv4/CIDR input returns <code>0</code> (or match failure) for import resilience; customize if strict behavior needed.</li>
<li>SQLite natively provides <code>lower/upper/trim</code> and other string functions, can be combined with above UDFs.</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="logging-configuration"><a class="header" href="#logging-configuration">Logging Configuration</a></h1>
<p>This document provides practical guidance for users and frontline developers on enabling/adjusting logging and troubleshooting common issues in Warp Parse.</p>
<ul>
<li>For target domains, see “Developer Documentation: Logging Targets And Levels”.</li>
<li>File logging defaults to rotation: 10MB/10 files, gzip compression.</li>
</ul>
<h2 id="quick-start-2"><a class="header" href="#quick-start-2">Quick Start</a></h2>
<h3 id="wparse--wprescue-confwparsetoml"><a class="header" href="#wparse--wprescue-confwparsetoml">wparse / wprescue (conf/wparse.toml)</a></h3>
<p>Production Recommended (file output + low noise):</p>
<pre><code class="language-toml">[log_conf]
output = "File"   # Console|File|Both
level  = "warn,ctrl=info,dfx=info"
[log_conf.file]
path = "./data/logs"   # Directory is created automatically; filename is automatically named after executable, e.g., wparse.log
</code></pre>
<p>Local Debugging (output to console simultaneously):</p>
<pre><code class="language-toml">[log_conf]
output = "Both"
level  = "debug"
[log_conf.file]
path = "./data/logs"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-rule-language"><a class="header" href="#wpl-rule-language">WPL Rule Language</a></h1>
<p>WPL (Warp Processing Language) is the rule language used by the Warp Parse parsing subsystem (warp-parse) to describe field extraction, protocol parsing, and simple decision logic.</p>
<hr>
<h2 id="-documentation-navigation"><a class="header" href="#-documentation-navigation">📚 Documentation Navigation</a></h2>
<h3 id="by-learning-path"><a class="header" href="#by-learning-path">By Learning Path</a></h3>
<pre><code>🆕 Beginners
   ↓
01-quickstart.md ────→ Get started in 5 minutes, copy and use
   ↓
07-complete-types-example.md ──→ 🌟 Complete feature demo (Highly recommended)
   ↓
02-core-concepts.md ──→ Understand design philosophy and core concepts
   ↓
03-practical-guide.md → Find solutions by task
   ↓
04-language-reference.md → Look up types and syntax
   ↓
05-functions-reference.md → Look up functions
</code></pre>
<h3 id="by-user-role"><a class="header" href="#by-user-role">By User Role</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>I am…</th><th>Recommended Reading</th></tr>
</thead>
<tbody>
<tr><td><strong>WPL Beginner</strong></td><td><a href="#wpl-quick-start">01-quickstart.md</a> → <a href="#wpl-core-concepts">02-core-concepts.md</a></td></tr>
<tr><td><strong>Daily User</strong></td><td><a href="#wpl-practical-guide">03-practical-guide.md</a> - Find by task</td></tr>
<tr><td><strong>Developer/Integration</strong></td><td><a href="#wpl-language-reference">04-language-reference.md</a> + <a href="#wpl-functions-reference">05-functions-reference.md</a></td></tr>
<tr><td><strong>Compiler Developer</strong></td><td><a href="#wpl-grammar-reference-ebnf">06-grammar-reference.md</a> - EBNF grammar</td></tr>
</tbody>
</table>
</div>
<h3 id="find-by-task"><a class="header" href="#find-by-task">Find by Task</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>I want to…</th><th>See Document</th></tr>
</thead>
<tbody>
<tr><td>🚀 Quick start</td><td><a href="#wpl-quick-start">01-quickstart.md</a></td></tr>
<tr><td>🎯 <strong>View complete type examples</strong></td><td><strong><a href="#wpl-complete-type-system-example">07-complete-types-example.md</a></strong></td></tr>
<tr><td>💡 Understand concepts</td><td><a href="#wpl-core-concepts">02-core-concepts.md</a></td></tr>
<tr><td>📝 Parse Nginx logs</td><td><a href="#1-parse-web-server-logs">03-practical-guide.md § 1</a></td></tr>
<tr><td>📊 Parse JSON data</td><td><a href="#2-parse-json-data">03-practical-guide.md § 2</a></td></tr>
<tr><td>🔑 Parse KV pairs</td><td><a href="#3-parse-kv-pairs">03-practical-guide.md § 3</a></td></tr>
<tr><td>🔐 Handle Base64 encoding</td><td><a href="#4-handle-encoded-data">03-practical-guide.md § 4</a></td></tr>
<tr><td>✅ Validate fields</td><td><a href="#5-field-validation--filtering">03-practical-guide.md § 5</a></td></tr>
<tr><td>🔍 Look up a type</td><td><a href="#-type-system">04-language-reference.md § Type System</a></td></tr>
<tr><td>⚙️ Look up a function</td><td><a href="#wpl-functions-reference">05-functions-reference.md</a></td></tr>
<tr><td>📖 Look up syntax rules</td><td><a href="#wpl-grammar-reference-ebnf">06-grammar-reference.md</a></td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="-document-list"><a class="header" href="#-document-list">📖 Document List</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Document</th><th>Content</th><th>Target Audience</th></tr>
</thead>
<tbody>
<tr><td><a href="#wpl-quick-start">01-quickstart.md</a></td><td>5-minute quick start + 3 most common scenarios + exercises</td><td>Everyone</td></tr>
<tr><td><strong><a href="#wpl-complete-type-system-example">07-complete-types-example.md</a></strong></td><td><strong>Complete type system example - 23 types quick reference</strong></td><td><strong>Everyone</strong></td></tr>
<tr><td><a href="#wpl-core-concepts">02-core-concepts.md</a></td><td>Design philosophy + type system + matching semantics + pipeline system</td><td>Users who want deep understanding</td></tr>
<tr><td><a href="#wpl-practical-guide">03-practical-guide.md</a></td><td>Task-organized practical examples + common issues</td><td>Daily users</td></tr>
<tr><td><a href="#wpl-language-reference">04-language-reference.md</a></td><td>Complete type list + syntax elements + quick reference</td><td>Developers</td></tr>
<tr><td><a href="#wpl-functions-reference">05-functions-reference.md</a></td><td>Standardized reference for all functions</td><td>Developers</td></tr>
<tr><td><a href="#wpl-grammar-reference-ebnf">06-grammar-reference.md</a></td><td>EBNF formal grammar definition</td><td>Compiler developers</td></tr>
</tbody>
</table>
</div>
<hr>
<h2 id="-quick-examples"><a class="header" href="#-quick-examples">⚡ Quick Examples</a></h2>
<h3 id="nginx-access-log"><a class="header" href="#nginx-access-log">Nginx Access Log</a></h3>
<pre><code class="language-wpl">package nginx {
  rule access_log {
    (
      ip:client_ip,
      2*_,
      time/clf&lt;[,]&gt;:time,
      http/request":request,
      digit:status,
      digit:bytes
    )
  }
}
</code></pre>
<h3 id="json-api-response"><a class="header" href="#json-api-response">JSON API Response</a></h3>
<pre><code class="language-wpl">package api {
  rule response {
    (json(
      chars@user,
      digit@code,
      chars@message
    ))
  }
}
</code></pre>
<h3 id="huawei-firewall-log-base64"><a class="header" href="#huawei-firewall-log-base64">Huawei Firewall Log (Base64)</a></h3>
<pre><code class="language-wpl">package firewall {
  rule huawei_log {
    |decode/base64|
    (
      digit:id,
      time:timestamp,
      sn:serial,
      chars:type\:,
      opt(kvarr),
      kvarr
    )
  }
}
</code></pre>
<p>For more examples, see: <a href="#wpl-quick-start">01-quickstart.md</a> and <a href="#wpl-practical-guide">03-practical-guide.md</a></p>
<hr>
<h2 id="-complete-type-system-example"><a class="header" href="#-complete-type-system-example">🎯 Complete Type System Example</a></h2>
<p><strong>Want to quickly understand all data types supported by WPL?</strong></p>
<p>👉 <strong><a href="#wpl-complete-type-system-example">View Complete Type Example</a></strong> - One example demonstrating 23 major data types</p>
<p>This document includes:</p>
<ul>
<li>✅ <strong>Complete runnable</strong> input data + WPL rules + output results</li>
<li>✅ <strong>23 types</strong>: Basic, time, network, structured, protocol, encoding</li>
<li>✅ <strong>Detailed explanation for each type</strong>: Syntax, examples, use cases</li>
<li>✅ <strong>Common combination patterns</strong>: Copy-and-use type combinations</li>
</ul>
<p><strong>Suitable for:</strong></p>
<ul>
<li>🆕 Beginners to quickly understand WPL capabilities</li>
<li>📚 Developers as a type quick reference manual</li>
<li>🔍 Quick lookup when encountering unfamiliar data formats</li>
</ul>
<hr>
<h2 id="-core-features"><a class="header" href="#-core-features">🎯 Core Features</a></h2>
<ul>
<li><strong>Declarative</strong>: Describe “what it is” rather than “how to do it”</li>
<li><strong>Type-Safe</strong>: Automatic validation and conversion (IP, time, JSON, etc.)</li>
<li><strong>Composable</strong>: Small rules combine into complex rules</li>
<li><strong>Powerful Pipelines</strong>: Preprocessing (Base64/Hex decoding) + field-level validation</li>
<li><strong>Flexible Matching</strong>: Sequential, alternative, optional, repetitive</li>
<li><strong>Subfield Extraction</strong>: JSON/KV nested fields</li>
</ul>
<hr>
<h2 id="-quick-help"><a class="header" href="#-quick-help">💬 Quick Help</a></h2>
<h3 id="common-questions"><a class="header" href="#common-questions">Common Questions</a></h3>
<p><strong>Q: Where should I start learning?</strong>
A: Start with <a href="#wpl-quick-start">01-quickstart.md</a>, get started in 5 minutes.</p>
<p><strong>Q: How do I parse my log format?</strong>
A: Check <a href="#wpl-practical-guide">03-practical-guide.md</a>, find a similar scenario and adjust.</p>
<p><strong>Q: How do I use a specific type/function?</strong>
A: See <a href="#wpl-language-reference">04-language-reference.md</a> or <a href="#wpl-functions-reference">05-functions-reference.md</a>.</p>
<p><strong>Q: How do I debug parsing failures?</strong>
A: Refer to <a href="#quick-debugging-tips">01-quickstart.md § Debugging Tips</a> or <a href="#7-common-issues">03-practical-guide.md § Common Issues</a>.</p>
<hr>
<p><strong>Start Learning:</strong> <a href="#wpl-quick-start">01-quickstart.md</a> - 5-minute quick start</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-complete-type-system-example"><a class="header" href="#wpl-complete-type-system-example">WPL Complete Type System Example</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/07-complete-types-example.md</code></p>
</blockquote>
<hr>
<blockquote>
<p>One example demonstrating all major WPL data types</p>
</blockquote>
<p>This document provides a complete, runnable WPL rule example showcasing 23 major data types. This is the <strong>best reference</strong> for learning the WPL type system.</p>
<h2 id="type-coverage-checklist"><a class="header" href="#type-coverage-checklist">Type Coverage Checklist</a></h2>
<p>This example includes the following types:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Included Types</th><th>Count</th></tr>
</thead>
<tbody>
<tr><td><strong>Basic Types</strong></td><td><code>peek_symbol</code>, <code>symbol</code>, <code>bool</code>, <code>chars</code>, <code>digit</code>, <code>float</code>, <code>_</code></td><td>7</td></tr>
<tr><td><strong>Time Types</strong></td><td><code>time_3339</code>, <code>time_2822</code>, <code>time/clf</code>, <code>time_timestamp</code></td><td>4</td></tr>
<tr><td><strong>Network Types</strong></td><td><code>ip</code>, <code>ip_net</code>, <code>port</code></td><td>3</td></tr>
<tr><td><strong>Structured Types</strong></td><td><code>kvarr</code>, <code>json</code></td><td>2</td></tr>
<tr><td><strong>Protocol Types</strong></td><td><code>http/request</code>, <code>http/status</code>, <code>http/agent</code>, <code>http/method</code></td><td>4</td></tr>
<tr><td><strong>Encoding Types</strong></td><td><code>hex</code>, <code>base64</code></td><td>2</td></tr>
<tr><td><strong>Special Types</strong></td><td><code>sn</code></td><td>1</td></tr>
<tr><td><strong>Total</strong></td><td></td><td><strong>23 types</strong></td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-quick-start"><a class="header" href="#wpl-quick-start">WPL Quick Start</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/01-quickstart.md</code></p>
</blockquote>
<hr>
<p>Get started with WPL in 5 minutes and start parsing your log data immediately.</p>
<h2 id="what-is-wpl"><a class="header" href="#what-is-wpl">What is WPL?</a></h2>
<p>WPL (Warp Processing Language) is a <strong>declarative rule language</strong> for describing how to <strong>extract fields</strong> and <strong>parse structures</strong> from text data such as logs and messages.</p>
<h3 id="core-features"><a class="header" href="#core-features">Core Features</a></h3>
<ul>
<li><strong>Declarative</strong>: Describe “what data is” rather than “how to extract”</li>
<li><strong>Type-Safe</strong>: Automatic validation and conversion (IP, time, JSON, and 37 types)</li>
<li><strong>Powerful &amp; Flexible</strong>: Support for JSON/KV nested extraction, Base64 decoding, field validation</li>
<li><strong>Easy to Learn</strong>: Get started with basics in 5 minutes</li>
</ul>
<h3 id="use-cases"><a class="header" href="#use-cases">Use Cases</a></h3>
<ul>
<li>Parse web server logs (Nginx, Apache)</li>
<li>Extract JSON/KV structured data</li>
<li>Process encoded data (Base64, Hex)</li>
<li>Parse firewall and security device logs</li>
<li>Custom log format parsing</li>
</ul>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-core-concepts"><a class="header" href="#wpl-core-concepts">WPL Core Concepts</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/02-core-concepts.md</code></p>
</blockquote>
<hr>
<p>This document helps you understand WPL’s design philosophy and core concepts, building the right mental model.</p>
<h2 id="quick-navigation"><a class="header" href="#quick-navigation">Quick Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Topic</th><th>Content</th></tr>
</thead>
<tbody>
<tr><td><strong>Design Philosophy</strong></td><td>Why WPL is needed, core ideas, declarative design</td></tr>
<tr><td><strong>Type System</strong></td><td>Role of types, type hierarchy, type composition</td></tr>
<tr><td><strong>Matching Semantics</strong></td><td>seq, alt, opt, some_of</td></tr>
<tr><td><strong>Pipeline System</strong></td><td>Preprocessing pipeline, field-level pipeline</td></tr>
<tr><td><strong>Subfields &amp; Nesting</strong></td><td>JSON subfields, KV subfields, arrays</td></tr>
<tr><td><strong>Separator Priority</strong></td><td>Priority rules, separator types</td></tr>
<tr><td><strong>Design Principles</strong></td><td>Declarative, type-safe, composable</td></tr>
<tr><td><strong>Common Misconceptions</strong></td><td>WPL vs regex, field continuity</td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-practical-guide"><a class="header" href="#wpl-practical-guide">WPL Practical Guide</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/03-practical-guide.md</code></p>
</blockquote>
<hr>
<p>This document uses a task-oriented approach to help you quickly find solutions.</p>
<h2 id="task-navigation"><a class="header" href="#task-navigation">Task Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Task Type</th><th>Jump To</th></tr>
</thead>
<tbody>
<tr><td>Parse Web Server Logs</td><td>Nginx/Apache access logs, error logs</td></tr>
<tr><td>Parse JSON Data</td><td>Extract JSON fields, nested JSON</td></tr>
<tr><td>Parse KV Pairs</td><td>Basic KV, nested KV, mixed formats</td></tr>
<tr><td>Handle Encoded Data</td><td>Base64, Hex decoding</td></tr>
<tr><td>Field Validation &amp; Filtering</td><td>Check fields, IP ranges, port ranges</td></tr>
<tr><td>Complex Scenarios</td><td>Variable fields, multiple formats, nested structures</td></tr>
<tr><td>Common Issues</td><td>Debugging tips, performance optimization</td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-language-reference"><a class="header" href="#wpl-language-reference">WPL Language Reference</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/04-language-reference.md</code></p>
</blockquote>
<hr>
<p>This document provides a complete reference for WPL language elements, for quick lookup of types, syntax, and structures.</p>
<h2 id="quick-navigation-1"><a class="header" href="#quick-navigation-1">Quick Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Topic</th><th>Content</th></tr>
</thead>
<tbody>
<tr><td><strong>Type System</strong></td><td>All data type quick reference</td></tr>
<tr><td><strong>Syntax Elements</strong></td><td>Basic structure, field definition, format control</td></tr>
<tr><td><strong>Subfield Syntax</strong></td><td>JSON, KV, array subfields</td></tr>
<tr><td><strong>Annotations</strong></td><td>tag, copy_raw annotations</td></tr>
<tr><td><strong>Syntax Quick Reference</strong></td><td>Common pattern quick reference</td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-functions-reference"><a class="header" href="#wpl-functions-reference">WPL Functions Reference</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/05-functions-reference.md</code></p>
</blockquote>
<hr>
<p>This document provides standardized reference for all WPL functions.</p>
<h2 id="wpl-all-functions-quick-reference"><a class="header" href="#wpl-all-functions-quick-reference">WPL All Functions Quick Reference</a></h2>
<h3 id="preprocessing-pipeline-functions"><a class="header" href="#preprocessing-pipeline-functions">Preprocessing Pipeline Functions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>decode/base64</code></td><td>Decode entire line as Base64</td><td><code>|decode/base64|</code></td></tr>
<tr><td><code>decode/hex</code></td><td>Decode entire line as hexadecimal</td><td><code>|decode/hex|</code></td></tr>
<tr><td><code>unquote/unescape</code></td><td>Remove quotes and unescape</td><td><code>|unquote/unescape|</code></td></tr>
<tr><td><code>plg_pipe/&lt;name&gt;</code></td><td>Custom preprocessing extension</td><td><code>|plg_pipe/dayu|</code></td></tr>
</tbody>
</table>
</div>
<h3 id="selector-functions"><a class="header" href="#selector-functions">Selector Functions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>take(name)</code></td><td>Select specified field as active</td><td><code>|take(name)|</code></td></tr>
<tr><td><code>last()</code></td><td>Select last field as active</td><td><code>|last()|</code></td></tr>
</tbody>
</table>
</div>
<h3 id="field-set-operations-f_-prefix"><a class="header" href="#field-set-operations-f_-prefix">Field Set Operations (f_ prefix)</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>f_has(name)</code></td><td>Check if field exists</td><td><code>|f_has(status)|</code></td></tr>
<tr><td><code>f_chars_has(name, val)</code></td><td>Check field equals string</td><td><code>|f_chars_has(status, success)|</code></td></tr>
<tr><td><code>f_chars_in(name, [...])</code></td><td>Check field in string list</td><td><code>|f_chars_in(method, [GET, POST])|</code></td></tr>
<tr><td><code>f_digit_has(name, num)</code></td><td>Check field equals number</td><td><code>|f_digit_has(code, 200)|</code></td></tr>
<tr><td><code>f_ip_in(name, [...])</code></td><td>Check IP in list</td><td><code>|f_ip_in(client_ip, [127.0.0.1])|</code></td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-grammar-reference-ebnf"><a class="header" href="#wpl-grammar-reference-ebnf">WPL Grammar Reference (EBNF)</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/03-wpl-new/06-grammar-reference.md</code></p>
</blockquote>
<hr>
<p>This document provides the formal grammar definition of WPL, suitable for:</p>
<ul>
<li>Compiler/parser developers</li>
<li>Precise understanding of syntax rules</li>
<li>Tool integration development</li>
</ul>
<p><strong>For regular users, please refer to:</strong></p>
<ul>
<li>Quick Start: <a href="#wpl-quick-start">01-quickstart.md</a></li>
<li>Core Concepts: <a href="#wpl-core-concepts">02-core-concepts.md</a></li>
<li>Practical Guide: <a href="#wpl-practical-guide">03-practical-guide.md</a></li>
<li>Language Reference: <a href="#wpl-language-reference">04-language-reference.md</a></li>
</ul>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-field-functions-index"><a class="header" href="#wpl-field-functions-index">WPL Field Functions Index</a></h1>
<p>This document lists all available field functions in the WP-Motor WPL language.</p>
<h2 id="field-selectors"><a class="header" href="#field-selectors">Field Selectors</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>take</code></td><td><code>take(field_name)</code></td><td>Select the specified field as the active field</td><td>-</td></tr>
<tr><td><code>last</code></td><td><code>last()</code></td><td>Select the last field as the active field</td><td>-</td></tr>
</tbody>
</table>
</div>
<h2 id="string-matching"><a class="header" href="#string-matching">String Matching</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>chars_has</code></td><td><code>chars_has(value)</code></td><td>Check if the string field equals the specified value</td><td>-</td></tr>
<tr><td><code>chars_not_has</code></td><td><code>chars_not_has(value)</code></td><td>Check if the string field does not equal the specified value</td><td>-</td></tr>
<tr><td><code>chars_in</code></td><td><code>chars_in([value1, value2, ...])</code></td><td>Check if the string field is in the value list</td><td>-</td></tr>
<tr><td><code>f_chars_has</code></td><td><code>f_chars_has(target, value)</code></td><td>Check if the specified field equals the specified value</td><td>-</td></tr>
<tr><td><code>f_chars_not_has</code></td><td><code>f_chars_not_has(target, value)</code></td><td>Check if the specified field does not equal the specified value</td><td>-</td></tr>
<tr><td><code>f_chars_in</code></td><td><code>f_chars_in(target, [values])</code></td><td>Check if the specified field is in the value list</td><td>-</td></tr>
<tr><td><code>regex_match</code></td><td><code>regex_match('pattern')</code></td><td>Match the string field using regular expression</td><td><a href="#regex_match-function-guide">📖 Detailed Documentation</a></td></tr>
</tbody>
</table>
</div>
<h2 id="numeric-matching"><a class="header" href="#numeric-matching">Numeric Matching</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>digit_has</code></td><td><code>digit_has(value)</code></td><td>Check if the numeric field equals the specified value</td><td>-</td></tr>
<tr><td><code>digit_in</code></td><td><code>digit_in([value1, value2, ...])</code></td><td>Check if the numeric field is in the value list</td><td>-</td></tr>
<tr><td><code>digit_range</code></td><td><code>digit_range(begin, end)</code></td><td>Check if the number is within the specified range (inclusive)</td><td><a href="#digit_range-function-usage-guide">📖 Detailed Documentation</a></td></tr>
<tr><td><code>f_digit_has</code></td><td><code>f_digit_has(target, value)</code></td><td>Check if the specified field equals the specified numeric value</td><td>-</td></tr>
<tr><td><code>f_digit_in</code></td><td><code>f_digit_in(target, [values])</code></td><td>Check if the specified field is in the numeric value list</td><td>-</td></tr>
</tbody>
</table>
</div>
<h2 id="ip-matching"><a class="header" href="#ip-matching">IP Matching</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>ip_in</code></td><td><code>ip_in([ip1, ip2, ...])</code></td><td>Check if the IP address is in the list</td><td>-</td></tr>
<tr><td><code>f_ip_in</code></td><td><code>f_ip_in(target, [ips])</code></td><td>Check if the IP address of the specified field is in the list</td><td>-</td></tr>
</tbody>
</table>
</div>
<h2 id="field-existence"><a class="header" href="#field-existence">Field Existence</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>has</code></td><td><code>has()</code></td><td>Check if the current active field exists</td><td>-</td></tr>
<tr><td><code>f_has</code></td><td><code>f_has(target)</code></td><td>Check if the specified field exists</td><td>-</td></tr>
</tbody>
</table>
</div>
<h2 id="wrapper-functions"><a class="header" href="#wrapper-functions">Wrapper Functions</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>not</code></td><td><code>not(inner_function)</code></td><td>Invert the success/failure result of the inner pipe function</td><td><a href="#not---result-inversion-wrapper-function">📖 Detailed Documentation</a></td></tr>
</tbody>
</table>
</div>
<h2 id="string-transformation"><a class="header" href="#string-transformation">String Transformation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Syntax</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>json_unescape</code></td><td><code>json_unescape()</code></td><td>Decode JSON escape characters (<code>\n</code>, <code>\t</code>, <code>\"</code>, <code>\\</code>, etc.)</td><td>-</td></tr>
<tr><td><code>base64_decode</code></td><td><code>base64_decode()</code></td><td>Base64 decode the string field</td><td>-</td></tr>
<tr><td><code>chars_replace</code></td><td><code>chars_replace(target, replacement)</code></td><td>Replace substring in the string</td><td><a href="#chars_replace-function-guide">📖 Detailed Documentation</a></td></tr>
</tbody>
</table>
</div>
<h2 id="function-classification-overview"><a class="header" href="#function-classification-overview">Function Classification Overview</a></h2>
<h3 id="by-functionality"><a class="header" href="#by-functionality">By Functionality</a></h3>
<h4 id="1-condition-check-functions"><a class="header" href="#1-condition-check-functions">1. Condition Check Functions</a></h4>
<p>Used to check if a field meets specific conditions without modifying the field value.</p>
<ul>
<li>String checks: <code>chars_has</code>, <code>chars_not_has</code>, <code>chars_in</code>, <code>regex_match</code></li>
<li>Numeric checks: <code>digit_has</code>, <code>digit_in</code>, <code>digit_range</code></li>
<li>IP checks: <code>ip_in</code></li>
<li>Existence checks: <code>has</code></li>
</ul>
<h4 id="2-transformation-functions"><a class="header" href="#2-transformation-functions">2. Transformation Functions</a></h4>
<p>Functions that modify field values.</p>
<ul>
<li>Decoding: <code>json_unescape</code>, <code>base64_decode</code></li>
<li>Replacement: <code>chars_replace</code></li>
</ul>
<h4 id="3-field-selector-functions"><a class="header" href="#3-field-selector-functions">3. Field Selector Functions</a></h4>
<p>Used to select a specific field as the active field.</p>
<ul>
<li><code>take</code>: Select by name</li>
<li><code>last</code>: Select the last field</li>
</ul>
<h4 id="4-wrapper-functions"><a class="header" href="#4-wrapper-functions">4. Wrapper Functions</a></h4>
<p>Wrap other functions to change their behavior.</p>
<ul>
<li><code>not</code>: Invert the success/failure result of the inner function</li>
</ul>
<h3 id="by-target-field-support"><a class="header" href="#by-target-field-support">By Target Field Support</a></h3>
<h4 id="operating-on-current-active-field"><a class="header" href="#operating-on-current-active-field">Operating on Current Active Field</a></h4>
<ul>
<li><code>chars_has</code>, <code>chars_not_has</code>, <code>chars_in</code></li>
<li><code>digit_has</code>, <code>digit_in</code>, <code>digit_range</code></li>
<li><code>ip_in</code></li>
<li><code>has</code></li>
<li><code>json_unescape</code>, <code>base64_decode</code>, <code>chars_replace</code></li>
<li><code>regex_match</code></li>
</ul>
<h4 id="can-specify-target-field-with-f_-prefix"><a class="header" href="#can-specify-target-field-with-f_-prefix">Can Specify Target Field (with <code>f_</code> prefix)</a></h4>
<ul>
<li><code>f_chars_has</code>, <code>f_chars_not_has</code>, <code>f_chars_in</code></li>
<li><code>f_digit_has</code>, <code>f_digit_in</code></li>
<li><code>f_ip_in</code></li>
<li><code>f_has</code></li>
</ul>
<h2 id="usage-examples-2"><a class="header" href="#usage-examples-2">Usage Examples</a></h2>
<h3 id="basic-pipeline"><a class="header" href="#basic-pipeline">Basic Pipeline</a></h3>
<pre><code class="language-wpl">rule example_pipeline {
    # 1. Select field
    | take(message)

    # 2. Check condition
    | chars_has(error)

    # 3. Transform and process
    | chars_replace(error, ERROR)
}
</code></pre>
<h3 id="complex-condition-combinations"><a class="header" href="#complex-condition-combinations">Complex Condition Combinations</a></h3>
<pre><code class="language-wpl">rule complex_filter {
    # Check status code range
    | take(status)
    | digit_range(200, 299)  # 2xx success status codes

    # Check message content
    | take(message)
    | regex_match('(?i)(success|ok|complete)')
}
</code></pre>
<h3 id="branching-logic"><a class="header" href="#branching-logic">Branching Logic</a></h3>
<pre><code class="language-wpl">rule branching_logic {
    # Branch 1: Error logs
    (
        | take(level)
        | chars_in([ERROR, FATAL])
    )
    |
    # Branch 2: Warning logs
    (
        | take(level)
        | chars_in([WARN, WARNING])
    )
}
</code></pre>
<h2 id="performance-reference"><a class="header" href="#performance-reference">Performance Reference</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function Type</th><th>Typical Performance</th><th>Notes</th></tr>
</thead>
<tbody>
<tr><td>Field Selection</td><td>&lt; 100ns</td><td>Extremely fast, based on index lookup</td></tr>
<tr><td>String Matching</td><td>&lt; 1μs</td><td>Simple string comparison</td></tr>
<tr><td>Numeric Matching</td><td>&lt; 100ns</td><td>Simple numeric comparison</td></tr>
<tr><td>Range Check</td><td>&lt; 500ns</td><td>Linear scan of multiple ranges</td></tr>
<tr><td>Regex Matching</td><td>1-100μs</td><td>Depends on pattern complexity</td></tr>
<tr><td>Base64 Decode</td><td>1-10μs</td><td>Depends on string length</td></tr>
<tr><td>String Replacement</td><td>1-10μs</td><td>Depends on string length</td></tr>
</tbody>
</table>
</div>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<h3 id="1-use-appropriate-function-types"><a class="header" href="#1-use-appropriate-function-types">1. Use Appropriate Function Types</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Use chars_has for simple matching
| chars_has(error)

# ⚠️ Overuse: Don't use regex for simple matching
| regex_match('^error$')  # Poor performance
</code></pre>
<h3 id="2-prioritize-specialized-functions"><a class="header" href="#2-prioritize-specialized-functions">2. Prioritize Specialized Functions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Use digit_range for numeric ranges
| digit_range(200, 299)

# ⚠️ Not recommended: Using regex to match numbers
| regex_match('^2\d{2}$')  # Poor performance
</code></pre>
<h3 id="3-select-field-before-processing"><a class="header" href="#3-select-field-before-processing">3. Select Field Before Processing</a></h3>
<pre><code class="language-wpl"># ✅ Correct
| take(message)
| chars_replace(old, new)

# ❌ Wrong: No active field
| chars_replace(old, new)  # Will fail
</code></pre>
<h3 id="4-combine-condition-functions"><a class="header" href="#4-combine-condition-functions">4. Combine Condition Functions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Use simple conditions first, then complex ones
| chars_has(error)          # Fast filtering
| regex_match('error:\d+')  # Precise matching
</code></pre>
<h2 id="function-comparison"><a class="header" href="#function-comparison">Function Comparison</a></h2>
<h3 id="chars_has-vs-regex_match"><a class="header" href="#chars_has-vs-regex_match">chars_has vs regex_match</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>chars_has</th><th>regex_match</th></tr>
</thead>
<tbody>
<tr><td>Purpose</td><td>Exact string matching</td><td>Pattern matching</td></tr>
<tr><td>Performance</td><td>Extremely fast</td><td>Relatively slow</td></tr>
<tr><td>Flexibility</td><td>Low</td><td>High</td></tr>
<tr><td>Use Case</td><td>Known fixed values</td><td>Complex patterns</td></tr>
</tbody>
</table>
</div>
<pre><code class="language-wpl"># Simple matching: Use chars_has
| chars_has(ERROR)

# Complex matching: Use regex_match
| regex_match('(?i)error:\s*\d+')
</code></pre>
<h3 id="digit_in-vs-digit_range"><a class="header" href="#digit_in-vs-digit_range">digit_in vs digit_range</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>digit_in</th><th>digit_range</th></tr>
</thead>
<tbody>
<tr><td>Purpose</td><td>Discrete value check</td><td>Range check</td></tr>
<tr><td>Parameters</td><td>Value list</td><td>Range list</td></tr>
<tr><td>Use Case</td><td>Specific values (e.g., status codes)</td><td>Continuous ranges</td></tr>
</tbody>
</table>
</div>
<pre><code class="language-wpl"># Discrete values: Use digit_in
| digit_in([200, 404, 500])

# Continuous range: Use digit_range
| digit_range(200, 299)
</code></pre>
<h3 id="target-field-functions-vs-active-field-functions"><a class="header" href="#target-field-functions-vs-active-field-functions">Target Field Functions vs Active Field Functions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Active Field Functions</th><th>Target Field Functions</th></tr>
</thead>
<tbody>
<tr><td>Prefix</td><td>None</td><td><code>f_</code></td></tr>
<tr><td>Field Selection</td><td>Requires take first</td><td>Automatic selection</td></tr>
<tr><td>Performance</td><td>Slightly faster</td><td>Slightly slower (requires lookup)</td></tr>
<tr><td>Convenience</td><td>Requires extra step</td><td>One-step operation</td></tr>
</tbody>
</table>
</div>
<pre><code class="language-wpl"># Active field function
| take(status)
| digit_has(200)

# Target field function (more concise)
| f_digit_has(status, 200)
</code></pre>
<h2 id="related-documentation-1"><a class="header" href="#related-documentation-1">Related Documentation</a></h2>
<ul>
<li><strong>Development Guide</strong>: <a href="10-user/guide/wpl_field_func_development_guide.html">WPL Field Function Development Guide</a></li>
<li><strong>Field Reference</strong>: <a href="#wpl-field-reference-guide">Field Reference</a></li>
<li><strong>Separator</strong>: <a href="#wpl-separator-usage-guide">Separator Guide</a></li>
</ul>
<h2 id="version-history"><a class="header" href="#version-history">Version History</a></h2>
<ul>
<li>
<p><strong>1.15.1</strong> (2026-02-07)</p>
<ul>
<li>Added <code>not()</code> wrapper function</li>
<li>Fixed <code>f_chars_not_has</code> and <code>chars_not_has</code> type checking bug</li>
</ul>
</li>
<li>
<p><strong>1.13.1</strong> (2026-02-02)</p>
<ul>
<li>Added <code>digit_range</code> function</li>
<li>Added <code>regex_match</code> function</li>
<li>Improved documentation system</li>
</ul>
</li>
<li>
<p><strong>1.11.0</strong> (2026-01-29)</p>
<ul>
<li>Added <code>chars_replace</code> function</li>
<li>Improved Base64 and JSON escape support</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: Choosing the right function type can significantly improve performance. Prioritize simple specialized functions, and only use regular expressions when complex pattern matching is needed.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-field-reference-guide"><a class="header" href="#wpl-field-reference-guide">WPL Field Reference Guide</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>In WPL, the <code>@</code> symbol is used to reference fields in collections. Two field name formats are supported:</p>
<ul>
<li><strong>Plain identifiers</strong>: <code>@field_name</code></li>
<li><strong>Single-quoted strings</strong>: <code>@'@special-field'</code> (for field names containing special characters)</li>
</ul>
<h2 id="quick-start-3"><a class="header" href="#quick-start-3">Quick Start</a></h2>
<h3 id="basic-syntax"><a class="header" href="#basic-syntax">Basic Syntax</a></h3>
<pre><code class="language-wpl"># Reference plain field
@field_name

# Reference field with special characters
@'special-field-name'

# Specify field type and alias
datatype@field_name: alias_name
</code></pre>
<h3 id="simple-examples"><a class="header" href="#simple-examples">Simple Examples</a></h3>
<pre><code class="language-wpl"># JSON parsing - extract fields
rule parse_json {
    json(
        @src_ip: source_ip,
        @dst_ip: dest_ip,
        @message: msg
    )
}

# Use single quotes for special field names
rule parse_json_special {
    json(
        @'@client-ip': client,
        @'event.type': event,
        @'log/level': level
    )
}
</code></pre>
<h2 id="plain-field-references"><a class="header" href="#plain-field-references">Plain Field References</a></h2>
<h3 id="supported-characters"><a class="header" href="#supported-characters">Supported Characters</a></h3>
<p>Plain field names (without quotes) support the following characters:</p>
<ul>
<li>Letters and numbers (a-z, A-Z, 0-9)</li>
<li>Underscore (<code>_</code>)</li>
<li>Slash (<code>/</code>)</li>
<li>Hyphen (<code>-</code>)</li>
<li>Dot (<code>.</code>)</li>
<li>Brackets (<code>[</code>, <code>]</code>) - for array indexing</li>
<li>Asterisk (<code>*</code>) - for wildcards</li>
</ul>
<h3 id="examples"><a class="header" href="#examples">Examples</a></h3>
<pre><code class="language-wpl"># Simple field names
@user_id
@username
@ip_address

# Path-style field names
@process/name
@parent/process/pid
@network/protocol

# Array indexing
@items[0]
@data[5]/value
@process[0]/path

# Wildcards
@items[*]
@logs/*/message
</code></pre>
<h2 id="single-quoted-field-references"><a class="header" href="#single-quoted-field-references">Single-Quoted Field References</a></h2>
<h3 id="when-to-use"><a class="header" href="#when-to-use">When to Use</a></h3>
<p>Single quotes are required when field names contain the following special characters:</p>
<ul>
<li><code>@</code> symbol</li>
<li>Spaces</li>
<li>Commas (<code>,</code>)</li>
<li>Equal signs (<code>=</code>)</li>
<li>Parentheses (<code>(</code>, <code>)</code>)</li>
<li>Angle brackets (<code>&lt;</code>, <code>&gt;</code>)</li>
<li>Hash symbol (<code>#</code>)</li>
<li>Other non-standard characters</li>
</ul>
<h3 id="basic-syntax-1"><a class="header" href="#basic-syntax-1">Basic Syntax</a></h3>
<pre><code class="language-wpl">@'field name with spaces'
@'@field-with-at-sign'
@'field,with,commas'
</code></pre>
<h3 id="escape-sequences"><a class="header" href="#escape-sequences">Escape Sequences</a></h3>
<p><strong>Double-quoted strings</strong> support the following escape sequences:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Escape Sequence</th><th>Meaning</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>\"</code></td><td>Double quote</td><td><code>@"field\"name"</code></td></tr>
<tr><td><code>\\</code></td><td>Backslash</td><td><code>@"path\\to\\file"</code></td></tr>
<tr><td><code>\n</code></td><td>Newline</td><td><code>@"multi\nline"</code></td></tr>
<tr><td><code>\t</code></td><td>Tab</td><td><code>@"tab\tseparated"</code></td></tr>
<tr><td><code>\r</code></td><td>Carriage return</td><td><code>@"carriage\rreturn"</code></td></tr>
<tr><td><code>\xHH</code></td><td>Hexadecimal byte</td><td><code>@"hex\x41value"</code></td></tr>
</tbody>
</table>
</div>
<p><strong>Single-quoted strings</strong> are <strong>raw strings</strong>:</p>
<ul>
<li><strong>Only supports</strong> <code>\'</code> to escape the single quote itself</li>
<li>All other backslashes <code>\</code> are treated literally</li>
<li><code>\n</code>, <code>\t</code>, <code>\\</code>, etc. are NOT escaped</li>
</ul>
<h3 id="examples-1"><a class="header" href="#examples-1">Examples</a></h3>
<pre><code class="language-wpl"># Double quotes - full escape support
@"field\"name"      # Result: field"name
@"path\\file"       # Result: path\file
@"line\nbreak"      # Result: line(newline)break

# Single quotes - raw string, only escapes \'
@'field\'s name'    # Result: field's name
@'path\to\file'     # Result: path\to\file (literal backslashes)
@'raw\nstring'      # Result: raw\nstring (literal \n)
@'C:\Users\test'    # Result: C:\Users\test (Windows path)
</code></pre>
<p><strong>Recommended use cases</strong>:</p>
<ul>
<li><strong>Single quotes</strong>: Windows paths, Unix paths, regular expressions, strings containing backslashes</li>
<li><strong>Double quotes</strong>: Scenarios requiring escape characters like newlines, tabs, etc.</li>
</ul>
<h2 id="practical-use-cases"><a class="header" href="#practical-use-cases">Practical Use Cases</a></h2>
<h3 id="scenario-1-parsing-elasticsearch-logs"><a class="header" href="#scenario-1-parsing-elasticsearch-logs">Scenario 1: Parsing Elasticsearch Logs</a></h3>
<pre><code class="language-wpl"># Elasticsearch fields typically use @ prefix
rule elasticsearch_log {
    json(
        @'@timestamp': timestamp,
        @'@version': version,
        @message: msg,
        @'log.level': level,
        @'event.action': action
    )
}
</code></pre>
<h3 id="scenario-2-parsing-fields-with-spaces"><a class="header" href="#scenario-2-parsing-fields-with-spaces">Scenario 2: Parsing Fields with Spaces</a></h3>
<pre><code class="language-wpl"># CSV or other formats may contain column names with spaces
rule csv_with_spaces {
    (
        @'First Name': first_name,
        @'Last Name': last_name,
        @'Email Address': email,
        @'Phone Number': phone
    )
}
</code></pre>
<h3 id="scenario-3-parsing-nested-json-fields"><a class="header" href="#scenario-3-parsing-nested-json-fields">Scenario 3: Parsing Nested JSON Fields</a></h3>
<pre><code class="language-wpl"># JSON field paths containing special characters
rule nested_json {
    json(
        @'user.id': uid,
        @'user.profile.name': username,
        @'event#metadata': metadata,
        @'geo.location.lat': latitude,
        @'geo.location.lon': longitude
    )
}
</code></pre>
<h3 id="scenario-4-handling-prometheus-metrics"><a class="header" href="#scenario-4-handling-prometheus-metrics">Scenario 4: Handling Prometheus Metrics</a></h3>
<pre><code class="language-wpl"># Prometheus metric names contain various special characters
rule prometheus_metrics {
    (
        @'http_requests_total{method="GET"}': get_requests,
        @'http_requests_total{method="POST"}': post_requests,
        @'process_cpu_seconds_total': cpu_usage
    )
}
</code></pre>
<h3 id="scenario-5-windows-event-logs"><a class="header" href="#scenario-5-windows-event-logs">Scenario 5: Windows Event Logs</a></h3>
<pre><code class="language-wpl"># Windows paths contain backslashes
rule windows_events {
    json(
        @'Event.System.Provider': provider,
        @'Event.EventData.CommandLine': cmdline,
        @'Process\\Path': process_path
    )
}
</code></pre>
<h3 id="scenario-6-mixed-use-of-plain-and-special-field-names"><a class="header" href="#scenario-6-mixed-use-of-plain-and-special-field-names">Scenario 6: Mixed Use of Plain and Special Field Names</a></h3>
<pre><code class="language-wpl">rule mixed_fields {
    json(
        # Plain field names
        @username: user,
        @ip_address: ip,
        @timestamp: time,

        # Special field names
        @'@client-ip': client,
        @'user.email': email,
        @'event#type': event_type,
        @'log level': level
    )
}
</code></pre>
<h3 id="scenario-7-kv-parsing-with-special-fields"><a class="header" href="#scenario-7-kv-parsing-with-special-fields">Scenario 7: KV Parsing with Special Fields</a></h3>
<pre><code class="language-wpl"># Key-value pairs containing special characters in keys
rule kv_special_keys {
    kv(
        @'@timestamp': time,
        @'event-type': type,
        @'user/name': username,
        @'session#id': session
    )
}
</code></pre>
<h2 id="take-function-quote-support"><a class="header" href="#take-function-quote-support">take() Function Quote Support</a></h2>
<p>The <code>take()</code> function is used to select the current field and also supports single and double quotes for handling field names with special characters.</p>
<h3 id="basic-syntax-2"><a class="header" href="#basic-syntax-2">Basic Syntax</a></h3>
<pre><code class="language-wpl"># Plain field name
| take(field_name)

# Double-quoted field name
| take("@special-field")

# Single-quoted field name
| take('@special-field')
</code></pre>
<h3 id="use-cases-1"><a class="header" href="#use-cases-1">Use Cases</a></h3>
<h4 id="1-selecting-fields-with-special-characters"><a class="header" href="#1-selecting-fields-with-special-characters">1. Selecting Fields with Special Characters</a></h4>
<pre><code class="language-wpl">rule select_special_fields {
    # Double quotes
    | take("@timestamp")
    | take("field with spaces")
    | take("field,with,commas")

    # Single quotes
    | take('@client-ip')
    | take('event.type')
    | take('log/level')
}
</code></pre>
<h4 id="2-escape-character-support"><a class="header" href="#2-escape-character-support">2. Escape Character Support</a></h4>
<pre><code class="language-wpl">rule escaped_fields {
    # Escaping within double quotes
    | take("field\"name")
    | take("path\\with\\backslash")

    # Escaping within single quotes
    | take('field\'s name')
    | take('path\\to\\file')
}
</code></pre>
<h4 id="3-practical-applications"><a class="header" href="#3-practical-applications">3. Practical Applications</a></h4>
<pre><code class="language-wpl"># Elasticsearch log processing
rule elasticsearch {
    | take("@timestamp")
    | take("@version")
    | take("log.level")
}

# CSV data processing
rule csv_processing {
    | take('First Name')
    | take('Last Name')
    | take('Email Address')
}

# Mixed usage
rule mixed_usage {
    | take(user_id)          # Plain field
    | take("@timestamp")     # Double quotes
    | take('event.type')     # Single quotes
}
</code></pre>
<h3 id="supported-escape-characters"><a class="header" href="#supported-escape-characters">Supported Escape Characters</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Escape Sequence</th><th>Meaning</th><th>Double Quotes</th><th>Single Quotes</th></tr>
</thead>
<tbody>
<tr><td><code>\"</code></td><td>Double quote</td><td>✅</td><td>❌ (literal <code>\"</code>)</td></tr>
<tr><td><code>\'</code></td><td>Single quote</td><td>❌ (literal <code>\'</code>)</td><td>✅</td></tr>
<tr><td><code>\\</code></td><td>Backslash</td><td>✅</td><td>❌ (literal <code>\\</code>)</td></tr>
<tr><td><code>\n</code></td><td>Newline</td><td>✅</td><td>❌ (literal <code>\n</code>)</td></tr>
<tr><td><code>\t</code></td><td>Tab</td><td>✅</td><td>❌ (literal <code>\t</code>)</td></tr>
</tbody>
</table>
</div>
<p><strong>Explanation</strong>:</p>
<ul>
<li><strong>Double quotes</strong>: Full escape support, similar to C/Java/JavaScript strings</li>
<li><strong>Single quotes</strong>: Raw string, only supports <code>\'</code> to escape the single quote itself, all other backslashes are literal characters</li>
</ul>
<h3 id="best-practices-1"><a class="header" href="#best-practices-1">Best Practices</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - prefer unquoted
| take(field_name)

# ✅ Recommended - use quotes for special characters
| take("@timestamp")
| take('@client-ip')

# ✅ Recommended - choose quote type based on content
| take("field with spaces")         # Double quotes, suitable for simple strings
| take('it\'s a field')              # Single quotes, only need to escape \'
| take('C:\Windows\System32')       # Single quotes, Windows paths
| take("line\nbreak")                # Double quotes, need newline escape
</code></pre>
<h2 id="field-type-specification"><a class="header" href="#field-type-specification">Field Type Specification</a></h2>
<p>You can specify data types for fields:</p>
<pre><code class="language-wpl"># Unquoted fields
ip@source_ip: src
digit@port: port_num
time@timestamp: time

# Quoted fields
ip@'@client-ip': client
digit@'user.age': age
chars@'event message': msg
</code></pre>
<p>Supported types include:</p>
<ul>
<li><code>ip</code> - IP address</li>
<li><code>digit</code> - Integer</li>
<li><code>float</code> - Floating point</li>
<li><code>time</code> - Timestamp</li>
<li><code>chars</code> - String</li>
<li><code>json</code> - JSON object</li>
<li><code>kv</code> - Key-value pair</li>
<li>etc.</li>
</ul>
<h2 id="field-aliases"><a class="header" href="#field-aliases">Field Aliases</a></h2>
<p>Use <code>:</code> to specify aliases for fields:</p>
<pre><code class="language-wpl"># Plain field aliases
@source_ip: src
@destination_ip: dst
@user_id: uid

# Special field aliases
@'@timestamp': time
@'event.type': event
@'log/level': level

# With type and alias
ip@'@client-ip': client_ip
digit@'user.age': age
chars@'user name': username
</code></pre>
<h2 id="usage-limitations"><a class="header" href="#usage-limitations">Usage Limitations</a></h2>
<h3 id="1-double-quotes-not-supported"><a class="header" href="#1-double-quotes-not-supported">1. Double Quotes Not Supported</a></h3>
<p>Only single quotes are supported, double quotes are not supported:</p>
<pre><code class="language-wpl"># ✅ Correct
@'@field-name'

# ❌ Wrong
@"@field-name"
</code></pre>
<h3 id="2-escape-character-limitations"><a class="header" href="#2-escape-character-limitations">2. Escape Character Limitations</a></h3>
<p>Escape characters are only valid within single-quoted strings:</p>
<pre><code class="language-wpl"># ✅ Correct - escaping within single quotes
@'user\'s name'

# ❌ Wrong - plain field names don't support escaping
@user\'s_name
</code></pre>
<h3 id="3-empty-field-names"><a class="header" href="#3-empty-field-names">3. Empty Field Names</a></h3>
<p>Field names cannot be empty:</p>
<pre><code class="language-wpl"># ❌ Wrong
@''

# ✅ Correct
@'_'  # Use underscore as field name
</code></pre>
<h3 id="4-nested-references"><a class="header" href="#4-nested-references">4. Nested References</a></h3>
<p>Single quotes don’t support nesting:</p>
<pre><code class="language-wpl"># ❌ Wrong
@'field\'nested\''

# ✅ Correct - use escaping
@'field\'nested'
</code></pre>
<h2 id="performance-notes"><a class="header" href="#performance-notes">Performance Notes</a></h2>
<h3 id="parsing-performance"><a class="header" href="#parsing-performance">Parsing Performance</a></h3>
<ul>
<li>
<p><strong>Plain field names</strong>: Zero-copy, optimal performance</p>
<pre><code class="language-wpl">@field_name  # Direct reference, no allocation
</code></pre>
</li>
<li>
<p><strong>Single-quoted field names</strong>: Requires decoding escape characters</p>
<pre><code class="language-wpl">@'@field'    # No escape characters, performance close to plain fields
@'field\'s'  # Has escape characters, requires additional processing
</code></pre>
</li>
</ul>
<h3 id="performance-comparison"><a class="header" href="#performance-comparison">Performance Comparison</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field Name Type</th><th>Parse Time</th><th>Memory Allocation</th><th>Recommended Use</th></tr>
</thead>
<tbody>
<tr><td>Plain field name</td><td>~10ns</td><td>Zero-copy</td><td>Use first</td></tr>
<tr><td>Single-quoted (no escaping)</td><td>~15ns</td><td>One allocation</td><td>Special characters</td></tr>
<tr><td>Single-quoted (with escaping)</td><td>~30ns</td><td>One allocation</td><td>When necessary</td></tr>
</tbody>
</table>
</div>
<h3 id="optimization-recommendations"><a class="header" href="#optimization-recommendations">Optimization Recommendations</a></h3>
<ol>
<li>
<p><strong>Prefer plain field names</strong></p>
<pre><code class="language-wpl"># ✅ Recommended
@user_id
@timestamp

# ⚠️ Only when necessary
@'@timestamp'
</code></pre>
</li>
<li>
<p><strong>Avoid unnecessary escaping</strong></p>
<pre><code class="language-wpl"># ✅ Recommended
@'simple-field'

# ⚠️ Avoid
@'field\twith\tescape'  # Only when you really need tabs
</code></pre>
</li>
<li>
<p><strong>Consider performance in bulk operations</strong></p>
<pre><code class="language-wpl"># When parsing many fields, prefer plain field names
json(
    @user_id,      # Fast
    @username,     # Fast
    @'@metadata'   # Slightly slower
)
</code></pre>
</li>
</ol>
<h2 id="error-handling"><a class="header" href="#error-handling">Error Handling</a></h2>
<h3 id="common-errors"><a class="header" href="#common-errors">Common Errors</a></h3>
<h4 id="1-field-name-contains-special-characters-but-no-quotes-used"><a class="header" href="#1-field-name-contains-special-characters-but-no-quotes-used">1. Field name contains special characters but no quotes used</a></h4>
<pre><code>Error: Parse failed, unexpected character '@'
Reason: Field name contains @ but single quotes not used
Solution: @'@field-name'
</code></pre>
<h4 id="2-unclosed-single-quote"><a class="header" href="#2-unclosed-single-quote">2. Unclosed single quote</a></h4>
<pre><code>Error: Unterminated string
Reason: Missing closing single quote
Solution: Ensure quotes are paired @'field-name'
</code></pre>
<h4 id="3-invalid-escape-sequence"><a class="header" href="#3-invalid-escape-sequence">3. Invalid escape sequence</a></h4>
<pre><code>Error: Invalid escape sequence
Reason: Used unsupported escape character
Solution: Only use supported escape sequences \', \\, \n, \t, \r, \xHH
</code></pre>
<h4 id="4-empty-field-name"><a class="header" href="#4-empty-field-name">4. Empty field name</a></h4>
<pre><code>Error: Field name cannot be empty
Reason: @'' or @ with no content
Solution: Provide a valid field name
</code></pre>
<h2 id="best-practices-1-1"><a class="header" href="#best-practices-1-1">Best Practices</a></h2>
<h3 id="1-naming-conventions"><a class="header" href="#1-naming-conventions">1. Naming Conventions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - use underscore separator
@user_id
@client_ip
@event_timestamp

# ⚠️ Avoid - unless necessary
@'user id'
@'client-ip'
</code></pre>
<h3 id="2-maintain-consistency"><a class="header" href="#2-maintain-consistency">2. Maintain Consistency</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - unified style
rule consistent_naming {
    json(
        @user_id,
        @user_name,
        @user_email
    )
}

# ⚠️ Avoid - mixed styles
rule inconsistent_naming {
    json(
        @user_id,
        @'user name',
        @userEmail
    )
}
</code></pre>
<h3 id="3-document-special-fields"><a class="header" href="#3-document-special-fields">3. Document Special Fields</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - add comments
rule documented {
    json(
        # Elasticsearch's @timestamp field
        @'@timestamp': time,

        # Log level (contains spaces)
        @'log level': level
    )
}
</code></pre>
<h3 id="4-use-type-prefixes"><a class="header" href="#4-use-type-prefixes">4. Use Type Prefixes</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - explicitly specify types
time@'@timestamp': time
ip@'@client-ip': client
chars@'event message': msg
</code></pre>
<h3 id="5-alias-usage-guidelines"><a class="header" href="#5-alias-usage-guidelines">5. Alias Usage Guidelines</a></h3>
<pre><code class="language-wpl"># ✅ Recommended - use short aliases
@'very.long.nested.field.name': short_name
@'@timestamp': time
@'event.action': action

# ⚠️ Avoid - aliases too long
@'@timestamp': timestamp_value_from_elasticsearch
</code></pre>
<h2 id="debugging-tips"><a class="header" href="#debugging-tips">Debugging Tips</a></h2>
<h3 id="1-validate-field-references-step-by-step"><a class="header" href="#1-validate-field-references-step-by-step">1. Validate field references step by step</a></h3>
<pre><code class="language-wpl"># Step 1: Validate single field
rule test_single {
    json(@'@timestamp')
}

# Step 2: Add more fields
rule test_multiple {
    json(
        @'@timestamp',
        @'event.type'
    )
}

# Step 3: Add types and aliases
rule test_complete {
    time@'@timestamp': time,
    chars@'event.type': event
}
</code></pre>
<h3 id="2-check-field-name-spelling"><a class="header" href="#2-check-field-name-spelling">2. Check field name spelling</a></h3>
<pre><code class="language-bash"># Use JSON tools to view original field names
echo '{"@timestamp": "2024-01-01"}' | jq 'keys'

# Output: ["@timestamp"]
# Use in WPL: @'@timestamp'
</code></pre>
<h3 id="3-test-escape-characters"><a class="header" href="#3-test-escape-characters">3. Test escape characters</a></h3>
<pre><code class="language-wpl"># Test escape characters one by one
@'test\'quote'      # Single quote
@'test\\backslash'  # Backslash
@'test\nnewline'    # Newline
</code></pre>
<h3 id="4-use-debug-mode"><a class="header" href="#4-use-debug-mode">4. Use debug mode</a></h3>
<pre><code class="language-bash"># Use WP-Motor debug mode to view parse results
wp-motor --debug rule.wpl &lt; test.log
</code></pre>
<h2 id="frequently-asked-questions-faq"><a class="header" href="#frequently-asked-questions-faq">Frequently Asked Questions (FAQ)</a></h2>
<h3 id="q1-when-must-single-quotes-be-used"><a class="header" href="#q1-when-must-single-quotes-be-used">Q1: When must single quotes be used?</a></h3>
<p>Single quotes are required when field names contain the following characters:</p>
<ul>
<li><code>@</code>, spaces, commas, equal signs, parentheses, angle brackets, hash symbols, and other special characters</li>
</ul>
<h3 id="q2-whats-the-difference-between-single-quotes-and-double-quotes"><a class="header" href="#q2-whats-the-difference-between-single-quotes-and-double-quotes">Q2: What’s the difference between single quotes and double quotes?</a></h3>
<p>WPL only supports single quotes <code>'</code> for field name references. Double quotes <code>"</code> are used for other syntax elements (such as scope markers).</p>
<h3 id="q3-how-to-include-a-single-quote-in-a-field-name"><a class="header" href="#q3-how-to-include-a-single-quote-in-a-field-name">Q3: How to include a single quote in a field name?</a></h3>
<p>Use backslash escaping: <code>@'user\'s name'</code></p>
<h3 id="q4-how-significant-is-the-performance-impact"><a class="header" href="#q4-how-significant-is-the-performance-impact">Q4: How significant is the performance impact?</a></h3>
<p>For most application scenarios, the performance impact is negligible (nanosecond-level difference). Only consider this when extremely high performance is required.</p>
<h3 id="q5-can-i-use-variables-as-field-names"><a class="header" href="#q5-can-i-use-variables-as-field-names">Q5: Can I use variables as field names?</a></h3>
<p>No, field names must be static literals.</p>
<h3 id="q6-how-to-handle-dynamic-field-names"><a class="header" href="#q6-how-to-handle-dynamic-field-names">Q6: How to handle dynamic field names?</a></h3>
<p>Use wildcards or field combinations:</p>
<pre><code class="language-wpl">@items[*]/name     # Match name field of all array elements
@'prefix*'         # Match fields starting with prefix (if supported)
</code></pre>
<h3 id="q7-are-unicode-characters-supported"><a class="header" href="#q7-are-unicode-characters-supported">Q7: Are Unicode characters supported?</a></h3>
<p>Yes, field names can contain any Unicode characters:</p>
<pre><code class="language-wpl">@'用户名称'
@'événement'
@'フィールド'
</code></pre>
<h2 id="additional-resources"><a class="header" href="#additional-resources">Additional Resources</a></h2>
<ul>
<li><strong>Separator Usage Guide</strong>: <code>docs/usage/wpl/en/separator.md</code></li>
<li><strong>chars_replace Usage Guide</strong>: <code>docs/usage/wpl/en/chars_replace.md</code></li>
<li><strong>WPL Field Function Development Guide</strong>: <code>docs/guide/en/wpl_field_func_development_guide.md</code></li>
<li><strong>Source Code</strong>:
<ul>
<li><code>crates/wp-lang/src/parser/utils.rs</code> (take_ref_path_or_quoted)</li>
<li><code>crates/wp-lang/src/parser/wpl_field.rs</code> (wpl_id_field)</li>
</ul>
</li>
</ul>
<h2 id="version-history-1"><a class="header" href="#version-history-1">Version History</a></h2>
<ul>
<li><strong>1.11.0</strong> (2026-01-29)
<ul>
<li>Added single-quoted field name support (<code>@'@special-field'</code>)</li>
<li>Added <code>take()</code> function single and double quote support</li>
<li>Support for <code>take("@field")</code> and <code>take('@field')</code> syntax</li>
<li>Added escape character support (<code>\"</code>, <code>\'</code>, <code>\\</code>, <code>\n</code>, <code>\t</code>)</li>
<li>Added comprehensive test coverage</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: Prefer plain field names for best performance, only use quotes when field names contain special characters.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-separator-usage-guide"><a class="header" href="#wpl-separator-usage-guide">WPL Separator Usage Guide</a></h1>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>Separator is a key syntax element in WPL used to split log fields. By flexibly using separators, you can parse various formats of structured log data.</p>
<h2 id="quick-start-4"><a class="header" href="#quick-start-4">Quick Start</a></h2>
<h3 id="basic-syntax-3"><a class="header" href="#basic-syntax-3">Basic Syntax</a></h3>
<pre><code class="language-wpl">| take(field_name) separator
</code></pre>
<p>The separator is written after the field definition to indicate where the field ends.</p>
<h3 id="simple-examples-1"><a class="header" href="#simple-examples-1">Simple Examples</a></h3>
<pre><code class="language-wpl"># Using space separator
| take(ip) \s
| take(method) \s
| take(path)

# Using comma separator
| take(name) ,
| take(age) ,
| take(city)
</code></pre>
<h2 id="built-in-separators"><a class="header" href="#built-in-separators">Built-in Separators</a></h2>
<h3 id="1-space-separator-s"><a class="header" href="#1-space-separator-s">1. Space Separator <code>\s</code></a></h3>
<p>Matches a single space character.</p>
<pre><code class="language-wpl"># Input: "192.168.1.1 GET /api/users"
rule parse_log {
    | take(ip) \s
    | take(method) \s
    | take(path)
}
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Apache/Nginx access logs</li>
<li>Simple space-separated logs</li>
<li>Standard format log files</li>
</ul>
<h3 id="2-tab-separator-t"><a class="header" href="#2-tab-separator-t">2. Tab Separator <code>\t</code></a></h3>
<p>Matches a single tab character.</p>
<pre><code class="language-wpl"># Input: "user001\t25\tBeijing"
rule parse_tsv {
    | take(user_id) \t
    | take(age) \t
    | take(city)
}
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>TSV (Tab-Separated Values) files</li>
<li>Database export files</li>
<li>Tab-aligned logs</li>
</ul>
<h3 id="3-generic-whitespace-separator-s"><a class="header" href="#3-generic-whitespace-separator-s">3. Generic Whitespace Separator <code>\S</code></a></h3>
<p>Matches space <strong>or</strong> tab (either one).</p>
<pre><code class="language-wpl"># Input: "field1 field2\tfield3" (mixed spaces and tabs)
rule parse_flexible {
    | take(col1) \S
    | take(col2) \S
    | take(col3)
}
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Inconsistent format logs (mixed spaces and tabs)</li>
<li>Manually edited configuration files</li>
<li>Lenient data parsing</li>
</ul>
<p><strong>Behavior</strong>:</p>
<ul>
<li>Stops at either space or tab</li>
<li>Flexibly handles inconsistent data sources</li>
</ul>
<h3 id="4-end-of-line-separator-0"><a class="header" href="#4-end-of-line-separator-0">4. End-of-Line Separator <code>\0</code></a></h3>
<p>Reads to the end of line (newline or end of string).</p>
<pre><code class="language-wpl"># Input: "prefix_value some remaining text until end"
rule parse_to_end {
    | take(prefix) _
    | take(remaining) \0
}
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Parsing the last field</li>
<li>Reading message body</li>
<li>Getting all remaining content</li>
</ul>
<p><strong>Aliases</strong>:</p>
<ul>
<li><code>\0</code> and <code>0</code> are equivalent</li>
</ul>
<h3 id="5-custom-character-separator"><a class="header" href="#5-custom-character-separator">5. Custom Character Separator</a></h3>
<p>Use any single character as a separator.</p>
<pre><code class="language-wpl"># Comma separated
| take(name) ,
| take(age) ,

# Pipe separated
| take(id) |
| take(status) |

# Semicolon separated
| take(key) ;
| take(value) ;
</code></pre>
<p><strong>Supported Characters</strong>:</p>
<ul>
<li>Comma <code>,</code></li>
<li>Pipe <code>|</code></li>
<li>Semicolon <code>;</code></li>
<li>Colon <code>:</code></li>
<li>Equal sign <code>=</code></li>
<li>Slash <code>/</code></li>
<li>Any single character</li>
</ul>
<h3 id="6-custom-string-separator"><a class="header" href="#6-custom-string-separator">6. Custom String Separator</a></h3>
<p>Use multi-character strings as separators.</p>
<pre><code class="language-wpl"># Using " | " as separator
| take(field1) " | "
| take(field2) " | "

# Using " :: " as separator
| take(module) " :: "
| take(function) " :: "
</code></pre>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Formatted output logs</li>
<li>Specific format protocols</li>
<li>Data requiring clear boundaries</li>
</ul>
<h2 id="practical-application-scenarios"><a class="header" href="#practical-application-scenarios">Practical Application Scenarios</a></h2>
<h3 id="scenario-1-parsing-nginx-access-logs"><a class="header" href="#scenario-1-parsing-nginx-access-logs">Scenario 1: Parsing Nginx Access Logs</a></h3>
<pre><code class="language-wpl"># Log format: 192.168.1.1 - - [29/Jan/2024:10:30:45 +0800] "GET /api/users HTTP/1.1" 200 1234
rule nginx_access_log {
    | take(client_ip) \s
    | take(identity) \s
    | take(user) \s
    | take(timestamp) \s
    | take(request) \s
    | take(status_code) \s
    | take(bytes_sent) \0
}
</code></pre>
<h3 id="scenario-2-parsing-tsv-data"><a class="header" href="#scenario-2-parsing-tsv-data">Scenario 2: Parsing TSV Data</a></h3>
<pre><code class="language-wpl"># Input: "2024-01-29\t10:30:45\tERROR\tDatabase connection failed"
rule tsv_log {
    | take(date) \t
    | take(time) \t
    | take(level) \t
    | take(message) \0
}
</code></pre>
<h3 id="scenario-3-parsing-csv-data"><a class="header" href="#scenario-3-parsing-csv-data">Scenario 3: Parsing CSV Data</a></h3>
<pre><code class="language-wpl"># Input: "John Smith,30,New York,Engineer"
rule csv_parser {
    | take(name) ,
    | take(age) ,
    | take(city) ,
    | take(job) \0
}
</code></pre>
<h3 id="scenario-4-parsing-structured-logs"><a class="header" href="#scenario-4-parsing-structured-logs">Scenario 4: Parsing Structured Logs</a></h3>
<pre><code class="language-wpl"># Input: "level=error | module=database | msg=Connection timeout"
rule structured_log {
    | take(level_prefix) =
    | take(level_value) " | "
    | take(module_prefix) =
    | take(module_value) " | "
    | take(msg_prefix) =
    | take(message) \0
}
</code></pre>
<h3 id="scenario-5-handling-mixed-whitespace-logs"><a class="header" href="#scenario-5-handling-mixed-whitespace-logs">Scenario 5: Handling Mixed Whitespace Logs</a></h3>
<pre><code class="language-wpl"># Input: "192.168.1.1 \tGET\t /api/data" (mixed spaces and tabs)
rule flexible_whitespace {
    | take(ip) \S
    | take(method) \S
    | take(path) \0
}
</code></pre>
<h3 id="scenario-6-parsing-syslog-format"><a class="header" href="#scenario-6-parsing-syslog-format">Scenario 6: Parsing Syslog Format</a></h3>
<pre><code class="language-wpl"># Input: "Jan 29 10:30:45 hostname app[1234]: Error message here"
rule syslog {
    | take(month) \s
    | take(day) \s
    | take(time) \s
    | take(hostname) \s
    | take(app_tag) ": "
    | take(message) \0
}
</code></pre>
<h3 id="scenario-7-parsing-key-value-logs"><a class="header" href="#scenario-7-parsing-key-value-logs">Scenario 7: Parsing Key-Value Logs</a></h3>
<pre><code class="language-wpl"># Input: "user=admin;action=login;ip=192.168.1.1;status=success"
rule kv_log {
    | take(user_key) =
    | take(user_value) ;
    | take(action_key) =
    | take(action_value) ;
    | take(ip_key) =
    | take(ip_value) ;
    | take(status_key) =
    | take(status_value) \0
}
</code></pre>
<h2 id="separator-priority"><a class="header" href="#separator-priority">Separator Priority</a></h2>
<p>WPL supports three levels of separator settings:</p>
<h3 id="1-field-level-separator-priority-3-highest"><a class="header" href="#1-field-level-separator-priority-3-highest">1. Field-level Separator (Priority 3, Highest)</a></h3>
<pre><code class="language-wpl">| take(field1) ,  # This field uses comma
| take(field2) \s # This field uses space
</code></pre>
<h3 id="2-group-level-separator-priority-2"><a class="header" href="#2-group-level-separator-priority-2">2. Group-level Separator (Priority 2)</a></h3>
<pre><code class="language-wpl">group {
    sep = \t  # All fields in the group use tab by default
    | take(field1)
    | take(field2)
}
</code></pre>
<h3 id="3-inherited-separator-priority-1-lowest"><a class="header" href="#3-inherited-separator-priority-1-lowest">3. Inherited Separator (Priority 1, Lowest)</a></h3>
<p>Default separator inherited from upstream rules.</p>
<h3 id="priority-rules"><a class="header" href="#priority-rules">Priority Rules</a></h3>
<p>Field-level &gt; Group-level &gt; Inherited-level</p>
<pre><code class="language-wpl">group {
    sep = \t         # Group-level: tab
    | take(f1)       # Uses \t
    | take(f2) ,     # Uses , (field-level overrides group-level)
    | take(f3)       # Uses \t
}
</code></pre>
<h2 id="separator-behavior"><a class="header" href="#separator-behavior">Separator Behavior</a></h2>
<h3 id="global-replacement-vs-single-match"><a class="header" href="#global-replacement-vs-single-match">Global Replacement vs Single Match</a></h3>
<p>Separators only match once at the current field’s end position:</p>
<pre><code class="language-wpl"># Input: "hello,world,test"
| take(first) ,   # Reads "hello", consumes first comma
| take(second) ,  # Reads "world", consumes second comma
| take(third) \0  # Reads "test"
</code></pre>
<h3 id="separator-consumption-behavior"><a class="header" href="#separator-consumption-behavior">Separator Consumption Behavior</a></h3>
<p>By default, separators are <strong>consumed</strong> (removed from input):</p>
<pre><code class="language-wpl"># Input: "a,b,c"
| take(x) ,  # Reads "a", consumes ",", remaining "b,c"
| take(y) ,  # Reads "b", consumes ",", remaining "c"
</code></pre>
<h3 id="when-separator-not-found"><a class="header" href="#when-separator-not-found">When Separator Not Found</a></h3>
<p>If the end of string is reached without finding the separator, reads to the end:</p>
<pre><code class="language-wpl"># Input: "field1 field2"
| take(f1) ,  # Comma not found, reads entire "field1 field2"
</code></pre>
<h2 id="advanced-usage"><a class="header" href="#advanced-usage">Advanced Usage</a></h2>
<h3 id="combining-multiple-separators"><a class="header" href="#combining-multiple-separators">Combining Multiple Separators</a></h3>
<pre><code class="language-wpl"># Input: "192.168.1.1:8080/api/users?id=123"
rule url_parse {
    | take(ip) :
    | take(port) /
    | take(api_path) /
    | take(resource) ?
    | take(query_string) \0
}
</code></pre>
<h3 id="handling-optional-fields"><a class="header" href="#handling-optional-fields">Handling Optional Fields</a></h3>
<pre><code class="language-wpl"># Input may be: "user,30,city" or "user,,city" (age is empty)
rule optional_fields {
    | take(name) ,
    | take(age) ,      # May be empty string
    | take(city) \0
}
</code></pre>
<h3 id="skipping-unwanted-fields"><a class="header" href="#skipping-unwanted-fields">Skipping Unwanted Fields</a></h3>
<pre><code class="language-wpl"># Only extract fields 1 and 3
rule skip_fields {
    | take(field1) ,
    | take(_skip) ,    # Temporary variable, not saved
    | take(field3) \0
}
</code></pre>
<h2 id="usage-limitations-1"><a class="header" href="#usage-limitations-1">Usage Limitations</a></h2>
<h3 id="1-separators-do-not-support-regular-expressions"><a class="header" href="#1-separators-do-not-support-regular-expressions">1. Separators Do Not Support Regular Expressions</a></h3>
<pre><code class="language-wpl"># ❌ Regular expressions not supported
| take(field) [0-9]+

# ✅ Use fixed strings
| take(field) \s
</code></pre>
<h3 id="2-separators-are-case-sensitive"><a class="header" href="#2-separators-are-case-sensitive">2. Separators Are Case-Sensitive</a></h3>
<pre><code class="language-wpl"># "ABC" and "abc" are different separators
| take(field1) ABC
| take(field2) abc
</code></pre>
<h3 id="3-empty-string-cannot-be-used-as-separator"><a class="header" href="#3-empty-string-cannot-be-used-as-separator">3. Empty String Cannot Be Used as Separator</a></h3>
<pre><code class="language-wpl"># ❌ Not supported
| take(field) ""

# ✅ Use \0 to read to end
| take(field) \0
</code></pre>
<h3 id="4-escape-character-limitations"><a class="header" href="#4-escape-character-limitations">4. Escape Character Limitations</a></h3>
<p>Currently supported escape characters:</p>
<ul>
<li><code>\s</code> - space</li>
<li><code>\t</code> - tab</li>
<li><code>\S</code> - space or tab</li>
<li><code>\0</code> - end of line</li>
</ul>
<p>Other escape characters (such as <code>\n</code>, <code>\r</code>) need to use actual characters.</p>
<h2 id="performance-notes-1"><a class="header" href="#performance-notes-1">Performance Notes</a></h2>
<h3 id="single-character-separators"><a class="header" href="#single-character-separators">Single Character Separators</a></h3>
<p>Best performance, recommended for priority use:</p>
<pre><code class="language-wpl">| take(f1) ,
| take(f2) \s
| take(f3) \t
</code></pre>
<ul>
<li>Time complexity: O(n)</li>
<li>Scan speed: ~500 MB/s</li>
</ul>
<h3 id="multi-character-separators"><a class="header" href="#multi-character-separators">Multi-character Separators</a></h3>
<p>Slightly lower performance, but still efficient:</p>
<pre><code class="language-wpl">| take(f1) " | "
| take(f2) " :: "
</code></pre>
<ul>
<li>Time complexity: O(n × m), where m is the separator length</li>
<li>Scan speed: ~300-400 MB/s</li>
</ul>
<h3 id="generic-whitespace-separator-s"><a class="header" href="#generic-whitespace-separator-s">Generic Whitespace Separator <code>\S</code></a></h3>
<p>Requires character-by-character checking, performance between the two:</p>
<pre><code class="language-wpl">| take(f1) \S
</code></pre>
<ul>
<li>Time complexity: O(n)</li>
<li>Scan speed: ~400 MB/s</li>
</ul>
<h2 id="error-handling-1"><a class="header" href="#error-handling-1">Error Handling</a></h2>
<h3 id="common-errors-1"><a class="header" href="#common-errors-1">Common Errors</a></h3>
<h4 id="1-separator-not-found"><a class="header" href="#1-separator-not-found">1. Separator Not Found</a></h4>
<pre><code>Error: Separator ',' not found
Cause: Input string does not contain the specified separator
Solution: Check input format or use \0 to read to end
</code></pre>
<h4 id="2-separator-syntax-error"><a class="header" href="#2-separator-syntax-error">2. Separator Syntax Error</a></h4>
<pre><code>Error: invalid separator
Cause: Used unsupported separator syntax
Solution: Refer to this document for correct separator format
</code></pre>
<h4 id="3-field-order-error"><a class="header" href="#3-field-order-error">3. Field Order Error</a></h4>
<pre><code>Error: Field parsing failed
Cause: Field definition order does not match actual data
Solution: Adjust field order to match input format
</code></pre>
<h2 id="best-practices-2"><a class="header" href="#best-practices-2">Best Practices</a></h2>
<h3 id="1-prefer-built-in-separators"><a class="header" href="#1-prefer-built-in-separators">1. Prefer Built-in Separators</a></h3>
<pre><code class="language-wpl"># ✅ Recommended
| take(f1) \s
| take(f2) \t

# ⚠️ Avoid (unless necessary)
| take(f1) " "
| take(f2) "\t"
</code></pre>
<h3 id="2-explicitly-specify-last-field-separator"><a class="header" href="#2-explicitly-specify-last-field-separator">2. Explicitly Specify Last Field Separator</a></h3>
<pre><code class="language-wpl"># ✅ Recommended (explicit to end of line)
| take(message) \0

# ⚠️ Unclear
| take(message)  # Relies on default behavior
</code></pre>
<h3 id="3-use-s-for-non-standard-data"><a class="header" href="#3-use-s-for-non-standard-data">3. Use <code>\S</code> for Non-standard Data</a></h3>
<pre><code class="language-wpl"># ✅ Recommended (better compatibility)
| take(field1) \S
| take(field2) \S

# ⚠️ May fail (if spaces and tabs are mixed)
| take(field1) \s
| take(field2) \s
</code></pre>
<h3 id="4-use-multi-character-separators-for-complex-formats"><a class="header" href="#4-use-multi-character-separators-for-complex-formats">4. Use Multi-character Separators for Complex Formats</a></h3>
<pre><code class="language-wpl"># ✅ Clear and accurate
| take(level) " | "
| take(message) " | "

# ⚠️ May mismatch
| take(level) |
| take(message) |
</code></pre>
<h3 id="5-combine-field-level-and-group-level-separators"><a class="header" href="#5-combine-field-level-and-group-level-separators">5. Combine Field-level and Group-level Separators</a></h3>
<pre><code class="language-wpl"># ✅ Recommended (reduces repetition)
group {
    sep = ,
    | take(f1)
    | take(f2)
    | take(f3) \0  # Last field uses different separator
}
</code></pre>
<h2 id="debugging-tips-1"><a class="header" href="#debugging-tips-1">Debugging Tips</a></h2>
<h3 id="1-validate-field-by-field"><a class="header" href="#1-validate-field-by-field">1. Validate Field by Field</a></h3>
<pre><code class="language-wpl"># First parse the first field
| take(field1) ,

# After confirming success, add the second
| take(field1) ,
| take(field2) ,

# Add incrementally...
</code></pre>
<h3 id="2-use-temporary-fields-to-view-intermediate-results"><a class="header" href="#2-use-temporary-fields-to-view-intermediate-results">2. Use Temporary Fields to View Intermediate Results</a></h3>
<pre><code class="language-wpl">| take(field1) ,
| take(_debug) ,    # Temporary field, view remaining content
| take(field2) \0
</code></pre>
<h3 id="3-print-separator-positions"><a class="header" href="#3-print-separator-positions">3. Print Separator Positions</a></h3>
<p>In test environment, use debug mode to view separator matching:</p>
<pre><code class="language-bash">wp-motor --debug rule.wpl &lt; test.log
</code></pre>
<h3 id="4-verify-separator-characters"><a class="header" href="#4-verify-separator-characters">4. Verify Separator Characters</a></h3>
<p>For invisible characters (like tabs), use hex viewer to confirm:</p>
<pre><code class="language-bash"># View tabs in file
cat -A test.log
# or
hexdump -C test.log | head
</code></pre>
<h2 id="frequently-asked-questions-faq-1"><a class="header" href="#frequently-asked-questions-faq-1">Frequently Asked Questions (FAQ)</a></h2>
<h3 id="q1-whats-the-difference-between-s-and-s"><a class="header" href="#q1-whats-the-difference-between-s-and-s">Q1: What’s the difference between <code>\s</code> and <code>\S</code>?</a></h3>
<ul>
<li><code>\s</code>: Only matches space</li>
<li><code>\S</code>: Matches space or tab (space OR tab)</li>
</ul>
<pre><code class="language-wpl"># Input: "a b"
| take(x) \s  # ✅ Match successful

# Input: "a\tb"
| take(x) \s  # ❌ Match failed (this is a tab, not a space)
| take(x) \S  # ✅ Match successful
</code></pre>
<h3 id="q2-how-to-handle-consecutive-separators"><a class="header" href="#q2-how-to-handle-consecutive-separators">Q2: How to handle consecutive separators?</a></h3>
<p>WPL treats consecutive separators as multiple empty fields:</p>
<pre><code class="language-wpl"># Input: "a,,c"
| take(f1) ,  # Reads "a"
| take(f2) ,  # Reads "" (empty string)
| take(f3) \0 # Reads "c"
</code></pre>
<h3 id="q3-do-separators-affect-performance"><a class="header" href="#q3-do-separators-affect-performance">Q3: Do separators affect performance?</a></h3>
<p>Single-character separators have the best performance, multi-character separators are slightly slower, but the impact is negligible for most scenarios.</p>
<h3 id="q4-how-to-parse-nested-structures"><a class="header" href="#q4-how-to-parse-nested-structures">Q4: How to parse nested structures?</a></h3>
<p>Use multi-level separators:</p>
<pre><code class="language-wpl"># Input: "k1=v1;k2=v2|k3=v3;k4=v4"
rule nested {
    | take(group1) |
    | take(group2) \0
}
# Then parse each group internally with ; and =
</code></pre>
<h3 id="q5-can-separators-be-chinese-characters"><a class="header" href="#q5-can-separators-be-chinese-characters">Q5: Can separators be Chinese characters?</a></h3>
<p>Yes, Unicode characters are supported:</p>
<pre><code class="language-wpl"># Using Chinese comma as separator
| take(field1) ，
| take(field2) ，
</code></pre>
<h3 id="q6-is-there-a-difference-between-0-and-omitting-the-separator"><a class="header" href="#q6-is-there-a-difference-between-0-and-omitting-the-separator">Q6: Is there a difference between <code>\0</code> and omitting the separator?</a></h3>
<p>It’s recommended to explicitly use <code>\0</code> for clearer semantics:</p>
<pre><code class="language-wpl"># ✅ Recommended (explicit)
| take(message) \0

# ⚠️ Works but unclear
| take(message)
</code></pre>
<h3 id="q7-how-to-handle-separators-within-quotes"><a class="header" href="#q7-how-to-handle-separators-within-quotes">Q7: How to handle separators within quotes?</a></h3>
<p>For complex formats with quotes, it’s recommended to use specialized parsers (such as JSON, KV parser):</p>
<pre><code class="language-wpl"># Complex CSV (with quotes)
# Input: "field1","field with , comma","field3"
# Recommend using CSV parser instead of manual separators
</code></pre>
<h2 id="additional-resources-1"><a class="header" href="#additional-resources-1">Additional Resources</a></h2>
<ul>
<li><strong>WPL Syntax Reference</strong>: <code>docs/guide/wpl_syntax.md</code></li>
<li><strong>Parser Development Guide</strong>: <code>docs/guide/wpl_field_func_development_guide.md</code></li>
<li><strong>chars_replace Usage Guide</strong>: <code>docs/usage/wpl/chars_replace.md</code></li>
<li><strong>Source Code</strong>: <code>crates/wp-lang/src/ast/syntax/wpl_sep.rs</code></li>
</ul>
<h2 id="version-history-2"><a class="header" href="#version-history-2">Version History</a></h2>
<ul>
<li>
<p><strong>1.11.0</strong> (2026-01-29)</p>
<ul>
<li>Added <code>\t</code> tab separator support</li>
<li>Added <code>\S</code> generic whitespace separator (space or tab)</li>
<li>Optimized Whitespace separator performance</li>
<li>Added complete test coverage</li>
</ul>
</li>
<li>
<p><strong>1.10.x</strong> and earlier versions</p>
<ul>
<li>Support for <code>\s</code> (space) and <code>\0</code> (end of line)</li>
<li>Support for custom character and string separators</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: Separators are the core of WPL parsing. Choosing the right separator can greatly simplify log parsing rules.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="chars_replace-function-guide"><a class="header" href="#chars_replace-function-guide">chars_replace Function Guide</a></h1>
<h2 id="overview-3"><a class="header" href="#overview-3">Overview</a></h2>
<p><code>chars_replace</code> is a string replacement function in WPL (WP Language) used to find and replace specified substrings in log fields.</p>
<h2 id="quick-start-5"><a class="header" href="#quick-start-5">Quick Start</a></h2>
<h3 id="basic-syntax-4"><a class="header" href="#basic-syntax-4">Basic Syntax</a></h3>
<pre><code class="language-wpl">chars_replace(target, replacement)
</code></pre>
<ul>
<li><strong>target</strong>: The string to search for and replace</li>
<li><strong>replacement</strong>: The new string to replace with</li>
</ul>
<h3 id="simple-examples-2"><a class="header" href="#simple-examples-2">Simple Examples</a></h3>
<pre><code class="language-wpl"># Replace "error" with "warning"
chars_replace(error, warning)

# Replace "ERROR" with "WARN"
chars_replace(ERROR, WARN)
</code></pre>
<h2 id="parameter-formats"><a class="header" href="#parameter-formats">Parameter Formats</a></h2>
<h3 id="1-unquoted-simple-identifiers"><a class="header" href="#1-unquoted-simple-identifiers">1. Unquoted (Simple Identifiers)</a></h3>
<p>Suitable for simple field names or keywords:</p>
<pre><code class="language-wpl">chars_replace(old_value, new_value)
chars_replace(test-old, test-new)
chars_replace(错误, 警告)
</code></pre>
<p><strong>Supported characters</strong>:</p>
<ul>
<li>Letters (a-z, A-Z)</li>
<li>Digits (0-9)</li>
<li>Underscore (_)</li>
<li>Dot (.)</li>
<li>Slash (/)</li>
<li>Hyphen (-)</li>
<li>Unicode characters (Chinese, Japanese, etc.)</li>
</ul>
<h3 id="2-quoted-special-characters"><a class="header" href="#2-quoted-special-characters">2. Quoted (Special Characters)</a></h3>
<p>Suitable for strings containing special characters:</p>
<pre><code class="language-wpl">chars_replace("test,old", "test,new")         # Contains comma
chars_replace("hello world", "goodbye world") # Contains space
chars_replace("status=error", "status=ok")    # Contains equal sign
chars_replace("[ERROR]", "[WARN]")            # Contains brackets
</code></pre>
<p><strong>Scenarios requiring quotes</strong>:</p>
<ul>
<li>Contains comma (,)</li>
<li>Contains space</li>
<li>Contains equal sign (=)</li>
<li>Contains brackets ([])</li>
<li>Contains other special symbols</li>
</ul>
<h3 id="3-mixed-usage"><a class="header" href="#3-mixed-usage">3. Mixed Usage</a></h3>
<p>You can mix quoted and unquoted parameters:</p>
<pre><code class="language-wpl">chars_replace("test,old", new_value)
chars_replace(old_value, "new,value")
</code></pre>
<h3 id="4-empty-string-delete-text"><a class="header" href="#4-empty-string-delete-text">4. Empty String (Delete Text)</a></h3>
<p>Use empty quotes to delete the target string:</p>
<pre><code class="language-wpl"># Delete "DEBUG: " prefix
chars_replace("DEBUG: ", "")

# Delete commas
chars_replace(",", "")
</code></pre>
<h2 id="practical-use-cases-1"><a class="header" href="#practical-use-cases-1">Practical Use Cases</a></h2>
<h3 id="scenario-1-standardize-log-levels"><a class="header" href="#scenario-1-standardize-log-levels">Scenario 1: Standardize Log Levels</a></h3>
<pre><code class="language-wpl"># Unify case
chars_replace(error, ERROR)
chars_replace(warning, WARNING)

# Standardize format
chars_replace("[ERROR]", "ERROR:")
chars_replace("[WARN]", "WARNING:")
</code></pre>
<h3 id="scenario-2-clean-log-content"><a class="header" href="#scenario-2-clean-log-content">Scenario 2: Clean Log Content</a></h3>
<pre><code class="language-wpl"># Remove debug prefix
chars_replace("DEBUG: ", "")

# Remove extra spaces
chars_replace("  ", " ")

# Remove newlines
chars_replace("\n", " ")
</code></pre>
<h3 id="scenario-3-url-parameter-replacement"><a class="header" href="#scenario-3-url-parameter-replacement">Scenario 3: URL Parameter Replacement</a></h3>
<pre><code class="language-wpl">chars_replace("status=error", "status=ok")
chars_replace("code=500", "code=200")
</code></pre>
<h3 id="scenario-4-csv-field-processing"><a class="header" href="#scenario-4-csv-field-processing">Scenario 4: CSV Field Processing</a></h3>
<pre><code class="language-wpl"># Replace comma-separated names
chars_replace("Smith, John", "John Smith")
chars_replace("Doe, Jane", "Jane Doe")
</code></pre>
<h3 id="scenario-5-path-normalization"><a class="header" href="#scenario-5-path-normalization">Scenario 5: Path Normalization</a></h3>
<pre><code class="language-wpl"># Windows path to Unix path
chars_replace("\\", "/")

# Simplify path
chars_replace("/usr/local/", "/opt/")
</code></pre>
<h3 id="scenario-6-multilingual-support"><a class="header" href="#scenario-6-multilingual-support">Scenario 6: Multilingual Support</a></h3>
<pre><code class="language-wpl"># Chinese replacement
chars_replace(错误, 警告)
chars_replace("错误:", "警告:")

# Japanese replacement
chars_replace(エラー, 警告)
</code></pre>
<h3 id="scenario-7-sensitive-information-masking"><a class="header" href="#scenario-7-sensitive-information-masking">Scenario 7: Sensitive Information Masking</a></h3>
<pre><code class="language-wpl"># Replace password
chars_replace("password=12345", "password=***")

# Replace token
chars_replace("token=abc123xyz", "token=***")
</code></pre>
<h2 id="limitations"><a class="header" href="#limitations">Limitations</a></h2>
<h3 id="unsupported-features"><a class="header" href="#unsupported-features">Unsupported Features</a></h3>
<ol>
<li>
<p><strong>Escape characters</strong>:</p>
<pre><code class="language-wpl"># ❌ Not supported (will cause parsing error)
chars_replace("say \"hello\"", "say 'hi'")
</code></pre>
</li>
<li>
<p><strong>Regular expressions</strong>:</p>
<pre><code class="language-wpl"># ❌ Regex not supported
chars_replace("[0-9]+", "NUMBER")  # Will match literally
</code></pre>
</li>
<li>
<p><strong>Wildcards</strong>:</p>
<pre><code class="language-wpl"># ❌ Wildcards not supported
chars_replace("error*", "warning")  # Will match literally
</code></pre>
</li>
</ol>
<h3 id="type-restrictions"><a class="header" href="#type-restrictions">Type Restrictions</a></h3>
<p><code>chars_replace</code> can only process <strong>string type</strong> fields:</p>
<pre><code class="language-wpl"># ✅ Correct - field is a string
message: "error occurred" -&gt; chars_replace(error, warning)

# ❌ Wrong - field is a number
status_code: 500 -&gt; chars_replace(500, 200)  # Will fail

# ❌ Wrong - field is an IP address
ip_address: 192.168.1.1 -&gt; chars_replace(192, 10)  # Will fail
</code></pre>
<h3 id="replacement-behavior"><a class="header" href="#replacement-behavior">Replacement Behavior</a></h3>
<ul>
<li>
<p><strong>Global replacement</strong>: Replaces <strong>all</strong> matching substrings in the field</p>
<pre><code class="language-wpl"># Input: "hello hello hello"
chars_replace(hello, hi)
# Output: "hi hi hi"
</code></pre>
</li>
<li>
<p><strong>Case-sensitive</strong>: Distinguishes between cases</p>
<pre><code class="language-wpl"># Input: "Error error ERROR"
chars_replace(error, warning)
# Output: "Error warning ERROR"  # Only replaces lowercase "error"
</code></pre>
</li>
</ul>
<h2 id="complete-examples"><a class="header" href="#complete-examples">Complete Examples</a></h2>
<h3 id="example-1-log-level-normalization-pipeline"><a class="header" href="#example-1-log-level-normalization-pipeline">Example 1: Log Level Normalization Pipeline</a></h3>
<pre><code class="language-wpl">rule log_normalization {
    # Normalize different ERROR formats
    | chars_replace("[ERROR]", "ERROR:")
    | chars_replace("ERR:", "ERROR:")
    | chars_replace("Err:", "ERROR:")

    # Normalize WARNING
    | chars_replace("[WARN]", "WARNING:")
    | chars_replace("Warn:", "WARNING:")

    # Remove debug information
    | chars_replace("DEBUG: ", "")
}
</code></pre>
<h3 id="example-2-csv-data-cleanup"><a class="header" href="#example-2-csv-data-cleanup">Example 2: CSV Data Cleanup</a></h3>
<pre><code class="language-wpl">rule csv_cleanup {
    # Standardize name format (from "Last, First" to "First Last")
    | chars_replace("Smith, John", "John Smith")
    | chars_replace("Doe, Jane", "Jane Doe")

    # Remove extra quotes
    | chars_replace("\"", "")

    # Standardize delimiter
    | chars_replace(";", ",")
}
</code></pre>
<h3 id="example-3-multi-step-replacement"><a class="header" href="#example-3-multi-step-replacement">Example 3: Multi-Step Replacement</a></h3>
<pre><code class="language-wpl">rule multi_step_replace {
    # Step 1: Replace log level
    | chars_replace(error, ERROR)

    # Step 2: Add timestamp prefix (by replacing empty string)
    | chars_replace("", "[2024-01-29] ")

    # Step 3: Replace service name
    | chars_replace(old-service, new-service)
}
</code></pre>
<h2 id="performance-notes-2"><a class="header" href="#performance-notes-2">Performance Notes</a></h2>
<ul>
<li><strong>Time complexity</strong>: O(n) - n is the field length</li>
<li><strong>Space complexity</strong>: O(n) - requires creating a new string</li>
<li><strong>Performance recommendations</strong>:
<ul>
<li>Short strings (&lt; 1KB): Excellent performance, latency &lt; 1μs</li>
<li>Long strings (1-10KB): Still fast, latency &lt; 10μs</li>
<li>Very long strings (&gt; 10KB): Consider performance impact</li>
</ul>
</li>
</ul>
<h2 id="error-handling-2"><a class="header" href="#error-handling-2">Error Handling</a></h2>
<h3 id="common-errors-2"><a class="header" href="#common-errors-2">Common Errors</a></h3>
<ol>
<li>
<p><strong>Field does not exist</strong></p>
<pre><code>Error: chars_replace | no active field
Cause: No active field currently
Solution: Use take() or other selectors to select a field first
</code></pre>
</li>
<li>
<p><strong>Field type mismatch</strong></p>
<pre><code>Error: chars_replace
Cause: Field is not a string type
Solution: Ensure field is Chars type
</code></pre>
</li>
<li>
<p><strong>Syntax error</strong></p>
<pre><code>Error: invalid symbol, expected need ','
Cause: Parameters containing commas not quoted
Solution: Wrap parameters with quotes
</code></pre>
</li>
</ol>
<h2 id="using-with-other-functions"><a class="header" href="#using-with-other-functions">Using with Other Functions</a></h2>
<h3 id="with-field-selectors"><a class="header" href="#with-field-selectors">With Field Selectors</a></h3>
<pre><code class="language-wpl"># Select field first, then replace
| take(message)
| chars_replace(error, warning)
</code></pre>
<h3 id="with-conditional-checks"><a class="header" href="#with-conditional-checks">With Conditional Checks</a></h3>
<pre><code class="language-wpl"># Replace only under specific conditions
| chars_has(error)
| chars_replace(error, warning)
</code></pre>
<h3 id="with-conversion-functions"><a class="header" href="#with-conversion-functions">With Conversion Functions</a></h3>
<pre><code class="language-wpl"># Decode Base64 first, then replace
| base64_decode()
| chars_replace(old_value, new_value)
</code></pre>
<h2 id="best-practices-3"><a class="header" href="#best-practices-3">Best Practices</a></h2>
<h3 id="1-prefer-unquoted-format"><a class="header" href="#1-prefer-unquoted-format">1. Prefer Unquoted Format</a></h3>
<pre><code class="language-wpl"># ✅ Recommended (concise)
chars_replace(error, warning)

# ⚠️ Works but unnecessary
chars_replace("error", "warning")
</code></pre>
<h3 id="2-use-quotes-for-complex-strings"><a class="header" href="#2-use-quotes-for-complex-strings">2. Use Quotes for Complex Strings</a></h3>
<pre><code class="language-wpl"># ✅ Correct
chars_replace("status=error", "status=ok")

# ❌ Wrong (syntax error)
chars_replace(status=error, status=ok)
</code></pre>
<h3 id="3-empty-string-to-delete-text"><a class="header" href="#3-empty-string-to-delete-text">3. Empty String to Delete Text</a></h3>
<pre><code class="language-wpl"># ✅ Recommended (clear intent)
chars_replace("DEBUG: ", "")

# ⚠️ Unclear
chars_replace("DEBUG: ", nothing)  # "nothing" keyword doesn't exist
</code></pre>
<h3 id="4-execute-multiple-replacements-in-order"><a class="header" href="#4-execute-multiple-replacements-in-order">4. Execute Multiple Replacements in Order</a></h3>
<pre><code class="language-wpl"># ✅ Correct (step-by-step replacement)
| chars_replace(error, ERROR)
| chars_replace(ERROR, WARNING)
# Result: error -&gt; ERROR -&gt; WARNING

# ⚠️ Note the order
| chars_replace(ERROR, WARNING)
| chars_replace(error, ERROR)
# Result: error -&gt; ERROR (second step won't change to WARNING)
</code></pre>
<h3 id="5-test-edge-cases"><a class="header" href="#5-test-edge-cases">5. Test Edge Cases</a></h3>
<pre><code class="language-wpl"># Test empty string
chars_replace("", "prefix")  # Inserts between each character

# Test single character
chars_replace(",", ";")      # Simple replacement

# Test long string
chars_replace("very long string to find", "replacement")
</code></pre>
<h2 id="debugging-tips-2"><a class="header" href="#debugging-tips-2">Debugging Tips</a></h2>
<h3 id="1-test-step-by-step"><a class="header" href="#1-test-step-by-step">1. Test Step by Step</a></h3>
<pre><code class="language-wpl"># First step: Only do replacement
| chars_replace(error, warning)

# Second step: Add more replacements
| chars_replace(error, warning)
| chars_replace(warning, info)
</code></pre>
<h3 id="2-check-field-type"><a class="header" href="#2-check-field-type">2. Check Field Type</a></h3>
<pre><code class="language-wpl"># Use has() to confirm field exists
| has()

# Use chars_has() to confirm it's a string type
| chars_has(some_value)
</code></pre>
<h3 id="3-view-replacement-results"><a class="header" href="#3-view-replacement-results">3. View Replacement Results</a></h3>
<p>Print values before and after replacement in test environment:</p>
<pre><code class="language-bash"># Use WP-Motor's debug mode
wp-motor --debug rule.wpl &lt; test.log
</code></pre>
<h2 id="frequently-asked-questions-faq-2"><a class="header" href="#frequently-asked-questions-faq-2">Frequently Asked Questions (FAQ)</a></h2>
<h3 id="q1-how-to-replace-newline-characters"><a class="header" href="#q1-how-to-replace-newline-characters">Q1: How to replace newline characters?</a></h3>
<pre><code class="language-wpl"># Method 1: Use actual newline character (if parser supports)
chars_replace("\n", " ")

# Method 2: Handle based on actual encoding
chars_replace("
", " ")  # Actual newline
</code></pre>
<h3 id="q2-how-to-replace-multiple-different-strings-simultaneously"><a class="header" href="#q2-how-to-replace-multiple-different-strings-simultaneously">Q2: How to replace multiple different strings simultaneously?</a></h3>
<pre><code class="language-wpl"># Use multiple chars_replace calls
| chars_replace(error, ERROR)
| chars_replace(warning, WARNING)
| chars_replace(info, INFO)
</code></pre>
<h3 id="q3-how-to-implement-case-insensitive-replacement"><a class="header" href="#q3-how-to-implement-case-insensitive-replacement">Q3: How to implement case-insensitive replacement?</a></h3>
<p>chars_replace is case-sensitive, so multiple calls are needed:</p>
<pre><code class="language-wpl">| chars_replace(error, ERROR)
| chars_replace(Error, ERROR)
| chars_replace(ERROR, ERROR)
</code></pre>
<h3 id="q4-does-replacement-modify-the-original-field"><a class="header" href="#q4-does-replacement-modify-the-original-field">Q4: Does replacement modify the original field?</a></h3>
<p>Yes, chars_replace directly modifies the value of the active field.</p>
<h3 id="q5-is-performance-sufficient"><a class="header" href="#q5-is-performance-sufficient">Q5: Is performance sufficient?</a></h3>
<p>For most log processing scenarios, performance is more than sufficient:</p>
<ul>
<li>Single log &lt; 10KB: Almost imperceptible</li>
<li>High throughput scenarios: Can process 100K+ logs/second</li>
</ul>
<h2 id="additional-resources-2"><a class="header" href="#additional-resources-2">Additional Resources</a></h2>
<ul>
<li><strong>Development Guide</strong>: <code>docs/guide/wpl_field_func_development_guide.md</code></li>
<li><strong>Parser Implementation</strong>: <code>docs/guide/chars_replace_parser_tests.md</code></li>
<li><strong>Performance Analysis</strong>: <code>docs/guide/take_quoted_string_performance.md</code></li>
<li><strong>Source Code</strong>: <code>crates/wp-lang/src/ast/processor/function.rs</code></li>
</ul>
<h2 id="version-history-3"><a class="header" href="#version-history-3">Version History</a></h2>
<ul>
<li><strong>1.11.0</strong> (2026-01-29)
<ul>
<li>Initial implementation</li>
<li>Support for basic string replacement</li>
<li>Support for quoted strings (including commas, spaces, etc.)</li>
<li>Added complete test coverage</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: If you encounter issues while using this function, please refer to the Error Handling section or consult the development guide.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="regex_match-function-guide"><a class="header" href="#regex_match-function-guide">regex_match Function Guide</a></h1>
<h2 id="overview-4"><a class="header" href="#overview-4">Overview</a></h2>
<p><code>regex_match</code> is a regular expression matching function in WPL (WP Language) used to check whether log field string content matches a specified regular expression pattern. It uses Rust’s regex engine and supports complete regular expression syntax.</p>
<h2 id="quick-start-6"><a class="header" href="#quick-start-6">Quick Start</a></h2>
<h3 id="basic-syntax-5"><a class="header" href="#basic-syntax-5">Basic Syntax</a></h3>
<pre><code class="language-wpl">regex_match('pattern')
</code></pre>
<ul>
<li><strong>pattern</strong>: Regular expression pattern (recommend using <strong>single quotes</strong>)</li>
<li>Returns Ok on successful match, Err on failure</li>
</ul>
<h3 id="simple-examples-3"><a class="header" href="#simple-examples-3">Simple Examples</a></h3>
<pre><code class="language-wpl"># Match pure numbers
regex_match('^\d+$')

# Match email format
regex_match('^\w+@\w+\.\w+$')

# Match IP address
regex_match('^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$')

# Match HTTP methods
regex_match('^(GET|POST|PUT|DELETE)$')
</code></pre>
<h2 id="important-note-quote-usage"><a class="header" href="#important-note-quote-usage">Important Note: Quote Usage</a></h2>
<h3 id="recommended-use-single-quotes-raw-strings"><a class="header" href="#recommended-use-single-quotes-raw-strings">Recommended: Use Single Quotes (Raw Strings)</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Single quotes don't process escapes, suitable for regex
regex_match('^\d+$')           # \d preserved as-is
regex_match('^\w+@\w+\.\w+$')  # \w, \. preserved as-is
regex_match('^[A-Z]+\d+$')     # Works perfectly
</code></pre>
<h3 id="avoid-double-quotes-lead-to-escape-issues"><a class="header" href="#avoid-double-quotes-lead-to-escape-issues">Avoid: Double Quotes Lead to Escape Issues</a></h3>
<pre><code class="language-wpl"># ❌ Wrong: Double quotes attempt to escape \d
regex_match("^\d+$")  # Parsing fails! \d is not a valid escape sequence

# ❌ Wrong: \w also fails
regex_match("^\w+$")  # Parsing fails!
</code></pre>
<p><strong>Reason</strong>: WPL’s double-quoted string parser only supports <code>\"</code>, <code>\\</code>, <code>\n</code>, <code>\t</code> escape sequences, while regex patterns like <code>\d</code>, <code>\w</code>, <code>\s</code> will cause parsing errors.</p>
<h2 id="regular-expression-syntax"><a class="header" href="#regular-expression-syntax">Regular Expression Syntax</a></h2>
<p><code>regex_match</code> uses Rust’s regex engine and supports the following features:</p>
<h3 id="1-basic-matching"><a class="header" href="#1-basic-matching">1. Basic Matching</a></h3>
<pre><code class="language-wpl"># Literal characters
regex_match('hello')          # Matches "hello"
regex_match('error')          # Matches "error"
</code></pre>
<h3 id="2-character-classes"><a class="header" href="#2-character-classes">2. Character Classes</a></h3>
<pre><code class="language-wpl"># Digits
regex_match('\d')             # Matches any digit [0-9]
regex_match('\d+')            # Matches one or more digits
regex_match('\d{3}')          # Matches exactly 3 digits

# Alphanumeric
regex_match('\w')             # Matches [a-zA-Z0-9_]
regex_match('\w+')            # Matches one or more word characters

# Whitespace
regex_match('\s')             # Matches space, tab, newline
regex_match('\s+')            # Matches one or more whitespace characters

# Custom character classes
regex_match('[a-z]')          # Matches lowercase letters
regex_match('[A-Z]')          # Matches uppercase letters
regex_match('[0-9]')          # Matches digits
regex_match('[a-zA-Z0-9]')    # Matches letters or digits
</code></pre>
<h3 id="3-quantifiers"><a class="header" href="#3-quantifiers">3. Quantifiers</a></h3>
<pre><code class="language-wpl"># * - Zero or more times
regex_match('a*')             # Matches "", "a", "aa", "aaa"...

# + - One or more times
regex_match('a+')             # Matches "a", "aa", "aaa"... (not empty string)

# ? - Zero or one time
regex_match('colou?r')        # Matches "color" or "colour"

# {n} - Exactly n times
regex_match('\d{4}')          # Matches 4 digits

# {n,m} - Between n and m times
regex_match('\d{2,4}')        # Matches 2 to 4 digits

# {n,} - At least n times
regex_match('\d{3,}')         # Matches 3 or more digits
</code></pre>
<h3 id="4-anchors"><a class="header" href="#4-anchors">4. Anchors</a></h3>
<pre><code class="language-wpl"># ^ - Start of string
regex_match('^\d+')           # Must start with digits

# $ - End of string
regex_match('\d+$')           # Must end with digits

# ^...$ - Complete match
regex_match('^\d+$')          # Entire string must be digits
</code></pre>
<h3 id="5-groups-and-alternation"><a class="header" href="#5-groups-and-alternation">5. Groups and Alternation</a></h3>
<pre><code class="language-wpl"># (...) - Grouping
regex_match('(ab)+')          # Matches "ab", "abab", "ababab"...

# | - Alternation (OR)
regex_match('cat|dog')        # Matches "cat" or "dog"
regex_match('^(GET|POST)$')   # Matches "GET" or "POST"

# (?:...) - Non-capturing group
regex_match('(?:ab)+')        # Same as (ab)+, but doesn't capture
</code></pre>
<h3 id="6-special-character-escaping"><a class="header" href="#6-special-character-escaping">6. Special Character Escaping</a></h3>
<pre><code class="language-wpl"># Escape metacharacters
regex_match('\.')             # Matches dot .
regex_match('\[')             # Matches left bracket [
regex_match('\(')             # Matches left parenthesis (
regex_match('\$')             # Matches dollar sign $
regex_match('\*')             # Matches asterisk *
</code></pre>
<h3 id="7-flags"><a class="header" href="#7-flags">7. Flags</a></h3>
<pre><code class="language-wpl"># (?i) - Case insensitive
regex_match('(?i)error')      # Matches "error", "ERROR", "Error"

# (?m) - Multiline mode
regex_match('(?m)^line')      # ^ matches start of each line

# (?s) - Single line mode (. matches newlines)
regex_match('(?s).*')         # . can match newlines
</code></pre>
<h2 id="practical-use-cases-2"><a class="header" href="#practical-use-cases-2">Practical Use Cases</a></h2>
<h3 id="scenario-1-log-level-matching"><a class="header" href="#scenario-1-log-level-matching">Scenario 1: Log Level Matching</a></h3>
<pre><code class="language-wpl">rule log_level_filter {
    # Select log message field
    | take(message)

    # Match messages containing ERROR or FATAL (case insensitive)
    | regex_match('(?i)(error|fatal)')
}

# Example data:
# message: "Error occurred"     → ✅ Matched
# message: "FATAL exception"    → ✅ Matched
# message: "Warning message"    → ❌ Not matched
</code></pre>
<h3 id="scenario-2-email-address-validation"><a class="header" href="#scenario-2-email-address-validation">Scenario 2: Email Address Validation</a></h3>
<pre><code class="language-wpl">rule email_validation {
    # Select email field
    | take(email)

    # Validate email format
    | regex_match('^\w+(\.\w+)*@\w+(\.\w+)+$')
}

# Example data:
# email: "user@example.com"           → ✅ Matched
# email: "john.doe@company.co.uk"     → ✅ Matched
# email: "invalid-email"              → ❌ Not matched
# email: "@example.com"               → ❌ Not matched
</code></pre>
<h3 id="scenario-3-ip-address-matching"><a class="header" href="#scenario-3-ip-address-matching">Scenario 3: IP Address Matching</a></h3>
<pre><code class="language-wpl">rule ip_address_filter {
    # Select IP address field
    | take(client_ip)

    # Match private IP (192.168.x.x)
    | regex_match('^192\.168\.\d{1,3}\.\d{1,3}$')
}

# Example data:
# client_ip: "192.168.1.1"    → ✅ Matched
# client_ip: "192.168.0.100"  → ✅ Matched
# client_ip: "10.0.0.1"       → ❌ Not matched
# client_ip: "8.8.8.8"        → ❌ Not matched
</code></pre>
<h3 id="scenario-4-url-path-filtering"><a class="header" href="#scenario-4-url-path-filtering">Scenario 4: URL Path Filtering</a></h3>
<pre><code class="language-wpl">rule api_endpoint_filter {
    # Select request path
    | take(path)

    # Match API endpoints (/api/v1/...)
    | regex_match('^/api/v\d+/')
}

# Example data:
# path: "/api/v1/users"         → ✅ Matched
# path: "/api/v2/products"      → ✅ Matched
# path: "/static/image.png"     → ❌ Not matched
</code></pre>
<h3 id="scenario-5-timestamp-format-validation"><a class="header" href="#scenario-5-timestamp-format-validation">Scenario 5: Timestamp Format Validation</a></h3>
<pre><code class="language-wpl">rule timestamp_validation {
    # Select timestamp field
    | take(timestamp)

    # Match ISO 8601 format (YYYY-MM-DD HH:MM:SS)
    | regex_match('^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$')
}

# Example data:
# timestamp: "2024-01-29 15:30:45"  → ✅ Matched
# timestamp: "2024-1-9 5:3:5"       → ❌ Not matched (missing leading zeros)
# timestamp: "29/01/2024 15:30"     → ❌ Not matched (different format)
</code></pre>
<h3 id="scenario-6-http-method-validation"><a class="header" href="#scenario-6-http-method-validation">Scenario 6: HTTP Method Validation</a></h3>
<pre><code class="language-wpl">rule http_method_check {
    # Select HTTP method field
    | take(method)

    # Only accept safe HTTP methods
    | regex_match('^(GET|HEAD|OPTIONS)$')
}

# Example data:
# method: "GET"     → ✅ Matched
# method: "HEAD"    → ✅ Matched
# method: "POST"    → ❌ Not matched
# method: "DELETE"  → ❌ Not matched
</code></pre>
<h3 id="scenario-7-version-number-matching"><a class="header" href="#scenario-7-version-number-matching">Scenario 7: Version Number Matching</a></h3>
<pre><code class="language-wpl">rule version_check {
    # Select version field
    | take(version)

    # Match semantic version (e.g., 1.2.3)
    | regex_match('^\d+\.\d+\.\d+$')
}

# Example data:
# version: "1.0.0"     → ✅ Matched
# version: "2.10.5"    → ✅ Matched
# version: "1.0"       → ❌ Not matched (missing patch version)
# version: "v1.2.3"    → ❌ Not matched (has prefix)
</code></pre>
<h3 id="scenario-8-sql-injection-detection"><a class="header" href="#scenario-8-sql-injection-detection">Scenario 8: SQL Injection Detection</a></h3>
<pre><code class="language-wpl">rule sql_injection_detection {
    # Select user input field
    | take(user_input)

    # Detect common SQL injection patterns
    | regex_match('(?i)(union|select|insert|update|delete|drop|;|--|\|)')
}

# Example data:
# user_input: "SELECT * FROM users"  → ✅ Matched (detected)
# user_input: "'; DROP TABLE --"     → ✅ Matched (detected)
# user_input: "normal search query"  → ❌ Not matched (safe)
</code></pre>
<h3 id="scenario-9-file-extension-filtering"><a class="header" href="#scenario-9-file-extension-filtering">Scenario 9: File Extension Filtering</a></h3>
<pre><code class="language-wpl">rule image_file_filter {
    # Select filename field
    | take(filename)

    # Only match image files
    | regex_match('\.(?i)(jpg|jpeg|png|gif|bmp|svg)$')
}

# Example data:
# filename: "photo.jpg"      → ✅ Matched
# filename: "image.PNG"      → ✅ Matched (case insensitive)
# filename: "document.pdf"   → ❌ Not matched
</code></pre>
<h3 id="scenario-10-mac-address-validation"><a class="header" href="#scenario-10-mac-address-validation">Scenario 10: MAC Address Validation</a></h3>
<pre><code class="language-wpl">rule mac_address_validation {
    # Select MAC address field
    | take(mac)

    # Match MAC address format (XX:XX:XX:XX:XX:XX)
    | regex_match('^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$')
}

# Example data:
# mac: "00:1B:44:11:3A:B7"  → ✅ Matched
# mac: "AA:BB:CC:DD:EE:FF"  → ✅ Matched
# mac: "invalid-mac"        → ❌ Not matched
</code></pre>
<h2 id="usage-limitations-2"><a class="header" href="#usage-limitations-2">Usage Limitations</a></h2>
<h3 id="type-restrictions-1"><a class="header" href="#type-restrictions-1">Type Restrictions</a></h3>
<p><code>regex_match</code> can only process <strong>string type</strong> fields:</p>
<pre><code class="language-wpl"># ✅ Correct - field is string
message: "error occurred" -&gt; regex_match('error')

# ❌ Wrong - field is number
status_code: 404 -&gt; regex_match('\d+')  # Will fail

# ❌ Wrong - field is IP address (non-string type)
ip: 192.168.1.1 -&gt; regex_match('\d+')  # Will fail
</code></pre>
<h3 id="performance-considerations"><a class="header" href="#performance-considerations">Performance Considerations</a></h3>
<ol>
<li>
<p><strong>Regex Compilation Overhead</strong>:</p>
<ul>
<li>Regex is recompiled on every call</li>
<li>Complex regex compilation may take a few microseconds</li>
</ul>
</li>
<li>
<p><strong>Matching Performance</strong>:</p>
<ul>
<li>Simple patterns: Microsecond-level</li>
<li>Complex patterns (heavy backtracking): May be slower</li>
<li>Recommendation: Avoid overly complex regular expressions</li>
</ul>
</li>
<li>
<p><strong>Optimization Suggestions</strong>:</p>
<pre><code class="language-wpl"># ✅ Recommended: Simple and direct patterns
regex_match('^\d{4}$')

# ⚠️ Use with caution: Complex backtracking patterns
regex_match('^(a+)+b$')  # May cause performance issues
</code></pre>
</li>
</ol>
<h3 id="unsupported-features-1"><a class="header" href="#unsupported-features-1">Unsupported Features</a></h3>
<ol>
<li>
<p><strong>Named Capture Groups Not Supported</strong>:</p>
<pre><code class="language-wpl"># ❌ Not supported (cannot extract captured content)
regex_match('(?P&lt;year&gt;\d{4})')
</code></pre>
</li>
<li>
<p><strong>Replacement Not Supported</strong>:</p>
<pre><code class="language-wpl"># ❌ regex_match only matches, doesn't replace
# For replacement, use chars_replace
</code></pre>
</li>
<li>
<p><strong>Multiple Patterns Not Supported</strong>:</p>
<pre><code class="language-wpl"># ❌ Cannot pass multiple patterns
regex_match('pattern1', 'pattern2')

# ✅ Use alternation |
regex_match('pattern1|pattern2')
</code></pre>
</li>
</ol>
<h2 id="complete-examples-1"><a class="header" href="#complete-examples-1">Complete Examples</a></h2>
<h3 id="example-1-log-classification-pipeline"><a class="header" href="#example-1-log-classification-pipeline">Example 1: Log Classification Pipeline</a></h3>
<pre><code class="language-wpl">rule log_classification {
    # Select log message
    | take(message)

    # Classify as error log
    (
        | regex_match('(?i)(error|exception|failed|fatal)')
        | tag(level, ERROR)
    )
    |
    # Or classify as warning log
    (
        | regex_match('(?i)(warn|warning|deprecated)')
        | tag(level, WARNING)
    )
    |
    # Or classify as normal log
    (
        | tag(level, INFO)
    )
}
</code></pre>
<h3 id="example-2-security-audit-filtering"><a class="header" href="#example-2-security-audit-filtering">Example 2: Security Audit Filtering</a></h3>
<pre><code class="language-wpl">rule security_audit {
    # Check for dangerous patterns in user input
    | take(user_input)

    # Detect script injection
    | regex_match('(?i)(&lt;script|javascript:|onerror=)')

    # Or detect SQL injection
    | regex_match('(?i)(union|select.*from|insert.*into)')

    # Or detect path traversal
    | regex_match('(\.\./|\.\.\\)')

    # Log as security event if any match
    | tag(security_event, true)
}
</code></pre>
<h3 id="example-3-structured-log-parsing"><a class="header" href="#example-3-structured-log-parsing">Example 3: Structured Log Parsing</a></h3>
<pre><code class="language-wpl">rule structured_log_parsing {
    # Validate JSON log format
    | take(raw_message)
    | regex_match('^\{.*\}$')

    # Validate required fields are present
    | regex_match('"timestamp":\s*"\d{4}-\d{2}-\d{2}')
    | regex_match('"level":\s*"(INFO|WARN|ERROR)"')
    | regex_match('"message":\s*"[^"]+"')

    # Continue processing after all validations pass
}
</code></pre>
<h2 id="performance-notes-3"><a class="header" href="#performance-notes-3">Performance Notes</a></h2>
<ul>
<li><strong>Regex Compilation</strong>: Compiled on every call, recommend using simple patterns</li>
<li><strong>Matching Speed</strong>:
<ul>
<li>Simple patterns (e.g., <code>^\d+$</code>): &lt; 1μs</li>
<li>Medium complexity (e.g., email validation): 1-10μs</li>
<li>Complex patterns (heavy backtracking): May be &gt; 100μs</li>
</ul>
</li>
<li><strong>Memory Overhead</strong>: ~1-10KB per regular expression</li>
</ul>
<h2 id="error-handling-3"><a class="header" href="#error-handling-3">Error Handling</a></h2>
<h3 id="common-errors-3"><a class="header" href="#common-errors-3">Common Errors</a></h3>
<ol>
<li>
<p><strong>Invalid Regular Expression</strong></p>
<pre><code>Error: regex_match | invalid regex pattern
Cause: Regex syntax error
Solution: Check regex syntax
</code></pre>
</li>
<li>
<p><strong>Field Does Not Exist</strong></p>
<pre><code>Error: regex_match | no active field
Cause: No active field currently
Solution: Use take() to select field first
</code></pre>
</li>
<li>
<p><strong>Field Type Mismatch</strong></p>
<pre><code>Error: regex_match | field is not a string
Cause: Field is not a string type
Solution: Ensure field is Chars type
</code></pre>
</li>
<li>
<p><strong>Pattern Not Matched</strong></p>
<pre><code>Error: regex_match | not matched
Cause: Field content doesn't match regex
Solution: This is normal filtering logic
</code></pre>
</li>
</ol>
<h2 id="using-with-other-functions-1"><a class="header" href="#using-with-other-functions-1">Using with Other Functions</a></h2>
<h3 id="with-field-selectors-1"><a class="header" href="#with-field-selectors-1">With Field Selectors</a></h3>
<pre><code class="language-wpl"># Select field first, then match
| take(message)
| regex_match('error')
</code></pre>
<h3 id="with-conditional-checks-1"><a class="header" href="#with-conditional-checks-1">With Conditional Checks</a></h3>
<pre><code class="language-wpl"># Combine multiple conditions
| take(status)
| regex_match('^[45]\d{2}$')  # 4xx or 5xx
</code></pre>
<h3 id="with-chars_replace"><a class="header" href="#with-chars_replace">With chars_replace</a></h3>
<pre><code class="language-wpl"># Match first, then replace
| regex_match('error')
| chars_replace(error, ERROR)
</code></pre>
<h3 id="with-branch-logic"><a class="header" href="#with-branch-logic">With Branch Logic</a></h3>
<pre><code class="language-wpl"># Different patterns take different branches
(
    | regex_match('^2\d{2}$')  # 2xx
    | tag(status_class, success)
)
|
(
    | regex_match('^4\d{2}$')  # 4xx
    | tag(status_class, client_error)
)
</code></pre>
<h2 id="best-practices-4"><a class="header" href="#best-practices-4">Best Practices</a></h2>
<h3 id="1-prefer-single-quotes"><a class="header" href="#1-prefer-single-quotes">1. Prefer Single Quotes</a></h3>
<pre><code class="language-wpl"># ✅ Recommended
regex_match('^\d+$')

# ❌ Avoid (will cause parsing errors)
regex_match("^\d+$")
</code></pre>
<h3 id="2-use-anchors-to-clarify-match-scope"><a class="header" href="#2-use-anchors-to-clarify-match-scope">2. Use Anchors to Clarify Match Scope</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Complete match
regex_match('^\d{4}$')  # Exactly 4 digits

# ⚠️ May not match expectations: Partial match
regex_match('\d{4}')    # Contains 4 digits
</code></pre>
<h3 id="3-simplify-regular-expressions"><a class="header" href="#3-simplify-regular-expressions">3. Simplify Regular Expressions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Simple and clear
regex_match('^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$')

# ⚠️ Overly complex
regex_match('^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$')
</code></pre>
<h3 id="4-document-complex-patterns-with-comments"><a class="header" href="#4-document-complex-patterns-with-comments">4. Document Complex Patterns with Comments</a></h3>
<pre><code class="language-wpl"># Match email: username@domain.suffix
regex_match('^\w+@\w+\.\w+$')
</code></pre>
<h3 id="5-test-edge-cases-1"><a class="header" href="#5-test-edge-cases-1">5. Test Edge Cases</a></h3>
<pre><code class="language-wpl"># Test pattern boundaries
regex_match('^\d{2,4}$')
# Test: 1 ❌, 12 ✅, 123 ✅, 1234 ✅, 12345 ❌
</code></pre>
<h2 id="regular-expression-testing"><a class="header" href="#regular-expression-testing">Regular Expression Testing</a></h2>
<h3 id="online-testing-tools"><a class="header" href="#online-testing-tools">Online Testing Tools</a></h3>
<ol>
<li>
<p><strong>regex101.com</strong></p>
<ul>
<li>Select Rust flavor</li>
<li>Test your regular expressions</li>
<li>View match details and performance</li>
</ul>
</li>
<li>
<p><strong>regexr.com</strong></p>
<ul>
<li>Visualize matching process</li>
<li>Provides cheat sheet</li>
</ul>
</li>
</ol>
<h3 id="command-line-testing"><a class="header" href="#command-line-testing">Command Line Testing</a></h3>
<pre><code class="language-bash"># Test with WP-Motor
echo "test_value: 12345" | wp-motor test.wpl

# View match results
wp-motor --debug test.wpl &lt; test_data.log
</code></pre>
<h2 id="frequently-asked-questions-faq-3"><a class="header" href="#frequently-asked-questions-faq-3">Frequently Asked Questions (FAQ)</a></h2>
<h3 id="q1-why-must-i-use-single-quotes"><a class="header" href="#q1-why-must-i-use-single-quotes">Q1: Why must I use single quotes?</a></h3>
<p>Because WPL’s double-quoted string parser only supports limited escape sequences (<code>\"</code>, <code>\\</code>, <code>\n</code>, <code>\t</code>), while regular expressions need <code>\d</code>, <code>\w</code>, <code>\s</code>, etc., which will cause parsing failures.</p>
<h3 id="q2-how-do-i-match-a-dot-"><a class="header" href="#q2-how-do-i-match-a-dot-">Q2: How do I match a dot (.)?</a></h3>
<pre><code class="language-wpl"># Use backslash to escape
regex_match('\.')  # Matches literal dot
</code></pre>
<h3 id="q3-how-do-i-implement-case-insensitive-matching"><a class="header" href="#q3-how-do-i-implement-case-insensitive-matching">Q3: How do I implement case-insensitive matching?</a></h3>
<pre><code class="language-wpl"># Use (?i) flag
regex_match('(?i)error')  # Matches error, ERROR, Error
</code></pre>
<h3 id="q4-does-regex-match-completely-or-partially"><a class="header" href="#q4-does-regex-match-completely-or-partially">Q4: Does regex match completely or partially?</a></h3>
<p>Default is <strong>partial matching</strong>. Use <code>^</code> and <code>$</code> for complete matching:</p>
<pre><code class="language-wpl"># Partial match
regex_match('\d+')     # "abc123def" → ✅ Matched

# Complete match
regex_match('^\d+$')   # "abc123def" → ❌ Not matched
</code></pre>
<h3 id="q5-how-do-i-match-multiline-text"><a class="header" href="#q5-how-do-i-match-multiline-text">Q5: How do I match multiline text?</a></h3>
<pre><code class="language-wpl"># Use (?m) multiline mode
regex_match('(?m)^ERROR')  # Matches ERROR at start of any line

# Use (?s) single line mode to make . match newlines
regex_match('(?s)start.*end')  # Match across lines
</code></pre>
<h3 id="q6-what-about-performance"><a class="header" href="#q6-what-about-performance">Q6: What about performance?</a></h3>
<ul>
<li>Simple patterns: Very fast (microsecond-level)</li>
<li>Complex patterns: May be slower</li>
<li>Recommendation: Avoid overly complex backtracking patterns</li>
</ul>
<h3 id="q7-can-i-extract-matched-content"><a class="header" href="#q7-can-i-extract-matched-content">Q7: Can I extract matched content?</a></h3>
<p>Not supported. <code>regex_match</code> only performs match testing, doesn’t extract content.</p>
<h2 id="regular-expression-quick-reference"><a class="header" href="#regular-expression-quick-reference">Regular Expression Quick Reference</a></h2>
<h3 id="common-patterns"><a class="header" href="#common-patterns">Common Patterns</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Pattern</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>\d</code></td><td>Digit</td><td><code>\d+</code> matches “123”</td></tr>
<tr><td><code>\w</code></td><td>Word character</td><td><code>\w+</code> matches “hello”</td></tr>
<tr><td><code>\s</code></td><td>Whitespace</td><td><code>\s+</code> matches “   “</td></tr>
<tr><td><code>.</code></td><td>Any character</td><td><code>.*</code> matches anything</td></tr>
<tr><td><code>^</code></td><td>Start of line</td><td><code>^start</code> must match at beginning</td></tr>
<tr><td><code>$</code></td><td>End of line</td><td><code>end$</code> must match at end</td></tr>
<tr><td><code>*</code></td><td>Zero or more</td><td><code>a*</code> matches “”, “a”, “aa”</td></tr>
<tr><td><code>+</code></td><td>One or more</td><td><code>a+</code> matches “a”, “aa”</td></tr>
<tr><td><code>?</code></td><td>Zero or one</td><td><code>a?</code> matches “”, “a”</td></tr>
<tr><td><code>{n}</code></td><td>Exactly n times</td><td><code>\d{4}</code> matches “2024”</td></tr>
<tr><td><code>{n,m}</code></td><td>n to m times</td><td><code>\d{2,4}</code> matches “12”, “123”</td></tr>
<tr><td><code>[abc]</code></td><td>Character set</td><td><code>[aeiou]</code> matches vowels</td></tr>
<tr><td><code>[^abc]</code></td><td>Negated set</td><td><code>[^0-9]</code> matches non-digits</td></tr>
<tr><td><code>|</code></td><td>Alternation</td><td><code>cat|dog</code> matches “cat” or “dog”</td></tr>
<tr><td><code>()</code></td><td>Group</td><td><code>(ab)+</code> matches “ab”, “abab”</td></tr>
</tbody>
</table>
</div>
<h2 id="additional-resources-3"><a class="header" href="#additional-resources-3">Additional Resources</a></h2>
<ul>
<li><strong>Rust Regex Documentation</strong>: https://docs.rs/regex/</li>
<li><strong>Development Guide</strong>: <code>docs/guide/wpl_field_func_development_guide.md</code></li>
<li><strong>Source Code</strong>: <code>crates/wp-lang/src/ast/processor/function.rs</code></li>
<li><strong>Test Cases</strong>: <code>crates/wp-lang/src/eval/builtins/pipe_fun.rs</code></li>
</ul>
<h2 id="version-history-4"><a class="header" href="#version-history-4">Version History</a></h2>
<ul>
<li><strong>1.13.1</strong> (2026-02-02)
<ul>
<li>Initial implementation</li>
<li>Support complete Rust regex syntax</li>
<li>Support all standard regular expression features</li>
<li>Add comprehensive test coverage</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: While <code>regex_match</code> is powerful, it may impact performance. For simple string matching, consider using <code>chars_has</code> or <code>chars_in</code>; for numeric range checks, use <code>digit_range</code> or <code>digit_in</code>. Regular expressions are suitable for complex pattern matching scenarios.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="digit_range-function-usage-guide"><a class="header" href="#digit_range-function-usage-guide">digit_range Function Usage Guide</a></h1>
<h2 id="overview-5"><a class="header" href="#overview-5">Overview</a></h2>
<p><code>digit_range</code> is a numeric range checking function in WPL (WP Language) used to determine whether a log field’s numeric value falls within a specified single range. This is a simple and efficient closed-interval checking function.</p>
<h2 id="quick-start-7"><a class="header" href="#quick-start-7">Quick Start</a></h2>
<h3 id="basic-syntax-6"><a class="header" href="#basic-syntax-6">Basic Syntax</a></h3>
<pre><code class="language-wpl">digit_range(begin, end)
</code></pre>
<ul>
<li><strong>begin</strong>: Lower bound of the range (scalar value)</li>
<li><strong>end</strong>: Upper bound of the range (scalar value)</li>
<li>Check method: <code>begin &lt;= value &lt;= end</code> (closed interval)</li>
</ul>
<h3 id="simple-examples-4"><a class="header" href="#simple-examples-4">Simple Examples</a></h3>
<pre><code class="language-wpl"># Check if value is in [0, 100] range
digit_range(0, 100)

# Check HTTP success status codes (200-299)
digit_range(200, 299)

# Check if port number is in standard range (0-65535)
digit_range(0, 65535)
</code></pre>
<h2 id="parameter-format"><a class="header" href="#parameter-format">Parameter Format</a></h2>
<h3 id="1-single-range"><a class="header" href="#1-single-range">1. Single Range</a></h3>
<p>Check a single continuous range:</p>
<pre><code class="language-wpl"># Check if port number is in standard range (0-65535)
digit_range(0, 65535)

# Check HTTP success status codes (200-299)
digit_range(200, 299)

# Check if age is adult (18-150)
digit_range(18, 150)
</code></pre>
<h3 id="2-range-limitation-explanation"><a class="header" href="#2-range-limitation-explanation">2. Range Limitation Explanation</a></h3>
<p><strong>Note</strong>: Starting from version 1.13.1, <code>digit_range</code> only supports single range checking. For checking multiple discontinuous ranges, please use multiple rules or branching logic (see “Using with Branching Logic” section below).</p>
<pre><code class="language-wpl"># ✅ Single range check
digit_range(200, 299)  # 2xx status code

# ❌ Multiple range array syntax no longer supported
# digit_range([200, 300], [299, 399])  # Old syntax, deprecated
</code></pre>
<h3 id="3-boundary-value-handling"><a class="header" href="#3-boundary-value-handling">3. Boundary Value Handling</a></h3>
<p>Range checking is a <strong>closed interval</strong>, including boundary values:</p>
<pre><code class="language-wpl"># [100, 200] - includes both 100 and 200
digit_range(100, 200)

# Check value 100: ✅ Pass (equals lower bound)
# Check value 200: ✅ Pass (equals upper bound)
# Check value 150: ✅ Pass (within range)
# Check value 99:  ❌ Fail (less than lower bound)
# Check value 201: ❌ Fail (greater than upper bound)
</code></pre>
<h3 id="4-negative-number-ranges"><a class="header" href="#4-negative-number-ranges">4. Negative Number Ranges</a></h3>
<p>Supports negative number ranges:</p>
<pre><code class="language-wpl"># Temperature range check (-20°C to 40°C)
digit_range(-20, 40)

# Elevation range (Dead Sea -400m to Mount Everest 8848m)
digit_range(-400, 8848)
</code></pre>
<h2 id="practical-application-scenarios-1"><a class="header" href="#practical-application-scenarios-1">Practical Application Scenarios</a></h2>
<h3 id="scenario-1-http-status-code-classification"><a class="header" href="#scenario-1-http-status-code-classification">Scenario 1: HTTP Status Code Classification</a></h3>
<pre><code class="language-wpl">rule http_success_check {
    # Select status code field
    | take(status_code)

    # Check if it's a success status code (2xx)
    | digit_range(200, 299)
}

# Example data:
# status_code: 200  → ✅ Pass (in [200,299] range)
# status_code: 204  → ✅ Pass (in [200,299] range)
# status_code: 301  → ❌ Fail (not in range)
# status_code: 404  → ❌ Fail (not in range)

# To check multiple status code ranges (e.g., 2xx or 3xx), use branching logic:
rule http_ok_or_redirect {
    | take(status_code)
    | (digit_range(200, 299) | digit_range(300, 399))
}
</code></pre>
<h3 id="scenario-2-performance-metrics-monitoring"><a class="header" href="#scenario-2-performance-metrics-monitoring">Scenario 2: Performance Metrics Monitoring</a></h3>
<pre><code class="language-wpl">rule response_time_check {
    # Select response time field (milliseconds)
    | take(response_time)

    # Check if response time is in normal range (0-500ms)
    | digit_range(0, 500)
}

# Example data:
# response_time: 50   → ✅ Pass (fast response)
# response_time: 200  → ✅ Pass (normal response)
# response_time: 1000 → ❌ Fail (timeout)
</code></pre>
<h3 id="scenario-3-port-number-validation"><a class="header" href="#scenario-3-port-number-validation">Scenario 3: Port Number Validation</a></h3>
<pre><code class="language-wpl">rule system_port_check {
    # Select port field
    | take(port)

    # Check if it's a system reserved port (1-1023)
    | digit_range(1, 1023)
}

# Example data:
# port: 80    → ✅ Pass (HTTP default port)
# port: 443   → ✅ Pass (HTTPS default port)
# port: 8080  → ❌ Fail (user port)
</code></pre>
<h3 id="scenario-4-time-period-filtering"><a class="header" href="#scenario-4-time-period-filtering">Scenario 4: Time Period Filtering</a></h3>
<pre><code class="language-wpl">rule morning_hours_check {
    # Select hour field
    | take(hour)

    # Check if it's morning working hours (9-12)
    | digit_range(9, 12)
}

# Example data:
# hour: 10  → ✅ Pass (morning working hours)
# hour: 11  → ✅ Pass (morning working hours)
# hour: 15  → ❌ Fail (afternoon time)

# Check multiple time periods, use branching logic:
rule business_hours_check {
    | take(hour)
    | (digit_range(9, 12) | digit_range(14, 18))
}
</code></pre>
<h3 id="scenario-5-age-segmentation"><a class="header" href="#scenario-5-age-segmentation">Scenario 5: Age Segmentation</a></h3>
<pre><code class="language-wpl">rule adult_age_check {
    # Select age field
    | take(age)

    # Adult age range (18-65)
    | digit_range(18, 65)
}

# Example data:
# age: 30  → ✅ Pass (adult)
# age: 50  → ✅ Pass (adult)
# age: 15  → ❌ Fail (minor)
# age: 70  → ❌ Fail (elderly)
</code></pre>
<h3 id="scenario-6-priority-filtering"><a class="header" href="#scenario-6-priority-filtering">Scenario 6: Priority Filtering</a></h3>
<pre><code class="language-wpl">rule high_priority_filter {
    # Select priority field
    | take(priority)

    # Only process high priority (1-3)
    | digit_range(1, 3)
}

# Example data:
# priority: 1  → ✅ Pass (high priority)
# priority: 3  → ✅ Pass (high priority)
# priority: 5  → ❌ Fail (medium priority)
</code></pre>
<h3 id="scenario-7-data-quality-check"><a class="header" href="#scenario-7-data-quality-check">Scenario 7: Data Quality Check</a></h3>
<pre><code class="language-wpl">rule data_quality_check {
    # Check temperature sensor data
    | take(temperature)

    # Normal temperature range (-40°C to 80°C)
    | digit_range(-40, 80)
}

# Example data:
# temperature: 25   → ✅ Pass (normal room temperature)
# temperature: -10  → ✅ Pass (winter temperature)
# temperature: 100  → ❌ Fail (abnormal data)
# temperature: -100 → ❌ Fail (sensor fault)
</code></pre>
<h2 id="usage-limitations-3"><a class="header" href="#usage-limitations-3">Usage Limitations</a></h2>
<h3 id="type-restrictions-2"><a class="header" href="#type-restrictions-2">Type Restrictions</a></h3>
<p><code>digit_range</code> can only process <strong>numeric type</strong> fields:</p>
<pre><code class="language-wpl"># ✅ Correct - field is a number
status_code: 200 -&gt; digit_range(200, 299)

# ❌ Wrong - field is a string
level: "200" -&gt; digit_range(200, 299)  # Will fail

# ❌ Wrong - field is an IP address
ip: 192.168.1.1 -&gt; digit_range(192, 200)  # Will fail
</code></pre>
<h3 id="parameter-requirements"><a class="header" href="#parameter-requirements">Parameter Requirements</a></h3>
<ol>
<li>
<p><strong>Parameters must be scalar values</strong>:</p>
<pre><code class="language-wpl"># ✅ Correct - using scalar values
digit_range(1, 10)

# ❌ Wrong - array parameters not supported (old syntax)
digit_range([1], [10])  # Deprecated
</code></pre>
</li>
<li>
<p><strong>Lower bound should be less than or equal to upper bound</strong>:</p>
<pre><code class="language-wpl"># ✅ Correct
digit_range(1, 10)      # 1 &lt;= x &lt;= 10
digit_range(10, 10)     # x == 10 (single point)

# ⚠️ Logical error (won't match any value)
digit_range(10, 1)      # 10 &lt;= x &lt;= 1 (always false)
</code></pre>
</li>
</ol>
<h3 id="unsupported-features-2"><a class="header" href="#unsupported-features-2">Unsupported Features</a></h3>
<ol>
<li>
<p><strong>Does not support precise floating-point matching</strong>:</p>
<pre><code class="language-wpl"># ⚠️ Note: Uses i64 internally, floating-point numbers are rounded
digit_range(1, 10)  # Can only match integers
</code></pre>
</li>
<li>
<p><strong>Does not support infinite ranges</strong>:</p>
<pre><code class="language-wpl"># ❌ Not supported
digit_range(0, infinity)  # No infinite value
</code></pre>
</li>
<li>
<p><strong>Does not support multiple range arrays</strong>:</p>
<pre><code class="language-wpl"># ❌ Not supported (old syntax deprecated)
digit_range([1, 100], [10, 200])  # Use branching logic instead
</code></pre>
</li>
</ol>
<h2 id="complete-examples-2"><a class="header" href="#complete-examples-2">Complete Examples</a></h2>
<h3 id="example-1-log-severity-filtering"><a class="header" href="#example-1-log-severity-filtering">Example 1: Log Severity Filtering</a></h3>
<pre><code class="language-wpl">rule log_error_filter {
    # Select severity level field
    | take(severity)

    # Filter ERROR level (1-2)
    | digit_range(1, 2)

    # Further processing...
}

# Log level definitions:
# 1 = CRITICAL
# 2 = ERROR
# 3 = WARNING
# 4 = WARN
# 5 = INFO
# 6 = DEBUG
</code></pre>
<h3 id="example-2-performance-monitoring-combination"><a class="header" href="#example-2-performance-monitoring-combination">Example 2: Performance Monitoring Combination</a></h3>
<pre><code class="language-wpl">rule performance_monitor {
    # Check response time
    | take(response_ms)
    | digit_range(0, 1000)  # 0-1000ms considered normal

    # Check status code
    | take(status)
    | digit_range(200, 299)  # 2xx

    # Both conditions must be satisfied to pass
}
</code></pre>
<h3 id="example-3-time-window-analysis"><a class="header" href="#example-3-time-window-analysis">Example 3: Time Window Analysis</a></h3>
<pre><code class="language-wpl">rule weekday_check {
    # Weekday check (1=Monday, 7=Sunday)
    | take(day_of_week)
    | digit_range(1, 5)  # Monday to Friday

    # Analyze only weekday data
}
</code></pre>
<h2 id="performance-notes-4"><a class="header" href="#performance-notes-4">Performance Notes</a></h2>
<ul>
<li><strong>Time Complexity</strong>: O(1) - Single comparison</li>
<li><strong>Space Complexity</strong>: O(1) - In-place check</li>
<li><strong>Performance Characteristics</strong>:
<ul>
<li>Nanosecond-level execution time</li>
<li>Simple integer comparison operation</li>
<li>Excellent performance, suitable for high-frequency calls</li>
</ul>
</li>
</ul>
<h2 id="error-handling-4"><a class="header" href="#error-handling-4">Error Handling</a></h2>
<h3 id="common-errors-4"><a class="header" href="#common-errors-4">Common Errors</a></h3>
<ol>
<li>
<p><strong>Field does not exist</strong></p>
<pre><code>Error: &lt;pipe&gt; | not in range
Cause: No active field currently
Solution: Use take() to select field first
</code></pre>
</li>
<li>
<p><strong>Field type mismatch</strong></p>
<pre><code>Error: &lt;pipe&gt; | not in range
Cause: Field is not a numeric type (Digit)
Solution: Ensure field is numeric type
</code></pre>
</li>
<li>
<p><strong>Value not in any range</strong></p>
<pre><code>Error: &lt;pipe&gt; | not in range
Cause: Field value doesn't satisfy any range condition
Solution: Check if range settings are correct
</code></pre>
</li>
</ol>
<h2 id="using-with-other-functions-2"><a class="header" href="#using-with-other-functions-2">Using with Other Functions</a></h2>
<h3 id="with-field-selectors-2"><a class="header" href="#with-field-selectors-2">With Field Selectors</a></h3>
<pre><code class="language-wpl"># Select field first, then check range
| take(status_code)
| digit_range(200, 299)
</code></pre>
<h3 id="with-conditional-checks-2"><a class="header" href="#with-conditional-checks-2">With Conditional Checks</a></h3>
<pre><code class="language-wpl"># Check field exists first, then check range
| has()
| digit_range(0, 100)
</code></pre>
<h3 id="with-conversion-functions-1"><a class="header" href="#with-conversion-functions-1">With Conversion Functions</a></h3>
<pre><code class="language-wpl"># Combine for complex validation
| take(response_time)
| digit_range(0, 1000)  # Response time normal
| take(status_code)
| digit_range(200, 299)  # Status code normal
</code></pre>
<h3 id="with-branching-logic"><a class="header" href="#with-branching-logic">With Branching Logic</a></h3>
<pre><code class="language-wpl"># Use alt for "or" logic - check multiple discontinuous ranges
(
    # Branch 1: Check if success status code
    | take(status)
    | digit_range(200, 299)
)
|
(
    # Branch 2: Check if redirect status code
    | take(status)
    | digit_range(300, 399)
)
</code></pre>
<h2 id="best-practices-5"><a class="header" href="#best-practices-5">Best Practices</a></h2>
<h3 id="1-range-design-principles"><a class="header" href="#1-range-design-principles">1. Range Design Principles</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Semantically clear range
digit_range(200, 299)  # HTTP 2xx status code

# ⚠️ Avoid: Using old array syntax
# digit_range([200], [299])  # Deprecated
</code></pre>
<h3 id="2-concise-and-clear-single-range"><a class="header" href="#2-concise-and-clear-single-range">2. Concise and Clear Single Range</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Simple and direct single range
digit_range(0, 100)

# ✅ Recommended: Multiple ranges use branching logic
(digit_range(0, 50) | digit_range(100, 150))
</code></pre>
<h3 id="3-range-readability"><a class="header" href="#3-range-readability">3. Range Readability</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Add comments explaining range meaning
| digit_range(200, 299)  # HTTP success status codes

# ✅ Recommended: Use meaningful ranges
| digit_range(18, 65)  # Working age range
</code></pre>
<h3 id="4-boundary-value-testing"><a class="header" href="#4-boundary-value-testing">4. Boundary Value Testing</a></h3>
<pre><code class="language-wpl"># Test if boundary values meet expectations
digit_range(100, 200)
# Test: 100 ✅, 200 ✅, 99 ❌, 201 ❌
</code></pre>
<h3 id="5-using-branching-for-discontinuous-ranges"><a class="header" href="#5-using-branching-for-discontinuous-ranges">5. Using Branching for Discontinuous Ranges</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Clear branching logic
(
    digit_range(1, 10)   # First range
    |
    digit_range(50, 100) # Second range
)

# ❌ Avoid: Using deprecated array syntax
# digit_range([1, 50], [10, 100])
</code></pre>
<h2 id="debugging-tips-3"><a class="header" href="#debugging-tips-3">Debugging Tips</a></h2>
<h3 id="1-test-single-range"><a class="header" href="#1-test-single-range">1. Test Single Range</a></h3>
<pre><code class="language-wpl"># Start with a simple single range
| digit_range(0, 100)

# For multiple ranges, use branching logic
| (digit_range(0, 100) | digit_range(200, 300))
</code></pre>
<h3 id="2-verify-field-type"><a class="header" href="#2-verify-field-type">2. Verify Field Type</a></h3>
<pre><code class="language-wpl"># Use digit_has() to confirm field is numeric type
| take(my_field)
| digit_has(0)  # If it fails, it's not a numeric field
</code></pre>
<h3 id="3-check-boundary-values"><a class="header" href="#3-check-boundary-values">3. Check Boundary Values</a></h3>
<pre><code class="language-bash"># Prepare test data
echo "value: 99" | wp-motor test.wpl    # Test lower bound-1
echo "value: 100" | wp-motor test.wpl   # Test lower bound
echo "value: 200" | wp-motor test.wpl   # Test upper bound
echo "value: 201" | wp-motor test.wpl   # Test upper bound+1
</code></pre>
<h2 id="frequently-asked-questions-faq-4"><a class="header" href="#frequently-asked-questions-faq-4">Frequently Asked Questions (FAQ)</a></h2>
<h3 id="q1-how-to-check-a-single-specific-value"><a class="header" href="#q1-how-to-check-a-single-specific-value">Q1: How to check a single specific value?</a></h3>
<pre><code class="language-wpl"># Set lower and upper bounds to the same value
digit_range(200, 200)  # Only matches 200
</code></pre>
<h3 id="q2-can-the-range-be-in-reverse-order"><a class="header" href="#q2-can-the-range-be-in-reverse-order">Q2: Can the range be in reverse order?</a></h3>
<p>Technically yes, but logically meaningless:</p>
<pre><code class="language-wpl">digit_range(100, 50)  # begin &gt; end, never matches
</code></pre>
<h3 id="q3-how-to-implement-not-in-range-logic"><a class="header" href="#q3-how-to-implement-not-in-range-logic">Q3: How to implement “not in range” logic?</a></h3>
<p>Pipeline failure interrupts in WPL, can use branching logic:</p>
<pre><code class="language-wpl"># Using negation logic (complex)
# Recommendation: Use other field functions or handle in application layer
</code></pre>
<h3 id="q4-does-it-support-floating-point-numbers"><a class="header" href="#q4-does-it-support-floating-point-numbers">Q4: Does it support floating-point numbers?</a></h3>
<p>Uses <code>i64</code> internally, floating-point numbers are converted:</p>
<pre><code class="language-wpl"># Field value 3.14 will be treated as 3
digit_range(3, 4)  # May match 3.14 (depending on parsing method)
</code></pre>
<h3 id="q5-how-to-check-multiple-discontinuous-ranges"><a class="header" href="#q5-how-to-check-multiple-discontinuous-ranges">Q5: How to check multiple discontinuous ranges?</a></h3>
<p>Use branching logic (alt operator):</p>
<pre><code class="language-wpl"># Check [1,10] or [100,200] ranges
(digit_range(1, 10) | digit_range(100, 200))
# Matches: any value in [1,10] or [100,200]
</code></pre>
<h3 id="q6-is-performance-sufficient"><a class="header" href="#q6-is-performance-sufficient">Q6: Is performance sufficient?</a></h3>
<p>Very fast! Range checking is simple numeric comparison:</p>
<ul>
<li>O(1) time complexity</li>
<li>Nanosecond-level execution time</li>
<li>Suitable for high-frequency call scenarios</li>
</ul>
<h3 id="q7-can-the-old-array-syntax-still-be-used"><a class="header" href="#q7-can-the-old-array-syntax-still-be-used">Q7: Can the old array syntax still be used?</a></h3>
<p>Not recommended, deprecated:</p>
<pre><code class="language-wpl"># ❌ Old syntax (deprecated)
digit_range([200], [299])

# ✅ New syntax (recommended)
digit_range(200, 299)
</code></pre>
<h2 id="comparison-with-digit_in"><a class="header" href="#comparison-with-digit_in">Comparison with digit_in</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>digit_range</th><th>digit_in</th></tr>
</thead>
<tbody>
<tr><td>Purpose</td><td>Single range check</td><td>Set membership check</td></tr>
<tr><td>Parameters</td><td>Two scalars (begin, end)</td><td>One array (value list)</td></tr>
<tr><td>Use Case</td><td>Continuous range</td><td>Discrete values</td></tr>
<tr><td>Example</td><td><code>digit_range(0, 100)</code></td><td><code>digit_in([200, 404, 500])</code></td></tr>
<tr><td>Complexity</td><td>O(1)</td><td>O(n)</td></tr>
</tbody>
</table>
</div>
<pre><code class="language-wpl"># digit_range - suitable for continuous ranges
digit_range(200, 299)  # 200, 201, ..., 299

# digit_in - suitable for discrete values
digit_in([200, 404, 500])  # Only matches these three values

# Multiple discontinuous ranges - use branching logic
(digit_range(200, 299) | digit_range(300, 399))
</code></pre>
<h2 id="additional-resources-4"><a class="header" href="#additional-resources-4">Additional Resources</a></h2>
<ul>
<li><strong>Development Guide</strong>: <code>docs/guide/wpl_field_func_development_guide.md</code></li>
<li><strong>Source Code</strong>: <code>crates/wp-lang/src/ast/processor/function.rs</code></li>
<li><strong>Test Cases</strong>: <code>crates/wp-lang/src/eval/builtins/pipe_fun.rs</code></li>
</ul>
<h2 id="version-history-5"><a class="header" href="#version-history-5">Version History</a></h2>
<ul>
<li><strong>1.13.1</strong> (2026-02-02)
<ul>
<li>Refactored to two-parameter form: <code>digit_range(begin, end)</code></li>
<li>Deprecated old array syntax: <code>digit_range([begins], [ends])</code></li>
<li>Simplified to single range check, performance optimized to O(1)</li>
<li>Support for negative number ranges</li>
<li>Added complete test coverage</li>
</ul>
</li>
</ul>
<hr>
<p><strong>Tip</strong>: <code>digit_range</code> is now a simple and efficient single range checking function, suitable for handling continuous numeric range validation scenarios such as status codes, performance metrics, time periods, etc. For multiple discontinuous ranges, please use branching logic (alt operator). For discrete value checking, please use the <code>digit_in</code> function.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="not---result-inversion-wrapper-function"><a class="header" href="#not---result-inversion-wrapper-function">not() - Result Inversion Wrapper Function</a></h1>
<h2 id="overview-6"><a class="header" href="#overview-6">Overview</a></h2>
<p><code>not()</code> is a wrapper function that inverts the success/failure result of an inner pipe function. When the inner function succeeds, <code>not()</code> fails; when the inner function fails, <code>not()</code> succeeds.</p>
<p><strong>Syntax</strong>:</p>
<pre><code class="language-wpl">| not(inner_function)
</code></pre>
<p><strong>Parameters</strong>:</p>
<ul>
<li><code>inner_function</code>: Any field pipe function (e.g., <code>f_chars_has</code>, <code>has</code>, <code>chars_has</code>, etc.)</li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li>Inner function succeeds → <code>not()</code> fails</li>
<li>Inner function fails → <code>not()</code> succeeds</li>
</ul>
<p><strong>Key Features</strong>:</p>
<ul>
<li>✅ <strong>Preserves Field Value</strong>: <code>not()</code> only inverts the result, doesn’t modify field content</li>
<li>✅ <strong>Supports Nesting</strong>: Can use <code>not(not(...))</code> for double negation</li>
<li>✅ <strong>Automatic Field Selection</strong>: Inherits field selection behavior from inner function</li>
<li>✅ <strong>Zero Performance Overhead</strong>: Only clones a single field for testing</li>
</ul>
<h2 id="basic-usage"><a class="header" href="#basic-usage">Basic Usage</a></h2>
<h3 id="1-string-inequality-check"><a class="header" href="#1-string-inequality-check">1. String Inequality Check</a></h3>
<pre><code class="language-wpl"># Check dev_type is not equal to "NDS"
(chars:dev_type) | not(chars_has(NDS))

# Equivalent to
(chars:dev_type) | chars_not_has(NDS)
</code></pre>
<h3 id="2-field-non-existence-check"><a class="header" href="#2-field-non-existence-check">2. Field Non-Existence Check</a></h3>
<pre><code class="language-wpl"># Check field doesn't exist
| not(f_has(optional_field))
</code></pre>
<h3 id="3-using-target-field-functions"><a class="header" href="#3-using-target-field-functions">3. Using Target Field Functions</a></h3>
<pre><code class="language-wpl"># Check specified field not equal to value
| not(f_chars_has(status, ERROR))

# Check specified field not in list
| not(f_chars_in(level, [DEBUG, TRACE]))
</code></pre>
<h2 id="advanced-usage-1"><a class="header" href="#advanced-usage-1">Advanced Usage</a></h2>
<h3 id="double-negation"><a class="header" href="#double-negation">Double Negation</a></h3>
<p>Double negation is equivalent to positive assertion:</p>
<pre><code class="language-wpl"># not(not(...)) is equivalent to using inner function directly
| not(not(f_chars_has(status, OK)))

# Equivalent to
| f_chars_has(status, OK)
</code></pre>
<h3 id="combining-complex-conditions"><a class="header" href="#combining-complex-conditions">Combining Complex Conditions</a></h3>
<pre><code class="language-wpl"># Field exists but value doesn't equal target
| f_has(dev_type)           # Ensure field exists
| not(chars_has(NDS))       # Ensure value not equal to NDS
</code></pre>
<h3 id="combining-with-numeric-functions"><a class="header" href="#combining-with-numeric-functions">Combining with Numeric Functions</a></h3>
<pre><code class="language-wpl"># Check status code not in success range
| not(f_digit_range(status, 200, 299))

# Check port not in common port list
| not(f_digit_in(port, [80, 443, 8080]))
</code></pre>
<h3 id="combining-with-regular-expressions"><a class="header" href="#combining-with-regular-expressions">Combining with Regular Expressions</a></h3>
<pre><code class="language-wpl"># Check message doesn't match error pattern
| not(regex_match('(?i)error|fail|exception'))
</code></pre>
<h2 id="comparison-with-existing-functions"><a class="header" href="#comparison-with-existing-functions">Comparison with Existing Functions</a></h2>
<h3 id="notchars_has-vs-chars_not_has"><a class="header" href="#notchars_has-vs-chars_not_has">not(chars_has) vs chars_not_has</a></h3>
<p>While functionally similar, semantics are slightly different:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Field Missing</th><th>Non-Chars Type</th><th>Value Not Equal</th><th>Value Equal</th></tr>
</thead>
<tbody>
<tr><td><code>not(chars_has(X))</code></td><td>✅ Success</td><td>✅ Success</td><td>✅ Success</td><td>❌ Failure</td></tr>
<tr><td><code>chars_not_has(X)</code></td><td>✅ Success</td><td>✅ Success</td><td>✅ Success</td><td>❌ Failure</td></tr>
</tbody>
</table>
</div>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Simple scenarios: Use <code>chars_not_has</code> (more intuitive)</li>
<li>Complex scenarios: Use <code>not()</code> wrapper (more flexible)</li>
</ul>
<pre><code class="language-wpl"># ✅ Recommended: Simple negation
| chars_not_has(ERROR)

# ✅ Recommended: Complex condition negation
| not(f_digit_range(code, 400, 499))
</code></pre>
<h2 id="practical-use-cases-3"><a class="header" href="#practical-use-cases-3">Practical Use Cases</a></h2>
<h3 id="scenario-1-filter-non-error-logs"><a class="header" href="#scenario-1-filter-non-error-logs">Scenario 1: Filter Non-Error Logs</a></h3>
<pre><code class="language-wpl">rule filter_non_errors {
    # Parse log level
    (symbol(ERROR), symbol(WARN), symbol(INFO), symbol(DEBUG):level)

    # Keep only non-ERROR and non-WARN logs
    | take(level)
    | not(chars_in([ERROR, WARN]))
}
</code></pre>
<p><strong>Input</strong>:</p>
<pre><code>INFO: Application started
ERROR: Connection failed
DEBUG: Processing request
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>INFO: Application started     # ✅ Pass (non-error)
                              # ❌ Filter out ERROR
DEBUG: Processing request     # ✅ Pass (non-error)
</code></pre>
<h3 id="scenario-2-exclude-specific-device-types"><a class="header" href="#scenario-2-exclude-specific-device-types">Scenario 2: Exclude Specific Device Types</a></h3>
<pre><code class="language-wpl">rule exclude_device_types {
    # Parse device type field
    (chars:dev_type)

    # Exclude NDS and IDS devices
    | not(f_chars_in(dev_type, [NDS, IDS]))
}
</code></pre>
<p><strong>Input</strong>:</p>
<pre><code>dev_type=FIREWALL
dev_type=NDS
dev_type=ROUTER
dev_type=IDS
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>dev_type=FIREWALL    # ✅ Pass
                     # ❌ Filter out NDS
dev_type=ROUTER      # ✅ Pass
                     # ❌ Filter out IDS
</code></pre>
<h3 id="scenario-3-non-standard-port-check"><a class="header" href="#scenario-3-non-standard-port-check">Scenario 3: Non-Standard Port Check</a></h3>
<pre><code class="language-wpl">rule non_standard_ports {
    # Parse port number
    (digit:port)

    # Exclude standard ports 80 and 443
    | not(f_digit_in(port, [80, 443]))

    # Must also be in valid range
    | digit_range(1, 65535)
}
</code></pre>
<p><strong>Input</strong>:</p>
<pre><code>80
8080
443
9000
</code></pre>
<p><strong>Output</strong>:</p>
<pre><code>                # ❌ Filter out 80 (standard port)
8080            # ✅ Pass
                # ❌ Filter out 443 (standard port)
9000            # ✅ Pass
</code></pre>
<h3 id="scenario-4-exclude-test-environment-logs"><a class="header" href="#scenario-4-exclude-test-environment-logs">Scenario 4: Exclude Test Environment Logs</a></h3>
<pre><code class="language-wpl">rule exclude_test_env {
    # Parse environment identifier
    (chars:env)

    # Exclude test and development environments
    | not(f_chars_in(env, [test, dev, staging]))
}
</code></pre>
<h2 id="performance-considerations-1"><a class="header" href="#performance-considerations-1">Performance Considerations</a></h2>
<h3 id="performance-characteristics"><a class="header" href="#performance-characteristics">Performance Characteristics</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Operation</th><th>Performance Impact</th></tr>
</thead>
<tbody>
<tr><td>Single-layer <code>not()</code></td><td>&lt; 200ns (clone single field)</td></tr>
<tr><td>Double-layer <code>not(not())</code></td><td>&lt; 400ns (two clones)</td></tr>
<tr><td>Field selection inheritance</td><td>0ns (no extra overhead)</td></tr>
</tbody>
</table>
</div>
<h3 id="performance-optimization-tips"><a class="header" href="#performance-optimization-tips">Performance Optimization Tips</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Use dedicated function (faster)
| chars_not_has(ERROR)

# ⚠️ Acceptable: Use not() wrapper (slightly slower)
| not(chars_has(ERROR))

# ❌ Not recommended: Excessive nesting
| not(not(not(chars_has(ERROR))))  # Meaningless multiple negation
</code></pre>
<h2 id="common-pitfalls"><a class="header" href="#common-pitfalls">Common Pitfalls</a></h2>
<h3 id="pitfall-1-confusing-pipe-level-not-with-group-level-not"><a class="header" href="#pitfall-1-confusing-pipe-level-not-with-group-level-not">Pitfall 1: Confusing Pipe-Level not() with Group-Level not()</a></h3>
<pre><code class="language-wpl"># ❌ Wrong: This is group-level not(), not pipe-level
not(symbol(ERROR):test)

# ✅ Correct: Pipe-level not() for pipe functions
(chars:status) | not(chars_has(ERROR))
</code></pre>
<h3 id="pitfall-2-expecting-not-to-modify-field-value"><a class="header" href="#pitfall-2-expecting-not-to-modify-field-value">Pitfall 2: Expecting not() to Modify Field Value</a></h3>
<pre><code class="language-wpl"># ❌ Misconception: Thinking not() modifies field
(chars:status) | not(chars_has(ERROR))
# Field value remains original, not() only inverts match result

# ✅ Correct: Use transformation functions to modify value
(chars:status) | chars_replace(ERROR, OK)
</code></pre>
<h3 id="pitfall-3-wrapping-non-field-functions-with-not"><a class="header" href="#pitfall-3-wrapping-non-field-functions-with-not">Pitfall 3: Wrapping Non-Field Functions with not()</a></h3>
<pre><code class="language-wpl"># ❌ Wrong: take is not a field pipe function
| not(take(field_name))
# Error: not() can only wrap field pipe functions

# ✅ Correct: Wrap field pipe functions
| not(f_has(field_name))
</code></pre>
<h2 id="difference-from-group-level-not"><a class="header" href="#difference-from-group-level-not">Difference from Group-Level not()</a></h2>
<p>WPL has two types of <code>not()</code>:</p>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Feature</th><th>Pipe-Level <code>not()</code></th><th>Group-Level <code>not()</code></th></tr>
</thead>
<tbody>
<tr><td>Purpose</td><td>Invert pipe function result</td><td>Invert field group match</td></tr>
<tr><td>Syntax Position</td><td>In pipe <code>| not(...)</code></td><td>Field group definition <code>not(...)</code></td></tr>
<tr><td>Parameter Type</td><td>Pipe function</td><td>Field definition</td></tr>
<tr><td>Return Result</td><td>Success/Failure</td><td>ignore field</td></tr>
</tbody>
</table>
</div>
<p><strong>Comparison Example</strong>:</p>
<pre><code class="language-wpl"># Pipe-level not(): invert function result
(chars:status) | not(chars_has(ERROR))

# Group-level not(): fail when field exists
not(symbol(ERROR):error_marker)
</code></pre>
<h2 id="best-practices-6"><a class="header" href="#best-practices-6">Best Practices</a></h2>
<h3 id="1-prefer-dedicated-functions"><a class="header" href="#1-prefer-dedicated-functions">1. Prefer Dedicated Functions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Use chars_not_has
| chars_not_has(ERROR)

# ⚠️ Alternative: Use not() wrapper
| not(chars_has(ERROR))
</code></pre>
<h3 id="2-use-not-for-scenarios-without-dedicated-functions"><a class="header" href="#2-use-not-for-scenarios-without-dedicated-functions">2. Use not() for Scenarios Without Dedicated Functions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: No digit_not_in, use not()
| not(f_digit_in(port, [80, 443]))

# ✅ Recommended: No digit_not_range, use not()
| not(digit_range(200, 299))
</code></pre>
<h3 id="3-combine-multiple-conditions"><a class="header" href="#3-combine-multiple-conditions">3. Combine Multiple Conditions</a></h3>
<pre><code class="language-wpl"># ✅ Recommended: Clear logical combination
| f_has(status)              # Field must exist
| not(chars_in([ERROR, FATAL]))  # And not error status
</code></pre>
<h3 id="4-avoid-excessive-nesting"><a class="header" href="#4-avoid-excessive-nesting">4. Avoid Excessive Nesting</a></h3>
<pre><code class="language-wpl"># ❌ Not recommended: Double negation is confusing
| not(not(chars_has(OK)))

# ✅ Recommended: Use positive form directly
| chars_has(OK)
</code></pre>
<h2 id="troubleshooting-1"><a class="header" href="#troubleshooting-1">Troubleshooting</a></h2>
<h3 id="issue-not-doesnt-invert-result"><a class="header" href="#issue-not-doesnt-invert-result">Issue: not() Doesn’t Invert Result</a></h3>
<p><strong>Possible Cause</strong>: Confusing pipe-level and group-level <code>not()</code></p>
<pre><code class="language-wpl"># Check if used in correct position
(chars:status) | not(chars_has(ERROR))  # ✅ Correct
not(chars:status)                        # ❌ Wrong (group-level)
</code></pre>
<h3 id="issue-error-can-only-wrap-field-pipe-functions"><a class="header" href="#issue-error-can-only-wrap-field-pipe-functions">Issue: Error “can only wrap field pipe functions”</a></h3>
<p><strong>Solution</strong>: Ensure wrapping a field pipe function</p>
<pre><code class="language-wpl">| not(take(field))        # ❌ take is a selector
| not(f_has(field))       # ✅ f_has is a pipe function
</code></pre>
<h2 id="version-history-6"><a class="header" href="#version-history-6">Version History</a></h2>
<ul>
<li><strong>1.15.1</strong> (2026-02-07)
<ul>
<li>Added <code>not()</code> pipe-level wrapper function</li>
<li>Supports inverting any field pipe function result</li>
<li>Supports nesting and automatic field selection</li>
</ul>
</li>
</ul>
<h2 id="related-documentation-2"><a class="header" href="#related-documentation-2">Related Documentation</a></h2>
<ul>
<li><a href="#field-existence">Field Existence Check Functions</a></li>
<li><a href="#string-matching">String Matching Functions</a></li>
<li><a href="#wpl-group-logic">Group-Level not() Documentation</a></li>
<li><a href="#wpl-field-functions-index">Function Index</a></li>
</ul>
<hr>
<p><strong>Tip</strong>: <code>not()</code> is a powerful tool, but don’t overuse it. In most cases, using dedicated negation functions (like <code>chars_not_has</code>) is more intuitive and performs better.</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="wpl-group-logic"><a class="header" href="#wpl-group-logic">WPL Group Logic</a></h1>
<p>WPL provides multiple group wrappers to control the logical behavior of field parsing. Groups can contain one or more fields and determine parsing success or failure based on different logical semantics.</p>
<h2 id="group-types"><a class="header" href="#group-types">Group Types</a></h2>
<h3 id="seq---sequence-default"><a class="header" href="#seq---sequence-default">seq - Sequence (Default)</a></h3>
<p>The default group type requires all fields to be parsed successfully in order.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-wpl">(field1, field2, field3)
seq(field1, field2, field3)
</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Parses all fields in sequence</li>
<li>All fields must succeed</li>
<li>The entire group fails if any field fails</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-wpl">(digit:id, chars:name, ip:addr)
</code></pre>
<h3 id="opt---optional"><a class="header" href="#opt---optional">opt - Optional</a></h3>
<p>Marks a group as optional, so failure does not affect overall parsing.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-wpl">opt(field1, field2)
</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Attempts to parse all fields</li>
<li>Does not return an error on failure</li>
<li>Returns parsed results on success, skips on failure</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-wpl">opt(symbol([DEBUG]):level), chars:msg
</code></pre>
<h3 id="alt---alternative"><a class="header" href="#alt---alternative">alt - Alternative</a></h3>
<p>Tries multiple parsing options, succeeding if any one succeeds.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-wpl">alt(field1, field2, field3)
</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Tries each field in sequence</li>
<li>Uses the first successful field</li>
<li>The group fails if all fields fail</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-wpl">alt(ip:addr, chars:addr)  # Try to parse as IP, fall back to string
</code></pre>
<h3 id="some_of---partial-match"><a class="header" href="#some_of---partial-match">some_of - Partial Match</a></h3>
<p>Requires at least one field to succeed.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-wpl">some_of(field1, field2, field3)
</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Attempts to parse all fields</li>
<li>Succeeds if at least one field succeeds</li>
<li>The group fails if all fields fail</li>
</ul>
<p><strong>Example:</strong></p>
<pre><code class="language-wpl">some_of(digit:port, chars:service)
</code></pre>
<h3 id="not---negative-assertion"><a class="header" href="#not---negative-assertion">not - Negative Assertion</a></h3>
<p>Reverse logic: succeeds when the inner field fails to parse.</p>
<p><strong>Syntax:</strong></p>
<pre><code class="language-wpl">not(field)
</code></pre>
<p><strong>Behavior:</strong></p>
<ul>
<li>Attempts to parse the inner field</li>
<li><code>not()</code> succeeds when the inner field fails</li>
<li><code>not()</code> fails when the inner field succeeds</li>
<li>Returns an <code>ignore</code> type field on success</li>
</ul>
<p><strong>Input Consumption:</strong></p>
<ul>
<li><code>not(symbol(...))</code> - Consumes input (symbol may consume whitespace on failure)</li>
<li><code>not(peek_symbol(...))</code> - Does not consume input (peek_symbol never consumes)</li>
</ul>
<p><strong>Examples:</strong></p>
<pre><code class="language-wpl"># Ensure ERROR keyword is not present
not(symbol(ERROR):check)

# Use with peek_symbol to avoid consuming input
not(peek_symbol(ERROR):check), (chars:msg)
</code></pre>
<h2 id="use-cases-2"><a class="header" href="#use-cases-2">Use Cases</a></h2>
<h3 id="1-conditional-parsing"><a class="header" href="#1-conditional-parsing">1. Conditional Parsing</a></h3>
<pre><code class="language-wpl"># Parse optional debug information
opt(symbol([DEBUG]):level), chars:msg
</code></pre>
<h3 id="2-format-compatibility"><a class="header" href="#2-format-compatibility">2. Format Compatibility</a></h3>
<pre><code class="language-wpl"># Support multiple IP address formats
alt(ip:addr, chars:addr)
</code></pre>
<h3 id="3-negative-filtering"><a class="header" href="#3-negative-filtering">3. Negative Filtering</a></h3>
<pre><code class="language-wpl"># Process only non-error logs
not(symbol(ERROR)), (chars:msg)
</code></pre>
<h3 id="4-lenient-matching"><a class="header" href="#4-lenient-matching">4. Lenient Matching</a></h3>
<pre><code class="language-wpl"># Match at least port or service name
some_of(digit:port, chars:service)
</code></pre>
<h2 id="combining-groups"><a class="header" href="#combining-groups">Combining Groups</a></h2>
<p>Groups can be nested and combined to implement complex parsing logic:</p>
<pre><code class="language-wpl"># Optional IP or domain
opt(alt(ip:addr, chars:domain))

# Ensure not ERROR, then parse message
not(peek_symbol(ERROR)), (alt(json, kv, chars):msg)
</code></pre>
<h2 id="important-notes"><a class="header" href="#important-notes">Important Notes</a></h2>
<ol>
<li>
<p><strong>Groups cannot be nested inside other groups</strong></p>
<pre><code class="language-wpl"># ❌ Wrong: nesting not supported
(chars, (digit, chars))

# ✓ Correct: use multiple parallel groups
(chars), (digit, chars)
</code></pre>
</li>
<li>
<p><strong>not() can only contain a single field</strong></p>
<pre><code class="language-wpl"># ✓ Correct
not(symbol(ERROR):check)

# ❌ Wrong
not(symbol(ERROR), symbol(FATAL))
</code></pre>
</li>
<li>
<p><strong>Input consumption depends on the inner parser</strong></p>
<ul>
<li>Using non-consuming parsers like <code>peek_symbol</code> enables lookahead assertions</li>
<li>Using consuming parsers like <code>symbol</code>, <code>digit</code> will change the input position</li>
</ul>
</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-object-model-language-new-version"><a class="header" href="#oml-object-model-language-new-version">OML Object Model Language (New Version)</a></h1>
<blockquote>
<p><strong>Note</strong>: This is the new comprehensive OML documentation. English translation is in progress.</p>
<p>For now, please refer to the Chinese version at <code>docs/10-user/04-oml-new/</code></p>
</blockquote>
<p>OML (Object Model Language) is a declarative transformation language that converts parsed data from WPL into the desired output format.</p>
<h2 id="documentation-structure"><a class="header" href="#documentation-structure">Documentation Structure</a></h2>
<ul>
<li><strong>🌟 <a href="#oml-complete-feature-example">Complete Feature Example</a></strong> - Comprehensive example showcasing all OML features</li>
<li><strong><a href="#oml-quick-start">Quick Start</a></strong> - Get started with OML in 5 minutes</li>
<li><strong><a href="#oml-core-concepts">Core Concepts</a></strong> - Understand OML’s design philosophy</li>
<li><strong><a href="#oml-practical-guide">Practical Guide</a></strong> - Task-oriented solutions</li>
<li><strong><a href="#oml-functions-reference">Functions Reference</a></strong> - All function documentation</li>
<li><strong><a href="#oml-integration-guide">Integration Guide</a></strong> - Integrate OML into data pipelines</li>
<li><strong><a href="#oml-grammar-reference">Grammar Reference</a></strong> - Formal grammar definition</li>
</ul>
<h2 id="key-features"><a class="header" href="#key-features">Key Features</a></h2>
<ul>
<li><strong>Declarative</strong>: Describe “what you want” rather than “how to implement”</li>
<li><strong>Type System</strong>: 8 data types with automatic inference and conversion</li>
<li><strong>Powerful Functions</strong>: Built-in functions, pipeline functions, pattern matching</li>
<li><strong>Flexible Operations</strong>: Field extraction, data aggregation, conditional processing</li>
<li><strong>SQL Integration</strong>: Enrich data with database queries</li>
</ul>
<h2 id="quick-example"><a class="header" href="#quick-example">Quick Example</a></h2>
<p><strong>WPL Parsed Data:</strong></p>
<pre><code>client_ip: 192.168.1.100
status: 200
timestamp: 2024-01-15 14:30:00
</code></pre>
<p><strong>OML Configuration:</strong></p>
<pre><code class="language-oml">name : web_log_processor
rule : /nginx/access_log
---
# Extract fields
ip : ip = read(client_ip) ;
code : digit = read(status) ;

# Transform timestamp
ts_ms = read(timestamp) | Time::to_ts_zone(0, ms) ;

# Conditional processing
level = match read(code) {
    in (digit(200), digit(299)) =&gt; chars(success) ;
    in (digit(400), digit(499)) =&gt; chars(error) ;
    _ =&gt; chars(other) ;
} ;

# Create structured output
log : obj = object {
    client : ip = read(ip) ;
    status : digit = read(code) ;
    timestamp : digit = read(ts_ms) ;
    level : chars = read(level) ;
} ;
</code></pre>
<p><strong>Output:</strong></p>
<pre><code class="language-json">{
    "log": {
        "client": "192.168.1.100",
        "status": 200,
        "timestamp": 1705318200000,
        "level": "success"
    }
}
</code></pre>
<h2 id="translation-status"><a class="header" href="#translation-status">Translation Status</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Document</th><th>Status</th></tr>
</thead>
<tbody>
<tr><td>README.md</td><td>✅ Completed</td></tr>
<tr><td>01-quickstart.md</td><td>🔄 In Progress</td></tr>
<tr><td>02-core-concepts.md</td><td>🔄 In Progress</td></tr>
<tr><td>03-practical-guide.md</td><td>🔄 In Progress</td></tr>
<tr><td>04-functions-reference.md</td><td>🔄 In Progress</td></tr>
<tr><td>05-integration.md</td><td>🔄 In Progress</td></tr>
<tr><td>06-grammar-reference.md</td><td>🔄 In Progress</td></tr>
<tr><td>07-complete-example.md</td><td>🔄 In Progress</td></tr>
</tbody>
</table>
</div>
<h2 id="how-oml-works-with-wpl"><a class="header" href="#how-oml-works-with-wpl">How OML Works with WPL</a></h2>
<pre><code>1. WPL parses raw data
   ↓
2. Generates structured data + rule identifier (e.g., /nginx/access_log)
   ↓
3. System finds matching OML configuration (via rule field)
   ↓
4. Executes OML transformation
   ↓
5. Outputs to Sink
</code></pre>
<h2 id="related-documentation-3"><a class="header" href="#related-documentation-3">Related Documentation</a></h2>
<ul>
<li><a href="10-user/04-oml/README.html">Legacy OML Documentation</a> - Previous version</li>
<li><a href="10-user/03-wpl-new/README.html">WPL Rule Language</a> - Data parsing language</li>
<li><a href="10-user/05-connectors/02-sinks/README.html">Sinks Configuration</a> - Output configuration</li>
</ul>
<hr>
<p><strong>For the latest Chinese documentation, please visit:</strong> <code>docs/10-user/04-oml-new/</code></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-complete-feature-example"><a class="header" href="#oml-complete-feature-example">OML Complete Feature Example</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/07-complete-example.md</code></p>
</blockquote>
<hr>
<blockquote>
<p>A complete example demonstrating all OML core features</p>
</blockquote>
<p>This document provides a comprehensive OML example covering all core features, including basic operations, built-in functions, pipeline functions, advanced matching, and more. This is the best starting point for learning and referencing OML features.</p>
<h2 id="example-overview"><a class="header" href="#example-overview">Example Overview</a></h2>
<p>This example demonstrates the following feature modules:</p>
<ol>
<li><strong>Basic Operations</strong> (8 types) - Literal assignment, value extraction, default values, wildcards, etc.</li>
<li><strong>Built-in Functions</strong> - Time-related functions</li>
<li><strong>Pattern Matching</strong> (5 types) - Single source, dual source, range judgment, negation conditions, etc.</li>
<li><strong>Pipeline Functions</strong> (9 types) - Time conversion, encoding/decoding, data extraction, etc.</li>
<li><strong>String Operations</strong> - Formatting functions</li>
<li><strong>Objects &amp; Arrays</strong> - Aggregation and collection operations</li>
</ol>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-quick-start"><a class="header" href="#oml-quick-start">OML Quick Start</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/01-quickstart.md</code></p>
</blockquote>
<hr>
<p>Get started with OML in 5 minutes and transform your parsed data.</p>
<h2 id="what-is-oml"><a class="header" href="#what-is-oml">What is OML?</a></h2>
<p>OML (Object Model Language) is a <strong>declarative transformation language</strong> that converts parsed data from WPL into the desired output format.</p>
<h3 id="core-features-1"><a class="header" href="#core-features-1">Core Features</a></h3>
<ul>
<li><strong>Declarative</strong>: Describe “what you want” rather than “how to implement”</li>
<li><strong>Type System</strong>: 8 data types with automatic inference and conversion</li>
<li><strong>Powerful Functions</strong>: Built-in functions, pipeline functions, pattern matching</li>
<li><strong>Flexible Operations</strong>: Field extraction, data aggregation, conditional processing</li>
<li><strong>SQL Integration</strong>: Enrich data with database queries</li>
</ul>
<h3 id="how-oml-works-with-wpl-1"><a class="header" href="#how-oml-works-with-wpl-1">How OML Works with WPL</a></h3>
<pre><code>WPL (Parse) → Structured Data → OML (Transform) → Output
</code></pre>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-core-concepts"><a class="header" href="#oml-core-concepts">OML Core Concepts</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/02-core-concepts.md</code></p>
</blockquote>
<hr>
<p>This document introduces OML’s core design philosophy and fundamental concepts, helping you deeply understand how OML works.</p>
<h2 id="quick-navigation-2"><a class="header" href="#quick-navigation-2">Quick Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Topic</th><th>Content</th></tr>
</thead>
<tbody>
<tr><td><strong>Design Philosophy</strong></td><td>WPL collaboration, declarative syntax, immutable data flow</td></tr>
<tr><td><strong>Type System</strong></td><td>8 basic types, automatic inference, type conversion</td></tr>
<tr><td><strong>Read Semantics</strong></td><td>read vs take, destructive vs non-destructive, read priority</td></tr>
<tr><td><strong>Expression Types</strong></td><td>Value expressions, function calls, pipelines, conditionals, aggregation</td></tr>
<tr><td><strong>Default Value Mechanism</strong></td><td>Default value syntax, function defaults, limitations</td></tr>
<tr><td><strong>Wildcards</strong></td><td>Wildcard syntax, batch targets, usage restrictions</td></tr>
<tr><td><strong>Parameterized Reading</strong></td><td>option priority, keys collection, JSON paths</td></tr>
<tr><td><strong>Expression Composition</strong></td><td>Nested objects, pipeline chains, complex match</td></tr>
<tr><td><strong>Scope Rules</strong></td><td>Target field scope, global fields</td></tr>
<tr><td><strong>Best Practices</strong></td><td>Read mode selection, type declaration, default values, wildcard usage</td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-practical-guide"><a class="header" href="#oml-practical-guide">OML Practical Guide</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/03-practical-guide.md</code></p>
</blockquote>
<hr>
<p>Task-oriented practical guide to help you quickly find solutions.</p>
<h2 id="task-navigation-1"><a class="header" href="#task-navigation-1">Task Navigation</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Task Type</th><th>Jump To</th></tr>
</thead>
<tbody>
<tr><td>WPL &amp; OML Association</td><td>Understanding association mechanism, one-to-one/one-to-many</td></tr>
<tr><td>Data Extraction</td><td>Various field extraction methods</td></tr>
<tr><td>Data Transformation</td><td>Type conversion, time, URL, Base64, etc.</td></tr>
<tr><td>Data Aggregation</td><td>Creating objects, arrays</td></tr>
<tr><td>Conditional Processing</td><td>Status code classification, port identification, IP ranges, etc.</td></tr>
<tr><td>Data Enrichment (SQL Query)</td><td>SQL queries, multi-table joins</td></tr>
<tr><td>Complex Scenarios</td><td>Web logs, system monitoring complete processing</td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-functions-reference"><a class="header" href="#oml-functions-reference">OML Functions Reference</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/04-functions-reference.md</code></p>
</blockquote>
<hr>
<p>This document provides complete reference for all built-in functions and pipeline functions, using a standardized format for easy lookup.</p>
<h2 id="oml-all-functions-quick-reference"><a class="header" href="#oml-all-functions-quick-reference">OML All Functions Quick Reference</a></h2>
<h3 id="built-in-functions"><a class="header" href="#built-in-functions">Built-in Functions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Function</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><code>Now::time()</code></td><td>Get current time</td><td><code>event_time = Now::time() ;</code></td></tr>
<tr><td><code>Now::date()</code></td><td>Get current date (YYYYMMDD)</td><td><code>today = Now::date() ;</code></td></tr>
<tr><td><code>Now::hour()</code></td><td>Get current hour (YYYYMMDDHH)</td><td><code>current_hour = Now::hour() ;</code></td></tr>
</tbody>
</table>
</div>
<h3 id="pipeline-functions"><a class="header" href="#pipeline-functions">Pipeline Functions</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Category</th><th>Function</th><th>Description</th><th>Example</th></tr>
</thead>
<tbody>
<tr><td><strong>Encoding</strong></td><td><code>base64_encode</code></td><td>Base64 encode</td><td><code>read(data) | base64_encode</code></td></tr>
<tr><td></td><td><code>base64_decode</code></td><td>Base64 decode (supports Utf8/Gbk)</td><td><code>read(data) | base64_decode(Utf8)</code></td></tr>
<tr><td><strong>Escaping</strong></td><td><code>html_escape</code></td><td>HTML escape</td><td><code>read(text) | html_escape</code></td></tr>
<tr><td></td><td><code>json_escape</code></td><td>JSON escape</td><td><code>read(text) | json_escape</code></td></tr>
<tr><td><strong>Time</strong></td><td><code>Time::to_ts</code></td><td>Convert to timestamp (seconds, UTC+8)</td><td><code>read(time) | Time::to_ts</code></td></tr>
<tr><td></td><td><code>Time::to_ts_zone</code></td><td>Convert to specified timezone timestamp</td><td><code>read(time) | Time::to_ts_zone(0, ms)</code></td></tr>
<tr><td><strong>Data Access</strong></td><td><code>nth(index)</code></td><td>Get array element</td><td><code>read(arr) | nth(0)</code></td></tr>
<tr><td></td><td><code>get(key)</code></td><td>Get object field</td><td><code>read(obj) | get(name)</code></td></tr>
<tr><td></td><td><code>url(part)</code></td><td>Extract URL parts</td><td><code>read(url) | url(domain)</code></td></tr>
<tr><td><strong>Conversion</strong></td><td><code>to_str</code></td><td>Convert to string</td><td><code>read(ip) | to_str</code></td></tr>
<tr><td></td><td><code>to_json</code></td><td>Convert to JSON</td><td><code>read(arr) | to_json</code></td></tr>
<tr><td></td><td><code>ip4_to_int</code></td><td>IPv4 to integer</td><td><code>read(ip) | ip4_to_int</code></td></tr>
<tr><td><strong>Control</strong></td><td><code>skip_empty</code></td><td>Skip empty values</td><td><code>read(field) | skip_empty</code></td></tr>
</tbody>
</table>
</div>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-integration-guide"><a class="header" href="#oml-integration-guide">OML Integration Guide</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/05-integration.md</code></p>
</blockquote>
<hr>
<p>This document explains how to integrate OML into your data processing pipeline.</p>
<h2 id="integration-overview"><a class="header" href="#integration-overview">Integration Overview</a></h2>
<pre><code>Data Source → WPL (Parse) → OML (Transform) → Sink (Output)
</code></pre>
<h2 id="key-concepts"><a class="header" href="#key-concepts">Key Concepts</a></h2>
<ul>
<li><strong>Rule Matching</strong>: OML configurations match WPL rules via the <code>rule</code> field</li>
<li><strong>Sink Groups</strong>: Multiple OML configurations can process the same data</li>
<li><strong>Data Flow</strong>: Unidirectional data transformation pipeline</li>
<li><strong>SQL Integration</strong>: Enrich data with database queries</li>
</ul>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="oml-grammar-reference"><a class="header" href="#oml-grammar-reference">OML Grammar Reference</a></h1>
<blockquote>
<p><strong>Translation in Progress</strong></p>
<p>This document is currently being translated from Chinese to English.</p>
<p>Please refer to the Chinese version: <code>docs/10-user/04-oml-new/06-grammar-reference.md</code></p>
</blockquote>
<hr>
<p>This document provides the formal grammar definition of OML, suitable for:</p>
<ul>
<li>Compiler/parser developers</li>
<li>Precise understanding of syntax rules</li>
<li>Tool integration development</li>
</ul>
<p><strong>For regular users, please refer to:</strong></p>
<ul>
<li>Quick Start: <a href="#oml-quick-start">01-quickstart.md</a></li>
<li>Core Concepts: <a href="#oml-core-concepts">02-core-concepts.md</a></li>
<li>Practical Guide: <a href="#oml-practical-guide">03-practical-guide.md</a></li>
<li>Functions Reference: <a href="#oml-functions-reference">04-functions-reference.md</a></li>
</ul>
<hr>
<p><strong>For the complete English documentation, please check back later or refer to the Chinese version.</strong></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="readmemd"><a class="header" href="#readmemd">README.md</a></h1>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sources-configuration-guide"><a class="header" href="#sources-configuration-guide">Sources Configuration Guide</a></h1>
<p>This guide describes how to configure and use the various data sources in the Warp Parse system.</p>
<h2 id="content-overview"><a class="header" href="#content-overview">Content Overview</a></h2>
<ul>
<li><a href="#source-basics">Source Configuration Basics</a></li>
<li><a href="#file-source">File Source Configuration</a></li>
<li><a href="#kafka-source-configuration-1">Kafka Source Configuration</a></li>
<li><a href="#syslog-source-configuration-1">Syslog Source Configuration</a></li>
<li><a href="#tcp-source-configuration">TCP Source Configuration</a></li>
<li><a href="#source-meta">DataRecord Mechanism Data Fields</a></li>
</ul>
<h2 id="quick-start-8"><a class="header" href="#quick-start-8">Quick Start</a></h2>
<ol>
<li>Learn the <a href="#source-basics">Source Configuration Basics</a></li>
<li>Select the appropriate configuration guide based on your data source type</li>
<li>Refer to connector management documentation for connector definitions</li>
</ol>
<h2 id="supported-data-source-types"><a class="header" href="#supported-data-source-types">Supported Data Source Types</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>file</code></td><td>Read data from local files</td><td><a href="#file-source">File Source Configuration</a></td></tr>
<tr><td><code>kafka</code></td><td>Consume messages from Kafka</td><td><a href="#kafka-source-configuration-1">Kafka Source Configuration</a></td></tr>
<tr><td><code>syslog</code></td><td>Receive Syslog protocol data (UDP/TCP)</td><td><a href="#syslog-source-configuration-1">Syslog Source Configuration</a></td></tr>
<tr><td><code>tcp</code></td><td>Receive data via TCP</td><td><a href="#tcp-source-configuration">TCP Source Configuration</a></td></tr>
</tbody>
</table>
</div>
<h2 id="related-documentation-4"><a class="header" href="#related-documentation-4">Related Documentation</a></h2>
<ul>
<li><a href="10-user/05-connectors/README.html">Connector Management</a></li>
<li><a href="10-user/05-connectors/02-sinks/README.html">Sinks Configuration Guide</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="source-basics"><a class="header" href="#source-basics">Source Basics</a></h1>
<p>This document introduces the fundamental concepts and usage of data source configuration in the Warp Parse system.</p>
<h2 id="overview-7"><a class="header" href="#overview-7">Overview</a></h2>
<p>Sources are the data input endpoints of the Warp Parse system, responsible for receiving data from various sources and feeding it into the processing pipeline.</p>
<h2 id="core-concepts-1"><a class="header" href="#core-concepts-1">Core Concepts</a></h2>
<h3 id="1-connectors"><a class="header" href="#1-connectors">1. Connectors</a></h3>
<p>Connectors define how to establish connections and communicate with specific types of data sources. The system includes several built-in connector types:</p>
<ul>
<li><strong>File Connector</strong>: Read data from files</li>
<li><strong>Kafka Connector</strong>: Consume data from Kafka message queues</li>
<li><strong>Syslog Connector</strong>: Receive Syslog protocol data</li>
<li><strong>TCP Connector</strong>: Receive data through TCP sockets</li>
</ul>
<h3 id="2-connector-definitions"><a class="header" href="#2-connector-definitions">2. Connector Definitions</a></h3>
<p>Connector definitions are stored in the <code>connectors/source.d/</code> directory:</p>
<pre><code class="language-toml"># connectors/source.d/kafka_src.toml
[[connectors]]
id = "kafka_src"
type = "kafka"
allow_override = ["topic", "group_id", "config"]

[connectors.params]
brokers = "localhost:9092"
topic = ["access_log"]
group_id = "wparse_default_group"
</code></pre>
<h3 id="3-source-configuration-structure"><a class="header" href="#3-source-configuration-structure">3. Source Configuration Structure</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
key = "main_source"
enable = true
connect = "kafka_src"
tags = ["env:production"]

[[sources.params]]
topic = "events"
# Or use params_override (alias)
</code></pre>
<h2 id="configuration-steps"><a class="header" href="#configuration-steps">Configuration Steps</a></h2>
<ol>
<li><strong>Define Connector</strong>: Create connector configuration files in the <code>connectors/source.d/</code> directory</li>
<li><strong>Configure Source</strong>: Reference the connector in the source configuration file and specify parameters</li>
<li><strong>Validate Configuration</strong>: Use CLI tools to verify configuration correctness</li>
<li><strong>Start System</strong>: Start the Warp Parse system to begin receiving data</li>
</ol>
<h2 id="configuration-field-reference"><a class="header" href="#configuration-field-reference">Configuration Field Reference</a></h2>
<h3 id="common-fields"><a class="header" href="#common-fields">Common Fields</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>key</code></td><td>String</td><td>Yes</td><td>Unique identifier for the source</td></tr>
<tr><td><code>enable</code></td><td>Boolean</td><td>No</td><td>Whether to enable this source (default: true)</td></tr>
<tr><td><code>connect</code></td><td>String</td><td>Yes</td><td>Referenced connector ID</td></tr>
<tr><td><code>tags</code></td><td>Array</td><td>No</td><td>List of tags for the source</td></tr>
<tr><td><code>params</code></td><td>Table</td><td>No</td><td>Connector parameters (can override connector defaults)</td></tr>
</tbody>
</table>
</div>
<h3 id="parameter-override-rules"><a class="header" href="#parameter-override-rules">Parameter Override Rules</a></h3>
<ul>
<li>Only parameters listed in the connector’s <code>allow_override</code> can be overridden</li>
<li>Parameters not in the list use the default values from the connector definition</li>
</ul>
<h2 id="configuration-examples-3"><a class="header" href="#configuration-examples-3">Configuration Examples</a></h2>
<h3 id="basic-file-source"><a class="header" href="#basic-file-source">Basic File Source</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
key = "file_access_log"
enable = true
connect = "file_src"

[sources.params]
base = "/var/log/nginx"
file = "access.log"
</code></pre>
<h3 id="kafka-source-configuration"><a class="header" href="#kafka-source-configuration">Kafka Source Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
key = "kafka_access_logs"
enable = true
connect = "kafka_src"
tags = ["env:production", "type:access_log"]

[sources.params]
topic = "nginx_access_log"
</code></pre>
<h3 id="syslog-source-configuration"><a class="header" href="#syslog-source-configuration">Syslog Source Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
key = "syslog_tcp_1"
enable = true
connect = "syslog_tcp_src"
tags = ["protocol:tcp", "env:production"]

[sources.params]
addr = "127.0.0.1"
port = 1514
protocol = "tcp"
</code></pre>
<h2 id="related-documentation-5"><a class="header" href="#related-documentation-5">Related Documentation</a></h2>
<ul>
<li><a href="10-user/05-connectors/README.html">Connector Management</a></li>
<li><a href="#file-source">File Source Configuration</a></li>
<li><a href="#kafka-source-configuration-1">Kafka Source Configuration</a></li>
<li><a href="#syslog-source-configuration-1">Syslog Source Configuration</a></li>
<li><a href="#tcp-source-configuration">TCP Source Configuration</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-source"><a class="header" href="#file-source">File Source</a></h1>
<p>This document provides detailed instructions on configuring and using file data sources in the Warp Parse system.</p>
<h2 id="overview-8"><a class="header" href="#overview-8">Overview</a></h2>
<p>File sources are used to read data from the local file system, supporting multiple encoding formats and flexible path configuration.</p>
<h2 id="connector-definition"><a class="header" href="#connector-definition">Connector Definition</a></h2>
<h3 id="basic-file-connector"><a class="header" href="#basic-file-connector">Basic File Connector</a></h3>
<pre><code class="language-toml"># connectors/source.d/00-file-default.toml
[[connectors]]
id = "file_src"
type = "file"
allow_override = ["base", "file", "encode"]

[connectors.params]
base = "data/in_dat"
file = "gen.dat"
encode = "text"
</code></pre>
<h2 id="supported-parameters"><a class="header" href="#supported-parameters">Supported Parameters</a></h2>
<h3 id="path-configuration"><a class="header" href="#path-configuration">Path Configuration</a></h3>
<h4 id="base--file-combination-recommended"><a class="header" href="#base--file-combination-recommended">base + file Combination (Recommended)</a></h4>
<pre><code class="language-toml">[[sources]]
key = "file_composed"
connect = "file_src"

[[sources.params]]
base = "/var/log"
file = "access.log"
</code></pre>
<h4 id="instances-multi-instance-parallel-reading"><a class="header" href="#instances-multi-instance-parallel-reading">instances (Multi-instance Parallel Reading)</a></h4>
<pre><code class="language-toml">[[sources.params]]
instances = 4   # 1-32, default is 1
</code></pre>
<blockquote>
<p>When <code>instances &gt; 1</code>, the file is split into multiple ranges at line boundaries, read in parallel by multiple instances.</p>
<p><strong>Multi-instance Naming Convention</strong>: When <code>instances &gt; 1</code>, each instance’s key automatically gets a suffix, such as <code>file_src-1</code>, <code>file_src-2</code>, etc.</p>
</blockquote>
<h3 id="encoding-formats"><a class="header" href="#encoding-formats">Encoding Formats</a></h3>
<h4 id="text-encoding-default"><a class="header" href="#text-encoding-default">text Encoding (Default)</a></h4>
<pre><code class="language-toml">[[sources.params]]
encode = "text"
</code></pre>
<h2 id="configuration-examples-4"><a class="header" href="#configuration-examples-4">Configuration Examples</a></h2>
<h3 id="basic-file-reading"><a class="header" href="#basic-file-reading">Basic File Reading</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "access_log"
connect = "file_src"

[[sources.params]]
base = "/var/log/nginx"
file = "access.log"
</code></pre>
<h3 id="multiple-file-sources-configuration"><a class="header" href="#multiple-file-sources-configuration">Multiple File Sources Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "nginx_access"
connect = "file_src"

[[sources.params]]
base = "/var/log/nginx"
file = "access.log"

[[sources]]
enable = true
key = "nginx_error"
connect = "file_src"

[[sources.params]]
base = "/var/log/nginx"
file = "error.log"
</code></pre>
<h3 id="different-encoding-formats"><a class="header" href="#different-encoding-formats">Different Encoding Formats</a></h3>
<pre><code class="language-toml"># Base64 encoded file
[[sources]]
key = "base64_data"
connect = "file_src"

[[sources.params]]
base = "./data"
file = "encoded.b64"
encode = "base64"

# Hexadecimal encoded file
[[sources]]
key = "hex_data"
connect = "file_src"

[[sources.params]]
base = "./data"
file = "encoded.hex"
encode = "hex"
</code></pre>
<h2 id="data-processing-features"><a class="header" href="#data-processing-features">Data Processing Features</a></h2>
<h3 id="1-line-by-line-reading"><a class="header" href="#1-line-by-line-reading">1. Line-by-Line Reading</a></h3>
<p>File sources use line-by-line reading mode, where each line is processed as an independent data packet.</p>
<h3 id="2-encoding-processing"><a class="header" href="#2-encoding-processing">2. Encoding Processing</a></h3>
<ul>
<li><strong>text</strong>: Read text content directly</li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  "data": "Original log content",
  "tags": {
    "access_source": "/var/log/nginx/access.log",
    "env": "production"
  }
}
</code></pre>
<h2 id="related-documentation-6"><a class="header" href="#related-documentation-6">Related Documentation</a></h2>
<ul>
<li><a href="#source-basics">Source Configuration Basics</a></li>
<li><a href="10-user/05-connectors/README.html">Connector Management</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="kafka-source-configuration-1"><a class="header" href="#kafka-source-configuration-1">Kafka Source Configuration</a></h1>
<blockquote>
<p><strong>⚠️ Note</strong>: Kafka source is currently <strong>not implemented</strong>. This document is a design document for planned functionality; please refer to the actual code implementation when using.</p>
</blockquote>
<p>This document describes in detail how to configure and use the Kafka data source in the Warp Parse system.</p>
<h2 id="overview-9"><a class="header" href="#overview-9">Overview</a></h2>
<p>Kafka source is used to consume data from Apache Kafka message queues, supporting consumption from a single topic with flexible configuration options.</p>
<blockquote>
<p><strong>Note</strong>: The system will automatically create configured topics (if they don’t exist). The consumer group ID can be configured via the <code>group_id</code> parameter, defaulting to <code>wparse_default_group</code>.</p>
</blockquote>
<h2 id="connector-definition-1"><a class="header" href="#connector-definition-1">Connector Definition</a></h2>
<h3 id="basic-kafka-connector"><a class="header" href="#basic-kafka-connector">Basic Kafka Connector</a></h3>
<pre><code class="language-toml"># connectors/source.d/30-kafka.toml
[[connectors]]
id = "kafka_src"
type = "kafka"
allow_override = ["topic", "group_id", "config"]

[connectors.params]
brokers = "localhost:9092"
topic = ["access_log"]
group_id = "wparse_default_group"
</code></pre>
<h2 id="supported-parameters-1"><a class="header" href="#supported-parameters-1">Supported Parameters</a></h2>
<h3 id="basic-connection-parameters"><a class="header" href="#basic-connection-parameters">Basic Connection Parameters</a></h3>
<h4 id="brokers-required"><a class="header" href="#brokers-required">brokers (required)</a></h4>
<p>Kafka cluster address, supports string format</p>
<pre><code class="language-toml">[[sources.params]]
brokers = "localhost:9092"
</code></pre>
<h4 id="topic-required"><a class="header" href="#topic-required">topic (required)</a></h4>
<p>Topic name to consume (array format)</p>
<pre><code class="language-toml">[[sources.params]]
topic = ["access_log"]
</code></pre>
<h4 id="group_id-optional"><a class="header" href="#group_id-optional">group_id (optional)</a></h4>
<p>Consumer group ID</p>
<pre><code class="language-toml">[[sources.params]]
group_id = "my_consumer_group"
</code></pre>
<h3 id="security-configuration"><a class="header" href="#security-configuration">Security Configuration</a></h3>
<p>All security-related parameters must be configured via the <code>config</code> array in <code>key=value</code> string format.</p>
<h4 id="ssltls-configuration"><a class="header" href="#ssltls-configuration">SSL/TLS Configuration</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "security_protocol=SSL",
    "ssl_ca_location=/path/to/ca.pem",
    "ssl_certificate_location=/path/to/client.pem",
    "ssl_key_location=/path/to/client.key",
    "ssl_key_password=key_password"
]
</code></pre>
<h4 id="sasl-authentication"><a class="header" href="#sasl-authentication">SASL Authentication</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "security_protocol=SASL_PLAINTEXT",
    "sasl_mechanisms=PLAIN",
    "sasl_username=consumer_user",
    "sasl_password=consumer_pass"
]
</code></pre>
<h4 id="saslscram-authentication"><a class="header" href="#saslscram-authentication">SASL/SCRAM Authentication</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "security_protocol=SASL_SSL",
    "sasl_mechanisms=SCRAM-SHA-256",
    "sasl_username=consumer_user",
    "sasl_password=consumer_pass"
]
</code></pre>
<h3 id="advanced-configuration"><a class="header" href="#advanced-configuration">Advanced Configuration</a></h3>
<h4 id="consumption-strategy"><a class="header" href="#consumption-strategy">Consumption Strategy</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "auto_offset_reset=earliest",
    "enable_auto_commit=false",
    "auto_commit_interval_ms=5000"
]
</code></pre>
<h4 id="session-and-heartbeat-configuration"><a class="header" href="#session-and-heartbeat-configuration">Session and Heartbeat Configuration</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "session_timeout_ms=30000",
    "heartbeat_interval_ms=3000",
    "max_poll_interval_ms=300000"
]
</code></pre>
<h4 id="batch-consumption-configuration"><a class="header" href="#batch-consumption-configuration">Batch Consumption Configuration</a></h4>
<pre><code class="language-toml">[[sources.params]]
config = [
    "max_poll_records=500",
    "fetch_min_bytes=1",
    "fetch_max_wait_ms=500"
]
</code></pre>
<h2 id="configuration-examples-5"><a class="header" href="#configuration-examples-5">Configuration Examples</a></h2>
<h3 id="basic-configuration-1"><a class="header" href="#basic-configuration-1">Basic Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "kafka_access_logs"
connect = "kafka_src"

[[sources.params]]
topic = ["nginx_access_log"]
</code></pre>
<h3 id="advanced-configuration-1"><a class="header" href="#advanced-configuration-1">Advanced Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "kafka_advanced"
connect = "kafka_src"

[[sources.params]]
topic = ["access_log"]
config = [
    "auto_offset_reset=earliest",
    "enable_auto_commit=false"
]
</code></pre>
<h3 id="secure-cluster-configuration"><a class="header" href="#secure-cluster-configuration">Secure Cluster Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "kafka_secure_logs"
connect = "kafka_src"
tags = ["env:production", "security:tls"]

[[sources.params]]
topic = ["secure_events"]
config = [
    "auto_offset_reset=latest",
    "enable_auto_commit=true",
    "auto_commit_interval_ms=1000"
]
</code></pre>
<h2 id="data-processing-features-1"><a class="header" href="#data-processing-features-1">Data Processing Features</a></h2>
<h3 id="1-message-structure"><a class="header" href="#1-message-structure">1. Message Structure</a></h3>
<p>Each Kafka message is converted to a data packet containing:</p>
<ul>
<li><strong>Message body</strong>: The actual content of the message (payload)</li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  "data": "Original message content",
  "tags": {
    "access_source": "access_log",
    "env": "production",
    "type": "access_log"
  }
}
</code></pre>
<h3 id="3-consumption-semantics"><a class="header" href="#3-consumption-semantics">3. Consumption Semantics</a></h3>
<ul>
<li><strong>Consumer group ID</strong>: Configured via <code>group_id</code> parameter</li>
<li><strong>Topic auto-creation</strong>: Topics are automatically created when they don’t exist (1 partition, replication factor 1)</li>
<li><strong>Offset commit</strong>: Handled by underlying rdkafka library, configurable via config parameters</li>
</ul>
<h2 id="performance-optimization"><a class="header" href="#performance-optimization">Performance Optimization</a></h2>
<h3 id="1-batch-consumption"><a class="header" href="#1-batch-consumption">1. Batch Consumption</a></h3>
<pre><code class="language-toml">[[sources.params]]
config = [
    "max_poll_records=1000",
    "fetch_min_bytes=1024",
    "fetch_max_wait_ms=100"
]
</code></pre>
<h3 id="2-connection-optimization"><a class="header" href="#2-connection-optimization">2. Connection Optimization</a></h3>
<pre><code class="language-toml">[[sources.params]]
config = [
    "session_timeout_ms=60000",
    "heartbeat_interval_ms=5000",
    "max_poll_interval_ms=600000"
]
</code></pre>
<h2 id="related-documentation-7"><a class="header" href="#related-documentation-7">Related Documentation</a></h2>
<ul>
<li><a href="#source-basics">Source Configuration Basics</a></li>
<li><a href="10-user/05-connectors/README.html">Connector Management</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="syslog-source-configuration-1"><a class="header" href="#syslog-source-configuration-1">Syslog Source Configuration</a></h1>
<p>This document describes in detail how to configure and use the Syslog data source in the Warp Parse system.</p>
<h2 id="overview-10"><a class="header" href="#overview-10">Overview</a></h2>
<p>Syslog source is used to receive and parse standard Syslog protocol messages, supporting both UDP and TCP transport protocols, as well as multiple Syslog formats.</p>
<h2 id="connector-definition-2"><a class="header" href="#connector-definition-2">Connector Definition</a></h2>
<h3 id="udp-syslog-connector"><a class="header" href="#udp-syslog-connector">UDP Syslog Connector</a></h3>
<pre><code class="language-toml"># connectors/source.d/10-syslog-udp.toml
[[connectors]]
id = "syslog_udp_src"
type = "syslog"
allow_override = ["addr", "port", "protocol", "tcp_recv_bytes", "header_mode", "fast_strip"]

[connectors.params]
addr = "0.0.0.0"
port = 1514
protocol = "udp"
header_mode = "strip"
tcp_recv_bytes = 256000
</code></pre>
<h3 id="tcp-syslog-connector"><a class="header" href="#tcp-syslog-connector">TCP Syslog Connector</a></h3>
<pre><code class="language-toml"># connectors/source.d/11-syslog-tcp.toml
[[connectors]]
id = "syslog_tcp_src"
type = "syslog"
allow_override = ["addr", "port", "protocol", "tcp_recv_bytes", "header_mode", "fast_strip"]

[connectors.params]
addr = "127.0.0.1"
port = 1514
protocol = "tcp"
header_mode = "strip"
tcp_recv_bytes = 256000
</code></pre>
<h2 id="supported-parameters-2"><a class="header" href="#supported-parameters-2">Supported Parameters</a></h2>
<h3 id="basic-network-parameters"><a class="header" href="#basic-network-parameters">Basic Network Parameters</a></h3>
<h4 id="addr-required"><a class="header" href="#addr-required">addr (required)</a></h4>
<p>Listen address</p>
<pre><code class="language-toml">[[sources.params]]
addr = "0.0.0.0"    # Listen on all interfaces
addr = "127.0.0.1"   # Local interface only
addr = "10.0.0.100"  # Specific interface
</code></pre>
<h4 id="port-required"><a class="header" href="#port-required">port (required)</a></h4>
<p>Listen port</p>
<pre><code class="language-toml">[[sources.params]]
port = 514           # Standard syslog port (requires root privileges)
</code></pre>
<h4 id="protocol-required"><a class="header" href="#protocol-required">protocol (required)</a></h4>
<p>Transport protocol</p>
<pre><code class="language-toml">[[sources.params]]
protocol = "tcp"     # TCP protocol (reliable transport)
</code></pre>
<h3 id="message-processing-parameters"><a class="header" href="#message-processing-parameters">Message Processing Parameters</a></h3>
<h4 id="header_mode"><a class="header" href="#header_mode">header_mode</a></h4>
<p>Header processing mode</p>
<pre><code class="language-toml">[[sources.params]]
header_mode = "strip"   # Strip header only, don't inject tags
header_mode = "parse"   # Parse + inject tags + strip header (default)
header_mode = "keep"    # Keep header, pass through as-is
</code></pre>
<h4 id="fast_strip"><a class="header" href="#fast_strip">fast_strip</a></h4>
<p>Fast strip mode (performance optimization)</p>
<pre><code class="language-toml">[[sources.params]]
fast_strip = true   # Enable fast stripping (better performance)
</code></pre>
<h3 id="tcp-specific-parameters"><a class="header" href="#tcp-specific-parameters">TCP-Specific Parameters</a></h3>
<h4 id="tcp_recv_bytes"><a class="header" href="#tcp_recv_bytes">tcp_recv_bytes</a></h4>
<p>TCP receive buffer size</p>
<pre><code class="language-toml">[[sources.params]]
tcp_recv_bytes = 256000      # 256KB (default)
tcp_recv_bytes = 10485760    # 10MB
tcp_recv_bytes = 104857600   # 100MB (high performance)
</code></pre>
<h2 id="configuration-examples-6"><a class="header" href="#configuration-examples-6">Configuration Examples</a></h2>
<h3 id="basic-udp-configuration"><a class="header" href="#basic-udp-configuration">Basic UDP Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "syslog_udp_1"
connect = "syslog_udp_src"
tags = ["protocol:udp", "env:production"]

[[sources.params]]
addr = "0.0.0.0"
port = 1514
protocol = "udp"
</code></pre>
<h3 id="basic-tcp-configuration"><a class="header" href="#basic-tcp-configuration">Basic TCP Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "syslog_tcp_1"
connect = "syslog_tcp_src"
tags = ["protocol:tcp", "env:production"]

[[sources.params]]
addr = "127.0.0.1"
port = 1514
protocol = "tcp"
</code></pre>
<h3 id="dual-protocol-configuration"><a class="header" href="#dual-protocol-configuration">Dual Protocol Configuration</a></h3>
<pre><code class="language-toml"># wpsrc.toml
[[sources]]
enable = true
key = "syslog_udp_collector"
connect = "syslog_udp_src"

[[sources.params]]
addr = "0.0.0.0"
port = 1514
protocol = "udp"
header_mode = "strip"

[[sources]]
enable = true
key = "syslog_tcp_aggregator"
connect = "syslog_tcp_src"

[[sources.params]]
addr = "127.0.0.1"
port = 1515
protocol = "tcp"
header_mode = "parse"
tcp_recv_bytes = 1048576
</code></pre>
<h2 id="data-processing-features-2"><a class="header" href="#data-processing-features-2">Data Processing Features</a></h2>
<h3 id="1-syslog-format-support"><a class="header" href="#1-syslog-format-support">1. Syslog Format Support</a></h3>
<h4 id="rfc3164-format-traditional-bsd-syslog"><a class="header" href="#rfc3164-format-traditional-bsd-syslog">RFC3164 Format (Traditional BSD Syslog)</a></h4>
<pre><code>&lt;34&gt;Oct 11 22:14:15 mymachine su: 'su root' failed for lonvick on /dev/pts/8
</code></pre>
<h4 id="rfc5424-format-modern-syslog"><a class="header" href="#rfc5424-format-modern-syslog">RFC5424 Format (Modern Syslog)</a></h4>
<pre><code>&lt;165&gt;1 2003-10-11T22:14:15.003Z mymachine.example.com evntslog - ID47 [exampleSDID@32473 iut="3" eventSource="Application" eventID="1011"] BOMAn application event log entry
</code></pre>
<h3 id="2-parsed-fields"><a class="header" href="#2-parsed-fields">2. Parsed Fields</a></h3>
<p>When <code>header_mode = "parse"</code>, the system parses and adds the following tags:</p>
<pre><code class="language-json">{
  "data": "Original message content",
  "tags": {
    "source_type": "syslog",
    "syslog_priority": 34,        // Numeric priority
    "syslog_facility": 4,         // Facility code
    "syslog_severity": 2,         // Severity level
    "syslog_hostname": "mymachine",
    "syslog_app_name": "su",
    "syslog_proc_id": "1234",     // Process ID (RFC5424)
    "syslog_msg_id": "ID47",      // Message ID (RFC5424)
    "syslog_timestamp": "Oct 11 22:14:15"
  }
}
</code></pre>
<h3 id="3-framingheader-processing-optimization"><a class="header" href="#3-framingheader-processing-optimization">3. Framing/Header Processing Optimization</a></h3>
<pre><code class="language-toml"># High performance scenarios:
header_mode = "strip"         # Strip header only, reduce parsing and tag injection
fast_strip = true             # Enable fast stripping

# Analysis scenarios:
header_mode = "parse"         # Parse and inject protocol-related metadata
</code></pre>
<h2 id="related-documentation-8"><a class="header" href="#related-documentation-8">Related Documentation</a></h2>
<ul>
<li><a href="#source-basics">Source Configuration Basics</a></li>
<li><a href="10-user/05-connectors/README.html">Connector Management</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tcp-source-configuration"><a class="header" href="#tcp-source-configuration">TCP Source Configuration</a></h1>
<p>This document describes how to use the generic TCP source (kind=<code>tcp</code>), framing modes, and examples of integration with TCP Sink.</p>
<h2 id="feature-overview"><a class="header" href="#feature-overview">Feature Overview</a></h2>
<ul>
<li>Supports three framing modes:
<ul>
<li><code>line</code>: Frame by newline; trailing CR/space/Tab are stripped</li>
<li><code>len</code>: Length prefix (RFC 6587 octet-counting): <code>&lt;len&gt;&lt;SP&gt;&lt;payload&gt;</code></li>
<li><code>auto</code> (default): Auto-select; defaults to <code>len</code> priority, uses line priority when <code>prefer_newline=true</code></li>
</ul>
</li>
</ul>
<h2 id="connector-definition-sourced"><a class="header" href="#connector-definition-sourced">Connector Definition (source.d)</a></h2>
<pre><code class="language-toml"># connectors/source.d/12-tcp.toml
[[connectors]]
id = "tcp_src"
type = "tcp"
# Keys allowed to override, compatible with common syslog naming
allow_override = ["addr", "port", "framing", "tcp_recv_bytes", "instances"]

[connectors.params]
addr = "0.0.0.0"
port = 9000
framing = "auto"          # auto|line|len
tcp_recv_bytes = 256000   # 256KB
# instances = 1             # Optional: parallel instances, default 1, max 16
</code></pre>
<h2 id="source-configuration-wpsrctoml"><a class="header" href="#source-configuration-wpsrctoml">Source Configuration (wpsrc.toml)</a></h2>
<pre><code class="language-toml">[[sources]]
key = "tcp_in"
connect = "tcp_src"
enable = true
tags = ["source:tcp", "type:raw"]

[[sources.params]]
port = 19000
framing = "auto"
instances = 2
</code></pre>
<h2 id="framing-mode-details"><a class="header" href="#framing-mode-details">Framing Mode Details</a></h2>
<h3 id="line-newline"><a class="header" href="#line-newline">line (newline)</a></h3>
<ul>
<li>Use case: Text logs, manual/script pushing, simple tool (nc/tail) pipelines</li>
<li>Trailing <code>\r</code>/space/Tab are stripped; senders should end each line with <code>\n</code></li>
</ul>
<h3 id="len-length-prefix"><a class="header" href="#len-length-prefix">len (length prefix)</a></h3>
<ul>
<li>Format: <code>5 hello</code> → indicates next payload length is 5 bytes (not including the space in the prefix)</li>
<li>Use case: Scenarios where payload may contain newlines/binary (e.g., multi-line logs, stack traces, compressed fragments)</li>
<li>Receiver constraints: Maximum length 10MB, prefix max 10 decimal digits, discards current attempt on error to avoid memory bloat</li>
</ul>
<h3 id="auto-automatic"><a class="header" href="#auto-automatic">auto (automatic)</a></h3>
<ul>
<li>Default tries <code>len</code> first, falls back to line on parse failure</li>
<li>If “length prefix in progress” is detected (read <code>&lt;digits&gt;&lt;SP&gt;</code> but payload incomplete), continues waiting instead of falling back to line to avoid mis-splitting</li>
</ul>
<h2 id="integration-with-tcp-sink-loopback-pipeline"><a class="header" href="#integration-with-tcp-sink-loopback-pipeline">Integration with TCP Sink (Loopback Pipeline)</a></h2>
<p>For end-to-end debugging convenience, this project provides a generic TCP Sink (kind=<code>tcp</code>):</p>
<ul>
<li>sink connectors: <code>connectors/sink.d/12-tcp.toml</code></li>
<li>sink parameters: <code>addr</code>/<code>port</code>/<code>framing(line|len)</code></li>
<li>Example: <code>wpgen</code> outputs to <code>tcp_sink</code>, <code>wparse</code> listens on same port via <code>tcp_src</code>, achieving local loopback</li>
</ul>
<h3 id="example-wpgen-confwpgentoml"><a class="header" href="#example-wpgen-confwpgentoml">Example wpgen (conf/wpgen.toml)</a></h3>
<pre><code class="language-toml">[generator]
mode = "sample"
count = 10000

[output]
connect = "tcp_sink"

[output.params]
addr = "127.0.0.1"
port = 19000
framing = "line"  # or "len"
</code></pre>
<h2 id="complete-use-case-usecasecoretcp_roundtrip"><a class="header" href="#complete-use-case-usecasecoretcp_roundtrip">Complete Use Case (usecase/core/tcp_roundtrip)</a></h2>
<p>Directory: <code>usecase/core/tcp_roundtrip</code></p>
<ul>
<li>Start: <code>./case_verify.sh</code></li>
<li>Steps: Start wparse (tcp source) → wpgen push (tcp sink) → verify file output</li>
</ul>
<h2 id="faq-2"><a class="header" href="#faq-2">FAQ</a></h2>
<ul>
<li>Q: Will text starting with “number+space” be misidentified as length prefix?
<ul>
<li>A: In <code>auto</code> mode, this is possible; use <code>framing="line"</code> to avoid</li>
</ul>
</li>
<li>Q: Why is <code>len</code> recommended for production?
<ul>
<li>A: Clear boundaries, more robust for binary/multi-line; many syslog/TCP production pipelines recommend/default to octet-counting</li>
</ul>
</li>
</ul>
<h2 id="best-practices-7"><a class="header" href="#best-practices-7">Best Practices</a></h2>
<ul>
<li>Text only: <code>framing="line"</code></li>
<li>Multi-line/binary: <code>framing="len"</code> (or <code>auto</code> default)</li>
<li>Quick debugging: <code>framing="line"</code>, paired with <code>nc -lk &lt;port&gt;</code></li>
</ul>
<h2 id="related-documentation-9"><a class="header" href="#related-documentation-9">Related Documentation</a></h2>
<ul>
<li><a href="#source-basics">Source Configuration Basics</a></li>
<li><a href="#tcp-sink">TCP Sink Configuration</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="source-meta"><a class="header" href="#source-meta">Source Meta</a></h1>
<h2 id="overview-11"><a class="header" href="#overview-11">Overview</a></h2>
<p>When parsing data, the Warp Parse system automatically appends mechanism data fields to the DataRecord for tracking data origin and processing paths. These mechanism data fields are identified with the <code>wp_</code> prefix, providing data traceability and debugging capabilities for the system.</p>
<h2 id="mechanism-data-field-list"><a class="header" href="#mechanism-data-field-list">Mechanism Data Field List</a></h2>
<h3 id="1-wp_event_id"><a class="header" href="#1-wp_event_id">1. wp_event_id</a></h3>
<ul>
<li><strong>Field Type</strong>: String</li>
<li><strong>Description</strong>: Unique identifier for the event</li>
<li><strong>Source</strong>: Obtained from SourceEvent.event_id</li>
<li><strong>Purpose</strong>: Track the complete processing flow of a single event through the system</li>
</ul>
<h3 id="2-wp_src_key"><a class="header" href="#2-wp_src_key">2. wp_src_key</a></h3>
<ul>
<li><strong>Field Type</strong>: String</li>
<li><strong>Description</strong>: Data source identifier</li>
<li><strong>Source</strong>: Obtained from SourceEvent.src_key</li>
<li><strong>Purpose</strong>: Identify which data source the data originates from (e.g., “syslog_1”, “file_reader”, etc.)</li>
</ul>
<h3 id="3-wp_src_ip"><a class="header" href="#3-wp_src_ip">3. wp_src_ip</a></h3>
<ul>
<li><strong>Field Type</strong>: IP Address (IP)</li>
<li><strong>Description</strong>: Client IP address of the data source</li>
<li><strong>Source</strong>: Obtained from SourceEvent.ups_ip</li>
<li><strong>Purpose</strong>: Record the client IP address that sent the data, used for auditing and troubleshooting</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sinks-configuration-guide"><a class="header" href="#sinks-configuration-guide">Sinks Configuration Guide</a></h1>
<p>This guide introduces how to configure and use various data outputs (Sinks) in the Warp Parse system.</p>
<h2 id="supported-sink-types"><a class="header" href="#supported-sink-types">Supported Sink Types</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Type</th><th>Description</th><th>Documentation</th></tr>
</thead>
<tbody>
<tr><td><code>blackhole</code></td><td>Blackhole output (for testing)</td><td>-</td></tr>
<tr><td><code>file</code></td><td>Output to local file</td><td><a href="#file-sink">File Sink Configuration</a></td></tr>
<tr><td><code>syslog</code></td><td>Output to Syslog server (UDP/TCP)</td><td><a href="#syslog-sink">Syslog Sink Configuration</a></td></tr>
<tr><td><code>tcp</code></td><td>Output to TCP server</td><td><a href="#tcp-sink">TCP Sink Configuration</a></td></tr>
<tr><td><code>kafka</code></td><td>Output to Kafka</td><td>-</td></tr>
<tr><td><code>prometheus</code></td><td>Prometheus metrics exposure</td><td><a href="#prometheus-sink">Prometheus Sink Configuration</a></td></tr>
<tr><td><code>victorialogs</code></td><td>Output to VictoriaLogs</td><td><a href="#victorialogs">VictoriaLogs Sink Configuration</a></td></tr>
</tbody>
</table>
</div>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sink-basics"><a class="header" href="#sink-basics">Sink Basics</a></h1>
<p>This document introduces the fundamental concepts and configuration structure of data output endpoints (Sinks) in the warpparse system.</p>
<h2 id="overview-12"><a class="header" href="#overview-12">Overview</a></h2>
<p>Sinks are the data output endpoints of the warpparse system, responsible for sending processed data to various target systems. The system supports multiple output types, including file, Syslog, Prometheus, and more.</p>
<h2 id="core-concepts-2"><a class="header" href="#core-concepts-2">Core Concepts</a></h2>
<h3 id="1-configuration-hierarchy"><a class="header" href="#1-configuration-hierarchy">1. Configuration Hierarchy</a></h3>
<p>The warpparse system adopts a layered configuration architecture:</p>
<pre><code>Global Default Configuration (defaults.toml)
    ↓
Route Group Configuration (business.d/**/*.toml, infra.d/**/*.toml)
    ↓
Connector Definitions (connectors/sink.d/*.toml)
    ↓
Resolved Sink Instance (ResolvedSinkSpec)
</code></pre>
<h3 id="2-core-data-structures"><a class="header" href="#2-core-data-structures">2. Core Data Structures</a></h3>
<h2 id="configuration-file-structure"><a class="header" href="#configuration-file-structure">Configuration File Structure</a></h2>
<h3 id="1-connector-definition-connectorstoml"><a class="header" href="#1-connector-definition-connectorstoml">1. Connector Definition (connectors.toml)</a></h3>
<pre><code class="language-toml"># connectors/sink.d/file_raw_sink.toml
[[connectors]]
id = "file_raw_sink"
type = "file"
allow_override = ["base", "file", "fmt"]

[connectors.params]
base = "./data/out_dat"
file = "default.dat"
fmt = "json"
</code></pre>
<p><strong>Key Field Descriptions</strong>:</p>
<ul>
<li><code>id</code>: Unique identifier for the connector</li>
<li><code>type</code>: Connector type (file, syslog, prometheus, etc.)</li>
<li><code>allow_override</code>: List of parameters that can be overridden by source configuration</li>
<li><code>params</code>: Connector default parameters</li>
</ul>
<h3 id="2-route-configuration-businessdtoml-infradtoml"><a class="header" href="#2-route-configuration-businessdtoml-infradtoml">2. Route Configuration (business.d/<strong>/*.toml, infra.d/</strong>/*.toml)</a></h3>
<pre><code class="language-toml"># business.d/example.toml
version = "2.0"

[sink_group]
name = "/sink/example"
oml = ["example_pattern"]
parallel = 2
tags = ["env:production"]

[[sink_group.sinks]]
name = "example_sink"
connect = "file_raw_sink"
params = {
    base = "./output",
    file = "example.dat"
}
filter = "./filter.wpl"
tags = ["type:example"]

[sink_group.sinks.expect]
ratio = 1.0
tol = 0.01
</code></pre>
<h3 id="3-global-default-configuration-defaultstoml"><a class="header" href="#3-global-default-configuration-defaultstoml">3. Global Default Configuration (defaults.toml)</a></h3>
<pre><code class="language-toml"># defaults.toml
version = "2.0"

[defaults]
tags = ["env:default"]

[defaults.expect]
basis = "total_input"
min_samples = 100
mode = "error"
</code></pre>
<h2 id="basic-configuration-examples"><a class="header" href="#basic-configuration-examples">Basic Configuration Examples</a></h2>
<h3 id="1-simple-file-output"><a class="header" href="#1-simple-file-output">1. Simple File Output</a></h3>
<pre><code class="language-toml"># infra.d/simple_file.toml
version = "2.0"

[sink_group]
name = "simple_output"
oml = []
[[sink_group.sinks]]
connect = "file_raw_sink"
params = { file = "simple.log" }
</code></pre>
<h3 id="2-output-with-filter"><a class="header" href="#2-output-with-filter">2. Output with Filter</a></h3>
<pre><code class="language-toml"># business.d/filtered_output.toml
version = "2.0"

[sink_group]
name = "/sink/filtered"
oml = ["/oml/logs/*"]

[[sink_group.sinks]]
name = "all_logs"
connect = "file_json_sink"
params = { file = "all_logs.json" }

[[sink_group.sinks]]
name = "error_logs"
connect = "file_json_sink"
filter = "./error_filter.wpl"
params = { file = "error_logs.json" }
[sink_group.sinks.expect]
ratio = 0.1
tol = 0.02
</code></pre>
<h3 id="3-parallel-output-configuration-business-groups-only"><a class="header" href="#3-parallel-output-configuration-business-groups-only">3. Parallel Output Configuration (Business Groups Only)</a></h3>
<pre><code class="language-toml"># business.d/parallel_output.toml
version = "2.0"

[sink_group]
name = "/sink/parallel"
oml = ["high_volume"]
parallel = 4
tags = ["type:parallel"]

[[sink_group.sinks]]
name = "output_1"
connect = "file_proto_sink"
params = { file = "output_1.dat" }

[[sink_group.sinks]]
name = "output_2"
connect = "file_proto_sink"
params = { file = "output_2.dat" }
</code></pre>
<p>Note: Infrastructure groups (infra.d) do not support <code>parallel</code> and file sharding; for improved throughput and sharding, configure in business groups.</p>
<h2 id="tag-system"><a class="header" href="#tag-system">Tag System</a></h2>
<h3 id="1-tag-inheritance-hierarchy"><a class="header" href="#1-tag-inheritance-hierarchy">1. Tag Inheritance Hierarchy</a></h3>
<p>The tag system supports three-level inheritance:</p>
<ol>
<li><strong>Default Tags</strong> (from defaults.toml)</li>
<li><strong>Group-level Tags</strong> (from sink_group)</li>
<li><strong>Sink-level Tags</strong> (from individual sink)</li>
</ol>
<h3 id="2-tag-configuration-example"><a class="header" href="#2-tag-configuration-example">2. Tag Configuration Example</a></h3>
<pre><code class="language-toml"># defaults.toml
[defaults]
tags = ["env:production", "service:warpflow"]

# business.d/example.toml
[sink_group]
tags = ["region:us-west", "tier:processing"]

[[sink_group.sinks]]
tags = ["output:file", "compression:gzip"]
</code></pre>
<p><strong>Final Merged Tags</strong>:</p>
<pre><code>["env:production", "service:warpflow", "region:us-west", "tier:processing", "output:file", "compression:gzip"]
</code></pre>
<h2 id="expectation-configuration-expect"><a class="header" href="#expectation-configuration-expect">Expectation Configuration (Expect)</a></h2>
<h3 id="1-ratio-mode"><a class="header" href="#1-ratio-mode">1. Ratio Mode</a></h3>
<pre><code class="language-toml">[sink_group.sinks.expect]
ratio = 1.0    # Expected ratio 100%
tol = 0.01     # Tolerance ±1%
</code></pre>
<h3 id="2-range-mode"><a class="header" href="#2-range-mode">2. Range Mode</a></h3>
<pre><code class="language-toml">[sink_group.sinks.expect]
min = 0.001    # Minimum ratio 0.1%
max = 2.0      # Maximum ratio 200%
</code></pre>
<h3 id="3-global-default-expectations"><a class="header" href="#3-global-default-expectations">3. Global Default Expectations</a></h3>
<pre><code class="language-toml">[defaults.expect]
basis = "total_input"  # Calculation basis
min_samples = 100      # Minimum sample count
mode = "error"         # Violation handling mode
</code></pre>
<h2 id="filter-configuration"><a class="header" href="#filter-configuration">Filter Configuration</a></h2>
<h3 id="1-filter-files"><a class="header" href="#1-filter-files">1. Filter Files</a></h3>
<p>Filter files use WPL (Warp Processing Language) syntax:</p>
<pre><code class="language-wpl"># filter.wpl
# Only process error-level logs
level == "ERROR" || level == "FATAL"

# Or complex conditions
(level == "ERROR" &amp;&amp; source == "auth") ||
(level == "WARN" &amp;&amp; message ~= "timeout")
</code></pre>
<h3 id="2-filter-application"><a class="header" href="#2-filter-application">2. Filter Application</a></h3>
<pre><code class="language-toml">[[sink_group.sinks]]
name = "filtered_output"
connect = "file_json_sink"
filter = "./error_filter.wpl"    # Apply filter
params = { file = "errors.json" }
</code></pre>
<h2 id="configuration-validation"><a class="header" href="#configuration-validation">Configuration Validation</a></h2>
<h3 id="1-parameter-override-validation"><a class="header" href="#1-parameter-override-validation">1. Parameter Override Validation</a></h3>
<p>The system strictly validates parameter overrides:</p>
<ul>
<li>Only parameters specified in <code>allow_override</code> can be overridden</li>
<li>Nested table structure overrides are not supported</li>
</ul>
<h3 id="2-uniqueness-validation"><a class="header" href="#2-uniqueness-validation">2. Uniqueness Validation</a></h3>
<ul>
<li>Sink names within the same sink_group must be unique</li>
<li>Connector IDs must be globally unique</li>
</ul>
<h3 id="3-file-existence-validation"><a class="header" href="#3-file-existence-validation">3. File Existence Validation</a></h3>
<ul>
<li>Filter files must exist and have correct syntax</li>
<li>File path parameters must be valid</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="defaults"><a class="header" href="#defaults">Defaults</a></h1>
<p>Objective</p>
<ul>
<li>Configure expectations (ratio/threshold/window) and understand denominator basis and ignore rules; validate in CLI.</li>
</ul>
<p>Core Concepts (authoritative reference: <code>../02-config/04-sinks_config.md</code>)</p>
<ul>
<li>defaults: Default expectations for groups, defined in <code>[defaults.expect]</code> within <code>$SINK_ROOT/defaults.toml</code>; can be overridden by group/individual sink.</li>
<li>group expect: <code>[sink_group].expect</code>; takes priority over defaults.</li>
<li>sink expect: <code>[[sink_group.sinks]].expect</code>; only supports local fields (ratio/tol or min/max, mutually exclusive).</li>
<li>Denominator basis: <code>total_input | group_input | model</code> (see authoritative documentation for specific definitions).</li>
</ul>
<p>Example (defaults)</p>
<pre><code class="language-toml">version = "2.0"
[defaults]
tags = ["env:dev"]
[defaults.expect]
basis = "group_input"
min_samples = 100
mode = "warn"
</code></pre>
<p>Example (group-level and individual sink)</p>
<pre><code class="language-toml">[sink_group]
name = "/sink/demo"
[sink_group.expect]
basis = "group_input"
mode  = "fail"

[[sink_group.sinks]]
name = "ff"
connect = "file_json_sink"
[sink_group.sinks.expect]
ratio = 0.98   # Mutually exclusive with min/max
tol   = 0.01
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="sinks-routing"><a class="header" href="#sinks-routing">Sinks Routing</a></h1>
<!-- Role: Configuration User | Last Verified: 2025-12-11 -->
<p>Objective</p>
<ul>
<li>Configure routing distribution based on directory-style routes (business.d/infra.d); understand the differences between business groups and infrastructure groups and naming rules.</li>
</ul>
<p>Core Concepts (single point definition: <code>../02-config/04-sinks_config.md</code>)</p>
<ul>
<li>Business group business.d: For scenario outputs.</li>
<li>Infrastructure group infra.d: System-level outputs (default/miss/residue/error/monitor).</li>
</ul>
<p>Directories and Naming</p>
<ul>
<li>Business groups: <code>$SINK_ROOT/business.d/**/*.toml</code>, supports recursive subdirectories; one group per route file.</li>
<li>Infrastructure groups: <code>$SINK_ROOT/infra.d/**/*.toml</code>, supports recursive subdirectories; fixed group names (default/miss/…).</li>
<li>Connectors: Search upward from <code>$WORK_ROOT/models/sinks</code> for the nearest <code>connectors/sink.d/*.toml</code>.</li>
</ul>
<p>Minimal Example (business group)</p>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "/sink/demo"
oml  = ["/oml/example/*"]
parallel = 1

[[sink_group.sinks]]
name = "file_out"
connect = "file_json_sink"   # Connector id
params = { file = "demo.json" }
</code></pre>
<p>Infrastructure Group Example (default)</p>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "default"

[[sink_group.sinks]]
name = "default_sink"
connect = "file_json_sink"
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="file-sink"><a class="header" href="#file-sink">File Sink</a></h1>
<p>This document describes the current configuration and capabilities of File Sinks, aligned with the code implementation.</p>
<h2 id="overview-13"><a class="header" href="#overview-13">Overview</a></h2>
<p>File Sinks write processed data to the local file system, supporting multiple output formats and flexible path configuration. Commonly used for offline validation, archiving, and debugging.</p>
<p>Supported output formats (<code>fmt</code>): <code>json</code>, <code>csv</code>, <code>kv</code>, <code>raw</code>, <code>proto</code>, <code>proto-text</code> (default: <code>json</code>).</p>
<h2 id="connector-definition-3"><a class="header" href="#connector-definition-3">Connector Definition</a></h2>
<p>It’s recommended to use the repository’s built-in templates (located in <code>connectors/sink.d/</code>):</p>
<pre><code class="language-toml"># JSON
[[connectors]]
id = "file_json_sink"
type = "file"
allow_override = ["base","file"]
[connectors.params]
fmt  = "json"
base = "./data/out_dat"
file = "default.json"

# Prototext
[[connectors]]
id = "file_proto_sink"
type = "file"
allow_override = ["base","file"]
[connectors.params]
fmt  = "proto-text"
base = "./data/out_dat"
file = "default.dat"

# Raw
[[connectors]]
id = "file_raw_sink"
type = "file"
allow_override = ["base","file"]
[connectors.params]
fmt  = "raw"
base = "./data/out_dat"
file = "default.raw"
</code></pre>
<h2 id="available-parameters-route-params"><a class="header" href="#available-parameters-route-params">Available Parameters (Route <code>params</code>)</a></h2>
<ul>
<li><code>base</code> + <code>file</code>: Target directory and filename (recommended approach).</li>
<li><code>fmt</code>: Output format (see above).</li>
</ul>
<p>Note: File Sinks automatically create parent directories; internally uses buffered writes with batch flushing, with no manual buffer size/sync mode parameters.</p>
<h2 id="configuration-examples-7"><a class="header" href="#configuration-examples-7">Configuration Examples</a></h2>
<ol>
<li>Basic JSON Output</li>
</ol>
<pre><code class="language-toml"># business.d/json_output.toml
version = "2.0"
[sink_group]
name = "/sink/json_output"
oml  = ["logs"]

[[sink_group.sinks]]
name = "json"
connect = "file_json_sink"
params = { base = "/var/log/warpflow", file = "application.json" }
</code></pre>
<ol start="2">
<li>Error Log Separation (by Filter)</li>
</ol>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "/sink/error_logs"
oml  = ["application_logs"]

[[sink_group.sinks]]
name = "all"
connect = "file_json_sink"
params = { file = "all.json" }

[[sink_group.sinks]]
name = "err"
connect = "file_json_sink"
filter = "./error_filter.wpl"
params = { file = "err.json" }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="syslog-sink"><a class="header" href="#syslog-sink">Syslog Sink</a></h1>
<p>This document is aligned with the code implementation and describes the actual available parameters and examples for Syslog Sink.</p>
<h2 id="overview-14"><a class="header" href="#overview-14">Overview</a></h2>
<p>Syslog Sink sends data to Syslog servers in RFC3164 text format, supporting UDP and TCP. Message format: <code>&lt;PRI&gt;TIMESTAMP HOSTNAME APP_NAME: MESSAGE</code>.</p>
<h2 id="connector-definition-4"><a class="header" href="#connector-definition-4">Connector Definition</a></h2>
<p>Use the repository’s built-in templates (<code>connectors/sink.d/10-syslog-udp.toml</code>, <code>11-syslog-tcp.toml</code>):</p>
<pre><code class="language-toml">[[connectors]]
id = "syslog_udp_sink"
type = "syslog"
allow_override = ["addr", "port", "protocol", "app_name"]
[connectors.params]
addr = "127.0.0.1"
port = 1514
protocol = "udp"

[[connectors]]
id = "syslog_tcp_sink"
type = "syslog"
allow_override = ["addr", "port", "protocol", "app_name"]
[connectors.params]
addr = "127.0.0.1"
port = 1514
protocol = "tcp"
</code></pre>
<h2 id="available-parameters-route-params-1"><a class="header" href="#available-parameters-route-params-1">Available Parameters (Route <code>params</code>)</a></h2>
<ul>
<li><code>addr</code>: Syslog server address (IP or hostname).</li>
<li><code>port</code>: Port number (1–65535).</li>
<li><code>protocol</code>: <code>udp</code> or <code>tcp</code> (case-insensitive).</li>
<li><code>app_name</code>: Application name, defaults to current process name (e.g., <code>wp-engine</code>).</li>
</ul>
<h2 id="configuration-examples-8"><a class="header" href="#configuration-examples-8">Configuration Examples</a></h2>
<ol>
<li>Basic UDP Output</li>
</ol>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "/sink/syslog_basic"
oml  = ["application_logs"]

[[sink_group.sinks]]
name = "syslog_output"
connect = "syslog_udp_sink"
params = { addr = "syslog.example.com", port = 1514, protocol = "udp" }
</code></pre>
<ol start="2">
<li>Conditional Routing</li>
</ol>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "/sink/syslog_by_cond"

[[sink_group.sinks]]
name = "error"
connect = "syslog_tcp_sink"
filter = "./error_filter.wpl"
params = { addr = "syslog-errors.example.com", port = 514, protocol = "tcp" }

[[sink_group.sinks]]
name = "info"
connect = "syslog_udp_sink"
filter = "./info_filter.wpl"
params = { addr = "syslog-info.example.com", port = 1514, protocol = "udp" }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="prometheus-sink"><a class="header" href="#prometheus-sink">Prometheus Sink</a></h1>
<blockquote>
<p><strong>Note</strong>: Prometheus Sink is currently <strong>not implemented</strong>. This document is a design document for the planned feature; please refer to the actual code implementation for current usage.</p>
</blockquote>
<p>This document is aligned with the code implementation. Currently, the Prometheus Sink is a “self-exposing” Exporter that starts a local HTTP service (currently only supports Counter-type metrics) and exposes <code>/metrics</code> externally.</p>
<h2 id="connector-definition-5"><a class="header" href="#connector-definition-5">Connector Definition</a></h2>
<p>Use the repository template (<code>connectors/sink.d/40-prometheus.toml</code>):</p>
<pre><code class="language-toml">[[connectors]]
id = "prometheus_sink"
type = "prometheus"
allow_override = ["endpoint", "source_key_format", "sink_key_format"]
[connectors.params]
endpoint = "127.0.0.1:35666"   # Listen address (exposes /metrics)
source_key_format = "(?P&lt;source_type&gt;.)_(?P&lt;access_source&gt;.)"
sink_key_format   = "(?P&lt;rule&gt;.)_(?P&lt;sink_type&gt;.)_sink"
</code></pre>
<p>Note: Pushgateway/custom <code>metric_name</code>/<code>metric_type</code>/<code>labels</code> are not supported. Built-in metric names are fixed:</p>
<ul>
<li><code>wparse_receive_data</code> (records received from data sources, with source labels)</li>
<li><code>wparse_parse_success</code>, <code>wparse_parse_all</code> (parse success/total)</li>
<li><code>wparse_send_to_sink</code> (records sent to sink, with sink labels)</li>
</ul>
<h2 id="available-parameters-route-params-2"><a class="header" href="#available-parameters-route-params-2">Available Parameters (Route <code>params</code>)</a></h2>
<ul>
<li><code>endpoint</code>: Exporter listen <code>host:port</code> (e.g., <code>127.0.0.1:35666</code>).</li>
<li><code>source_key_format</code>: Optional, regex for extracting <code>source_type/access_source</code> from key (named groups).</li>
<li><code>sink_key_format</code>: Optional, regex for extracting <code>rule/sink_type</code> from key (named groups).</li>
</ul>
<h2 id="configuration-examples-9"><a class="header" href="#configuration-examples-9">Configuration Examples</a></h2>
<p>Start Exporter and expose metrics:</p>
<pre><code class="language-toml">version = "2.0"
[sink_group]
name = "/sink/prom_exporter"
oml  = ["metrics"]

[[sink_group.sinks]]
name = "prom"
connect = "prometheus_sink"
params = { endpoint = "0.0.0.0:35666" }
</code></pre>
<p>Verification: <code>curl http://127.0.0.1:35666/metrics</code></p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="tcp-sink"><a class="header" href="#tcp-sink">TCP Sink</a></h1>
<p>TCP sink is used to output data to any TCP server, supporting line-based or length-prefixed (RFC6587 style) framing.</p>
<h2 id="connector-definition-6"><a class="header" href="#connector-definition-6">Connector Definition</a></h2>
<pre><code class="language-toml">[[connectors]]
id = "tcp_sink"
type = "tcp"
allow_override = ["addr", "port", "framing"]

[connectors.params]
addr = "127.0.0.1"
port = 9000
framing = "line"   # line|len
</code></pre>
<h2 id="available-parameters"><a class="header" href="#available-parameters">Available Parameters</a></h2>
<ul>
<li><code>addr</code>: Target server address (IP or hostname).</li>
<li><code>port</code>: Target port (1–65535), default 9000.</li>
<li><code>framing</code>: Framing mode, <code>line</code> or <code>len</code>, default <code>line</code>.</li>
</ul>
<h2 id="usage-example-wpgen-output-to-tcp"><a class="header" href="#usage-example-wpgen-output-to-tcp">Usage Example (wpgen Output to TCP)</a></h2>
<pre><code class="language-toml"># conf/wpgen.toml
[generator]
mode = "sample"
count = 10000

[output]
connect = "tcp_sink"

[output.params]
addr = "127.0.0.1"
port = 9000
framing = "line"
</code></pre>
<h2 id="framing-description"><a class="header" href="#framing-description">Framing Description</a></h2>
<ul>
<li><code>line</code>: Appends <code>\n</code> as message delimiter</li>
<li><code>len</code>: Sends <code>&lt;len&gt;&lt;space&gt;&lt;payload&gt;</code> (no <code>\n</code> appended)</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="victorialogs"><a class="header" href="#victorialogs">VictoriaLogs</a></h1>
<p>VictoriaLogs sink is used to output log data to the <a href="https://docs.victoriametrics.com/victorialogs/">VictoriaLogs</a> log storage system via HTTP JSON Line interface.</p>
<h2 id="connector-definition-7"><a class="header" href="#connector-definition-7">Connector Definition</a></h2>
<pre><code class="language-toml">[[connectors]]
id = "victorialog_sink"
type = "victorialogs"
allow_override = ["endpoint", "insert_path", "fmt"]

[connectors.params]
endpoint = "http://localhost:8481"
insert_path = "/insert/json"
fmt = "json"
</code></pre>
<h2 id="available-parameters-1"><a class="header" href="#available-parameters-1">Available Parameters</a></h2>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Parameter</th><th>Type</th><th>Default</th><th>Description</th></tr>
</thead>
<tbody>
<tr><td><code>endpoint</code></td><td>string</td><td><code>http://localhost:8481</code></td><td>VictoriaLogs service address (required)</td></tr>
<tr><td><code>insert_path</code></td><td>string</td><td><code>/insert/json</code></td><td>Data insertion path</td></tr>
<tr><td><code>create_time_field</code></td><td>string</td><td>-</td><td>Custom timestamp field name, extracted from data record</td></tr>
<tr><td><code>fmt</code></td><td>string</td><td><code>json</code></td><td>Output format: <code>json</code>, <code>csv</code>, <code>kv</code>, <code>raw</code>, etc.</td></tr>
</tbody>
</table>
</div>
<h2 id="data-format"><a class="header" href="#data-format">Data Format</a></h2>
<p>The sink converts each data record to a JSON object for sending, containing the following special fields:</p>
<ul>
<li><code>_msg</code>: Formatted message content (formatted according to <code>fmt</code> parameter)</li>
<li><code>_time</code>: Timestamp (nanosecond precision), preferring the field specified by <code>create_time_field</code>, otherwise using current time</li>
</ul>
<h2 id="configuration-examples-10"><a class="header" href="#configuration-examples-10">Configuration Examples</a></h2>
<h3 id="basic-usage-1"><a class="header" href="#basic-usage-1">Basic Usage</a></h3>
<pre><code class="language-toml">version = "2.0"

[sink_group]
name = "/sink/victorialogs"
oml  = ["logs"]

[[sink_group.sinks]]
name = "vlogs"
connect = "victorialog_sink"
params = { endpoint = "http://victorialogs:9428" }
</code></pre>
<h3 id="custom-time-field"><a class="header" href="#custom-time-field">Custom Time Field</a></h3>
<pre><code class="language-toml">[[sink_group.sinks]]
name = "vlogs"
connect = "victorialog_sink"

[sink_group.sinks.params]
endpoint = "http://victorialogs:9428"
insert_path = "/insert/jsonline"
create_time_field = "timestamp"
fmt = "json"
</code></pre>
<h2 id="notes-1"><a class="header" href="#notes-1">Notes</a></h2>
<ul>
<li>The <code>endpoint</code> parameter cannot be empty, otherwise validation will fail</li>
<li>HTTP request timeout is 5 seconds</li>
<li>If the field specified by <code>create_time_field</code> does not exist or is not a time type, current UTC time will be used</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="troubleshootingmd"><a class="header" href="#troubleshootingmd">troubleshooting.md</a></h1>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="benchmark-report"><a class="header" href="#benchmark-report">Benchmark Report</a></h1>
<p>Performance benchmarks and testing results.</p>
<p>Coming soon…</p>
<div style="break-before: page; page-break-before: always;"></div>
<h1 id="connector-development-guide"><a class="header" href="#connector-development-guide">Connector Development Guide</a></h1>
<p>Guide for developing custom connectors.</p>
<p>Coming soon…</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>



        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr-ef4e11c1.min.js"></script>
        <script src="mark-09e88c2c.min.js"></script>
        <script src="searcher-c2a407aa.js"></script>

        <script src="clipboard-1626706a.min.js"></script>
        <script src="highlight-abc7f01d.js"></script>
        <script src="book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->
        <script src="../theme/lang-switch.js"></script>
        <script src="../theme/version-badge.js"></script>
        <script src="mermaid-eefea253.min.js"></script>
        <script src="mermaid-init-ccf746f1.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>


    </div>
    </body>
</html>
